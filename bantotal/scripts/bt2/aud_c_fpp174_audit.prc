CREATE OR REPLACE PROCEDURE AUD_C_FPP174_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FPP174_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'FPP174',CONCAT( CONCAT( CONCAT( '|PP173COD=', RTRIM(COALESCE(AUD_old_PP173COD,AUD_new_PP173COD)) ),CONCAT( '|PP174COD=', RTRIM(COALESCE(AUD_old_PP174COD,AUD_new_PP174COD)) ) ),'|' ),AUD_FPP174_UBT,AUD_FPP174_UBU,AUD_FPP174_UBM,AUD_FPP174_UBP,AUD_FPP174_UBR,AUD_FPP174_UAs,AUD_FPP174_UBC,AUD_FPP174_UBA,AUD_FPP174_UBS, '', 'BANTOTAL', '', '', '',AUD_FPP174_UT FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP173COD',AUD_old_PP173COD,AUD_new_PP173COD FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP173COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX1',AUD_old_PP174AUX1,AUD_new_PP174AUX1 FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX10',AUD_old_PP174AUX10,AUD_new_PP174AUX10 FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX10'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX11',AUD_old_PP174AUX11,AUD_new_PP174AUX11 FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX11'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX12',AUD_old_PP174AUX12,AUD_new_PP174AUX12 FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX12'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX2',AUD_old_PP174AUX2,AUD_new_PP174AUX2 FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX3',AUD_old_PP174AUX3,AUD_new_PP174AUX3 FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX4',AUD_old_PP174AUX4,AUD_new_PP174AUX4 FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX5',AUD_old_PP174AUX5,AUD_new_PP174AUX5 FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX6',AUD_old_PP174AUX6,AUD_new_PP174AUX6 FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX6'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX7',TO_CHAR(AUD_old_PP174AUX7,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP174
AUX7,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX7'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX8',TO_CHAR(AUD_old_PP174AUX8,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP174AUX8,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX8'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174AUX9',TO_CHAR(AUD_old_PP174AUX9,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP174AUX9,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174AUX9'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174COD',AUD_old_PP174COD,AUD_new_PP174COD FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174CTA',AUD_old_PP174CTA,AUD_new_PP174CTA FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174CTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174DESC',AUD_old_PP174DESC,AUD_new_PP174DESC FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174DESC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174FEC',TO_CHAR(AUD_old_PP174FEC,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP174FEC,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174FEC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP174_UOn,AUD_FPP174_GuidKey,'PP174SUC',AUD_old_PP174SUC,AUD_new_PP174SUC FROM BANTPROD.AUD_FPP174_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey AND AUDMstFld = 'PP174SUC'); DELETE FROM AUD_FPP174_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP174_UOn AND AUDMstId = AUD_FPP174_GuidKey);  COMMIT ;END IF;END;
/

