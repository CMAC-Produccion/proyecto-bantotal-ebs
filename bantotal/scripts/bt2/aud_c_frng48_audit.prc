CREATE OR REPLACE PROCEDURE AUD_C_FRNG48_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FRNG48_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FRNG48_UOn,AUD_FRNG48_GuidKey,'FRNG48',CONCAT( CONCAT( CONCAT( '|RNG47COD=', RTRIM(COALESCE(AUD_old_RNG47COD,AUD_new_RNG47COD)) ),CONCAT( '|RNG49COD=', RTRIM(COALESCE(AUD_old_RNG49COD,AUD_new_RNG49COD)) ) ),'|' ),AUD_FRNG48_UBT,AUD_FRNG48_UBU,AUD_FRNG48_UBM,AUD_FRNG48_UBP,AUD_FRNG48_UBR,AUD_FRNG48_UAs,AUD_FRNG48_UBC,AUD_FRNG48_UBA,AUD_FRNG48_UBS, '', 'BANTOTAL', '', '', '',AUD_FRNG48_UT FROM BANTPROD.AUD_FRNG48_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG48_UOn AND AUDMstId = AUD_FRNG48_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG48_UOn,AUD_FRNG48_GuidKey,'RNG47COD',AUD_old_RNG47COD,AUD_new_RNG47COD FROM BANTPROD.AUD_FRNG48_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG48_UOn AND AUDMstId = AUD_FRNG48_GuidKey AND AUDMstFld = 'RNG47COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG48_UOn,AUD_FRNG48_GuidKey,'RNG49COD',AUD_old_RNG49COD,AUD_new_RNG49COD FROM BANTPROD.AUD_FRNG48_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG48_UOn AND AUDMstId = AUD_FRNG48_GuidKey AND AUDMstFld = 'RNG49COD'); DELETE FROM AUD_FRNG48_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG48_UOn AND AUDMstId = AUD_FRNG48_GuidKey);  COMMIT ;END IF;END;
/

