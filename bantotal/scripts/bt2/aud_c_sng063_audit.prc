CREATE OR REPLACE PROCEDURE AUD_C_SNG063_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG063_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG063_UOn,AUD_SNG063_GuidKey,'SNG063',CONCAT( CONCAT( CONCAT( CONCAT( '|SNG062AUT=', RTRIM(COALESCE(AUD_old_SNG062AUT,AUD_new_SNG062AUT)) ),CONCAT( '|SNG063NOM=', RTRIM(COALESCE(AUD_old_SNG063NOM,AUD_new_SNG063NOM)) ) ),CONCAT( '|SNG063TIP=', RTRIM(COALESCE(AUD_old_SNG063TIP,AUD_new_SNG063TIP)) ) ),'|' ),AUD_SNG063_UBT,AUD_SNG063_UBU,AUD_SNG063_UBM,AUD_SNG063_UBP,AUD_SNG063_UBR,AUD_SNG063_UAs,AUD_SNG063_UBC,AUD_SNG063_UBA,AUD_SNG063_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG063_UT FROM BANTPROD.AUD_SNG063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG063_UOn AND AUDMstId = AUD_SNG063_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG063_UOn,AUD_SNG063_GuidKey,'SNG062AUT',AUD_old_SNG062AUT,AUD_new_SNG062AUT FROM BANTPROD.AUD_SNG063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG063_UOn AND AUDMstId = AUD_SNG063_GuidKey AND AUDMstFld = 'SNG062AUT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG063_UOn,AUD_SNG063_GuidKey,'SNG063NOM',AUD_old_SNG063NOM,AUD_new_SNG063NOM FROM BANTPROD.AUD_SNG063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG063_UOn AND AUDMstId = AUD_SNG063_GuidKey AND AUDMstFld = 'SNG063NOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG063_UOn,AUD_SNG063_GuidKey,'SNG063TIP',AUD_old_SNG063TIP,AUD_new_SNG063TIP FROM BANTPROD.AUD_SNG063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG063_UOn AND AUDMstId = AUD_SNG063_GuidKey AND AUDMstFld = 'SNG063TIP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG063_UOn,AUD_SNG063_GuidKey,'SNG063VAL',AUD_old_SNG063VAL,AUD_new_SNG063VAL FROM BANTPROD.AUD_SNG063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG063_UOn AND AUDMstId = AUD_SNG063_GuidKey AND AUDMstFld = 'SNG063VAL'); DELETE FROM AUD_SNG063_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG063_UOn AND AUDMstId = AUD_SNG063_GuidKey);  COMMIT ;END IF;END;
/

