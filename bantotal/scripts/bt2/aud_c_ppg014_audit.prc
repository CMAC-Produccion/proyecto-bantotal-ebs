CREATE OR REPLACE PROCEDURE AUD_C_PPG014_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_PPG014_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_PPG014_UOn,AUD_PPG014_GuidKey,'PPG014',CONCAT( CONCAT( '|PPG014CTD=', RTRIM(COALESCE(AUD_old_PPG014CTD,AUD_new_PPG014CTD)) ),'|' ),AUD_PPG014_UBT,AUD_PPG014_UBU,AUD_PPG014_UBM,AUD_PPG014_UBP,AUD_PPG014_UBR,AUD_PPG014_UAs,AUD_PPG014_UBC,AUD_PPG014_UBA,AUD_PPG014_UBS, '', 'BANTOTAL', '', '', '',AUD_PPG014_UT FROM BANTPROD.AUD_PPG014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_PPG014_UOn AND AUDMstId = AUD_PPG014_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_PPG014_UOn,AUD_PPG014_GuidKey,'PPG014CTD',AUD_old_PPG014CTD,AUD_new_PPG014CTD FROM BANTPROD.AUD_PPG014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PPG014_UOn AND AUDMstId = AUD_PPG014_GuidKey AND AUDMstFld = 'PPG014CTD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PPG014_UOn,AUD_PPG014_GuidKey,'PPG014DESC',AUD_old_PPG014DESC,AUD_new_PPG014DESC FROM BANTPROD.AUD_PPG014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PPG014_UOn AND AUDMstId = AUD_PPG014_GuidKey AND AUDMstFld = 'PPG014DESC'); DELETE FROM AUD_PPG014_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_PPG014_UOn AND AUDMstId = AUD_PPG014_GuidKey);  COMMIT ;END IF;END;
/

