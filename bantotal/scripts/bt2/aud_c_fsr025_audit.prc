CREATE OR REPLACE PROCEDURE AUD_C_FSR025_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSR025_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSR025_UOn,AUD_FSR025_GuidKey,'FSR025',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ),CONCAT( '|TAFDES=', RTRIM(COALESCE(AUD_old_TAFDES,AUD_new_TAFDES)) ) ),CONCAT( '|TAMDA=', RTRIM(COALESCE(AUD_old_TAMDA,AUD_new_TAMDA)) ) ),CONCAT( '|TAMOD=', RTRIM(COALESCE(AUD_old_TAMOD,AUD_new_TAMOD)) ) ),CONCAT( '|TAMTO=', RTRIM(COALESCE(AUD_old_TAMTO,AUD_new_TAMTO)) ) ),CONCAT( '|TAPAP=', RTRIM(COALESCE(AUD_old_TAPAP,AUD_new_TAPAP)) ) ),CONCAT( '|TAPZO=', RTRIM(COALESCE(AUD_old_TAPZO,AUD_new_TAPZO)) ) ),CONCAT( '|TPIZAR=', RTRIM(COALESCE(AUD_old_TPIZAR,AUD_new_TPIZAR)) ) ),'|' ),AUD_FSR025_UBT,AUD_FSR025_UBU,AUD_FSR025_UBM,AUD_FSR025_UBP,AUD_FSR025_UBR,AUD_FSR025_UAs,AUD_FSR025_UBC,AUD_FSR025_UBA,AUD_FSR025_UBS, '', 'BANTOTAL', '', '', '',AUD_FSR025_UT FROM BANTPROD.AUD_FSR025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR025_UOn,AUD_FSR025_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSR025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR025_UOn,AUD_FSR025_GuidKey,'TAFDES',TO_CHAR(AUD_old_TAFDES,'YYYY-MM-DD'),TO_CHAR(AUD_new_TAFDES,'YYYY-MM-DD') FROM BANTPROD.AUD_FSR025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey AND AUDMstFld = 'TAFDES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR025_UOn,AUD_FSR025_GuidKey,'TAMDA',AUD_old_TAMDA,AUD_new_TAMDA FROM BANTPROD.AUD_FSR025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey AND AUDMstFld = 'TAMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR025_UOn,AUD_FSR025_GuidKey,'TAMOD',AUD_old_TAMOD,AUD_new_TAMOD FROM BANTPROD.AUD_FSR025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey AND AUDMstFld = 'TAMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR025_UOn,AUD_FSR025_GuidKey,'TAMTO',AUD_old_TAMTO,AUD_new_TAMTO FROM BANTPROD.AUD_FSR025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey AND AUDMstFld = 'TAMTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR025_UOn,AUD_FSR025_GuidKey,'TAPAP',AUD_old_TAPAP,AUD_new_TAPAP FROM BANTPROD.AUD_FSR025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey AND AUDMstFld = 'TAPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR025_UOn,AUD_FSR025_GuidKey,'TAPZO',AUD_old_TAPZO,AUD_new_TAPZO FROM BANTPROD.AUD_FSR025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey AND AUDMstFld = 'TAPZO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR025_UOn,AUD_FSR025_GuidKey,'TATASA',AUD_old_TATASA,AUD_new_TATASA FROM BANTPROD.AUD_FSR025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey AND AUDMstFld = 'TATASA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR025_UOn,AUD_FSR025_GuidKey,'TATOL',AUD_old_TATOL,AUD_new_TATOL FROM BANTPROD.AUD_FSR025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey AND AUDMstFld = 'TATOL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR025_UOn,AUD_FSR025_GuidKey,'TPIZAR',AUD_old_TPIZA
R,AUD_new_TPIZAR FROM BANTPROD.AUD_FSR025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey AND AUDMstFld = 'TPIZAR'); DELETE FROM AUD_FSR025_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR025_UOn AND AUDMstId = AUD_FSR025_GuidKey);  COMMIT ;END IF;END;
/

