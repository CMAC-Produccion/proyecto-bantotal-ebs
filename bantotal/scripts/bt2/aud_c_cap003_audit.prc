CREATE OR REPLACE PROCEDURE AUD_C_CAP003_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_CAP003_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_CAP003_UOn,AUD_CAP003_GuidKey,'CAP003',CONCAT( CONCAT( CONCAT( '|CAP003PGCO=', RTRIM(COALESCE(AUD_old_CAP003PGCO,AUD_new_CAP003PGCO)) ),CONCAT( '|CAP003SEC=', RTRIM(COALESCE(AUD_old_CAP003SEC,AUD_new_CAP003SEC)) ) ),'|' ),AUD_CAP003_UBT,AUD_CAP003_UBU,AUD_CAP003_UBM,AUD_CAP003_UBP,AUD_CAP003_UBR,AUD_CAP003_UAs,AUD_CAP003_UBC,AUD_CAP003_UBA,AUD_CAP003_UBS, '', 'BANTOTAL', '', '', '',AUD_CAP003_UT FROM BANTPROD.AUD_CAP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_CAP003_UOn AND AUDMstId = AUD_CAP003_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_CAP003_UOn,AUD_CAP003_GuidKey,'CAP003CAMP',AUD_old_CAP003CAMP,AUD_new_CAP003CAMP FROM BANTPROD.AUD_CAP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_CAP003_UOn AND AUDMstId = AUD_CAP003_GuidKey AND AUDMstFld = 'CAP003CAMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_CAP003_UOn,AUD_CAP003_GuidKey,'CAP003MAX1',AUD_old_CAP003MAX1,AUD_new_CAP003MAX1 FROM BANTPROD.AUD_CAP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_CAP003_UOn AND AUDMstId = AUD_CAP003_GuidKey AND AUDMstFld = 'CAP003MAX1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_CAP003_UOn,AUD_CAP003_GuidKey,'CAP003MAX2',AUD_old_CAP003MAX2,AUD_new_CAP003MAX2 FROM BANTPROD.AUD_CAP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_CAP003_UOn AND AUDMstId = AUD_CAP003_GuidKey AND AUDMstFld = 'CAP003MAX2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_CAP003_UOn,AUD_CAP003_GuidKey,'CAP003MAX3',AUD_old_CAP003MAX3,AUD_new_CAP003MAX3 FROM BANTPROD.AUD_CAP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_CAP003_UOn AND AUDMstId = AUD_CAP003_GuidKey AND AUDMstFld = 'CAP003MAX3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_CAP003_UOn,AUD_CAP003_GuidKey,'CAP003MAX4',AUD_old_CAP003MAX4,AUD_new_CAP003MAX4 FROM BANTPROD.AUD_CAP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_CAP003_UOn AND AUDMstId = AUD_CAP003_GuidKey AND AUDMstFld = 'CAP003MAX4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_CAP003_UOn,AUD_CAP003_GuidKey,'CAP003MAX5',AUD_old_CAP003MAX5,AUD_new_CAP003MAX5 FROM BANTPROD.AUD_CAP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_CAP003_UOn AND AUDMstId = AUD_CAP003_GuidKey AND AUDMstFld = 'CAP003MAX5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_CAP003_UOn,AUD_CAP003_GuidKey,'CAP003MAX6',AUD_old_CAP003MAX6,AUD_new_CAP003MAX6 FROM BANTPROD.AUD_CAP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_CAP003_UOn AND AUDMstId = AUD_CAP003_GuidKey AND AUDMstFld = 'CAP003MAX6'); INSERT INTO BANTPROD.AUD005 SELECT AUD_CAP003_UOn,AUD_CAP003_GuidKey,'CAP003PGCO',AUD_old_CAP003PGCO,AUD_new_CAP003PGCO FROM BANTPROD.AUD_CAP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_CAP003_UOn AND AUDMstId = AUD_CAP003_GuidKey AND AUDMstFld = 'CAP003PGCO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_CAP003_UOn,AUD_CAP003_GuidKey,'CAP003SEC',AUD_old_CAP003SEC,AUD_new_CAP003SEC FROM BANTPROD.AUD_CAP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_CAP003_UOn AND AUDMstId = AUD_CAP003_GuidKey AND AUDMstFld = 'CAP003SEC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_CAP003_UOn,AUD_CAP003_GuidKey,'CAP003SQL',AUD_old_CAP003SQL,AUD_new_CAP003SQL FROM BANTPROD.AUD_CAP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_CAP003_UOn AND AUDMstId = AUD_CAP003_GuidKey AND AUDMstFld = 'CAP003SQL'); DELETE FROM AUD_CAP003_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_CAP003_UOn A
ND AUDMstId = AUD_CAP003_GuidKey);  COMMIT ;END IF;END;
/

