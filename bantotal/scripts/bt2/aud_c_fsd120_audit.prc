CREATE OR REPLACE PROCEDURE AUD_C_FSD120_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD120_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'FSD120',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|TCCOD=', RTRIM(COALESCE(AUD_old_TCCOD,AUD_new_TCCOD)) ),CONCAT( '|TCFCH=', RTRIM(COALESCE(AUD_old_TCFCH,AUD_new_TCFCH)) ) ),CONCAT( '|TCHOR=', RTRIM(COALESCE(AUD_old_TCHOR,AUD_new_TCHOR)) ) ),CONCAT( '|TCIMP=', RTRIM(COALESCE(AUD_old_TCIMP,AUD_new_TCIMP)) ) ),CONCAT( '|TCMDA=', RTRIM(COALESCE(AUD_old_TCMDA,AUD_new_TCMDA)) ) ),'|' ),AUD_FSD120_UBT,AUD_FSD120_UBU,AUD_FSD120_UBM,AUD_FSD120_UBP,AUD_FSD120_UBR,AUD_FSD120_UAs,AUD_FSD120_UBC,AUD_FSD120_UBA,AUD_FSD120_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD120_UT FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCARBCNT',AUD_old_TCARBCNT,AUD_new_TCARBCNT FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCARBCNT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCARBCPA',AUD_old_TCARBCPA,AUD_new_TCARBCPA FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCARBCPA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCARBTOL',AUD_old_TCARBTOL,AUD_new_TCARBTOL FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCARBTOL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCARBVTA',AUD_old_TCARBVTA,AUD_new_TCARBVTA FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCARBVTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCCOD',AUD_old_TCCOD,AUD_new_TCCOD FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCCPA',AUD_old_TCCPA,AUD_new_TCCPA FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCCPA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCFCH',TO_CHAR(AUD_old_TCFCH,'YYYY-MM-DD'),TO_CHAR(AUD_new_TCFCH,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCFCH'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCFHINV',AUD_old_TCFHINV,AUD_new_TCFHINV FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCFHINV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCHOR',AUD_old_TCHOR,AUD_new_TCHOR FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCHOR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCIMP',AUD_old_TCIMP,AUD_new_TCIMP FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCIMP');
INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCMDA',AUD_old_TCMDA,AUD_new_TCMDA FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCTOLC',AUD_old_TCTOLC,AUD_new_TCTOLC FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCTOLC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCTOLV',AUD_old_TCTOLV,AUD_new_TCTOLV FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCTOLV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD120_UOn,AUD_FSD120_GuidKey,'TCVTA',AUD_old_TCVTA,AUD_new_TCVTA FROM BANTPROD.AUD_FSD120_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey AND AUDMstFld = 'TCVTA'); DELETE FROM AUD_FSD120_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD120_UOn AND AUDMstId = AUD_FSD120_GuidKey);  COMMIT ;END IF;END;
/

