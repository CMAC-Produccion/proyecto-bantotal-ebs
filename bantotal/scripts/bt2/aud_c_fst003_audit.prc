CREATE OR REPLACE PROCEDURE AUD_C_FST003_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST003_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'FST003',CONCAT( CONCAT( '|MODULO=', RTRIM(COALESCE(AUD_old_MODULO,AUD_new_MODULO)) ),'|' ),AUD_FST003_UBT,AUD_FST003_UBU,AUD_FST003_UBM,AUD_FST003_UBP,AUD_FST003_UBR,AUD_FST003_UAs,AUD_FST003_UBC,AUD_FST003_UBA,AUD_FST003_UBS, '', 'BANTOTAL', '', '', '',AUD_FST003_UT FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDALTF',AUD_old_MDALTF,AUD_new_MDALTF FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDALTF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDANIO',AUD_old_MDANIO,AUD_new_MDANIO FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDANIO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDBCU',AUD_old_MDBCU,AUD_new_MDBCU FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDBCU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDCIVA',AUD_old_MDCIVA,AUD_new_MDCIVA FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDCIVA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDCLAS',AUD_old_MDCLAS,AUD_new_MDCLAS FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDCLAS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDFUNC',AUD_old_MDFUNC,AUD_new_MDFUNC FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDFUNC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDFVAL',AUD_old_MDFVAL,AUD_new_MDFVAL FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDFVAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDFVTO',AUD_old_MDFVTO,AUD_new_MDFVTO FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDFVTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDMECA',AUD_old_MDMECA,AUD_new_MDMECA FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDMECA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDMNCA',AUD_old_MDMNCA,AUD_new_MDMNCA FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDMNCA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDMORA',AUD_old_MDMORA,AUD_new_MDMORA FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDMORA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDNCOR',AUD_ol
d_MDNCOR,AUD_new_MDNCOR FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDNCOR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDNOM',AUD_old_MDNOM,AUD_new_MDNOM FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDNOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDNUME',AUD_old_MDNUME,AUD_new_MDNUME FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDNUME'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDPRDT',AUD_old_MDPRDT,AUD_new_MDPRDT FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDPRDT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDPRGO',AUD_old_MDPRGO,AUD_new_MDPRGO FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDPRGO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDPTRN',AUD_old_MDPTRN,AUD_new_MDPTRN FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDPTRN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MDTASA',AUD_old_MDTASA,AUD_new_MDTASA FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MDTASA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST003_UOn,AUD_FST003_GuidKey,'MODULO',AUD_old_MODULO,AUD_new_MODULO FROM BANTPROD.AUD_FST003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey AND AUDMstFld = 'MODULO'); DELETE FROM AUD_FST003_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST003_UOn AND AUDMstId = AUD_FST003_GuidKey);  COMMIT ;END IF;END;
/

