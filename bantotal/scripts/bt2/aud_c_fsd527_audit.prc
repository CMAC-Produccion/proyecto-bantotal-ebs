CREATE OR REPLACE PROCEDURE AUD_C_FSD527_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD527_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'FSD527',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ),CONCAT( '|TAMDA=', RTRIM(COALESCE(AUD_old_TAMDA,AUD_new_TAMDA)) ) ),CONCAT( '|TAMOD=', RTRIM(COALESCE(AUD_old_TAMOD,AUD_new_TAMOD)) ) ),CONCAT( '|TAPAP=', RTRIM(COALESCE(AUD_old_TAPAP,AUD_new_TAPAP)) ) ),CONCAT( '|TPIZAR=', RTRIM(COALESCE(AUD_old_TPIZAR,AUD_new_TPIZAR)) ) ),CONCAT( '|TVFDES=', RTRIM(COALESCE(AUD_old_TVFDES,AUD_new_TVFDES)) ) ),CONCAT( '|TVFMON=', RTRIM(COALESCE(AUD_old_TVFMON,AUD_new_TVFMON)) ) ),CONCAT( '|TVSEGC=', RTRIM(COALESCE(AUD_old_TVSEGC,AUD_new_TVSEGC)) ) ),CONCAT( '|TVSUC=', RTRIM(COALESCE(AUD_old_TVSUC,AUD_new_TVSUC)) ) ),'|' ),AUD_FSD527_UBT,AUD_FSD527_UBU,AUD_FSD527_UBM,AUD_FSD527_UBP,AUD_FSD527_UBR,AUD_FSD527_UAs,AUD_FSD527_UBC,AUD_FSD527_UBA,AUD_FSD527_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD527_UT FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'TAMDA',AUD_old_TAMDA,AUD_new_TAMDA FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey AND AUDMstFld = 'TAMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'TAMOD',AUD_old_TAMOD,AUD_new_TAMOD FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey AND AUDMstFld = 'TAMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'TAPAP',AUD_old_TAPAP,AUD_new_TAPAP FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey AND AUDMstFld = 'TAPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'TPIZAR',AUD_old_TPIZAR,AUD_new_TPIZAR FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey AND AUDMstFld = 'TPIZAR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'TVFDES',TO_CHAR(AUD_old_TVFDES,'YYYY-MM-DD'),TO_CHAR(AUD_new_TVFDES,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey AND AUDMstFld = 'TVFDES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'TVFMON',AUD_old_TVFMON,AUD_new_TVFMON FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey AND AUDMstFld = 'TVFMON'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'TVMFHAS',TO_CHAR(AUD_old_TVMFHAS,'YYYY-MM-DD'),TO_CHAR(AUD_new_TVMFHAS,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey AND AUDMstFld = 'TVMFHAS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'TVMFINV',AUD_old_TVMFINV,AUD_new_TVMFINV FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUD
MstId = AUD_FSD527_GuidKey AND AUDMstFld = 'TVMFINV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'TVMPORC',AUD_old_TVMPORC,AUD_new_TVMPORC FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey AND AUDMstFld = 'TVMPORC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'TVSEGC',AUD_old_TVSEGC,AUD_new_TVSEGC FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey AND AUDMstFld = 'TVSEGC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD527_UOn,AUD_FSD527_GuidKey,'TVSUC',AUD_old_TVSUC,AUD_new_TVSUC FROM BANTPROD.AUD_FSD527_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey AND AUDMstFld = 'TVSUC'); DELETE FROM AUD_FSD527_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD527_UOn AND AUDMstId = AUD_FSD527_GuidKey);  COMMIT ;END IF;END;
/

