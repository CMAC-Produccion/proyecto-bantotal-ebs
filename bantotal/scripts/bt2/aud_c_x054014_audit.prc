CREATE OR REPLACE PROCEDURE AUD_C_X054014_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_X054014_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_X054014_UOn,AUD_X054014_GuidKey,'X054014',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ),CONCAT( '|XPREDGPINI=', RTRIM(COALESCE(AUD_old_XPREDGPINI,AUD_new_XPREDGPINI)) ) ),CONCAT( '|XPREMOD=', RTRIM(COALESCE(AUD_old_XPREMOD,AUD_new_XPREMOD)) ) ),CONCAT( '|XPREMONEDA=', RTRIM(COALESCE(AUD_old_XPREMONEDA,AUD_new_XPREMONEDA)) ) ),CONCAT( '|XPREPAPEL=', RTRIM(COALESCE(AUD_old_XPREPAPEL,AUD_new_XPREPAPEL)) ) ),CONCAT( '|XPRETOPE=', RTRIM(COALESCE(AUD_old_XPRETOPE,AUD_new_XPRETOPE)) ) ),'|' ),AUD_X054014_UBT,AUD_X054014_UBU,AUD_X054014_UBM,AUD_X054014_UBP,AUD_X054014_UBR,AUD_X054014_UAs,AUD_X054014_UBC,AUD_X054014_UBA,AUD_X054014_UBS, '', 'BANTOTAL', '', '', '',AUD_X054014_UT FROM BANTPROD.AUD_X054014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_X054014_UOn AND AUDMstId = AUD_X054014_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054014_UOn,AUD_X054014_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_X054014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054014_UOn AND AUDMstId = AUD_X054014_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054014_UOn,AUD_X054014_GuidKey,'XPREDGCPER',AUD_old_XPREDGCPER,AUD_new_XPREDGCPER FROM BANTPROD.AUD_X054014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054014_UOn AND AUDMstId = AUD_X054014_GuidKey AND AUDMstFld = 'XPREDGCPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054014_UOn,AUD_X054014_GuidKey,'XPREDGPINI',AUD_old_XPREDGPINI,AUD_new_XPREDGPINI FROM BANTPROD.AUD_X054014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054014_UOn AND AUDMstId = AUD_X054014_GuidKey AND AUDMstFld = 'XPREDGPINI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054014_UOn,AUD_X054014_GuidKey,'XPREDGTIPO',AUD_old_XPREDGTIPO,AUD_new_XPREDGTIPO FROM BANTPROD.AUD_X054014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054014_UOn AND AUDMstId = AUD_X054014_GuidKey AND AUDMstFld = 'XPREDGTIPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054014_UOn,AUD_X054014_GuidKey,'XPREDGTMOD',AUD_old_XPREDGTMOD,AUD_new_XPREDGTMOD FROM BANTPROD.AUD_X054014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054014_UOn AND AUDMstId = AUD_X054014_GuidKey AND AUDMstFld = 'XPREDGTMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054014_UOn,AUD_X054014_GuidKey,'XPREMOD',AUD_old_XPREMOD,AUD_new_XPREMOD FROM BANTPROD.AUD_X054014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054014_UOn AND AUDMstId = AUD_X054014_GuidKey AND AUDMstFld = 'XPREMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054014_UOn,AUD_X054014_GuidKey,'XPREMONEDA',AUD_old_XPREMONEDA,AUD_new_XPREMONEDA FROM BANTPROD.AUD_X054014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054014_UOn AND AUDMstId = AUD_X054014_GuidKey AND AUDMstFld = 'XPREMONEDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054014_UOn,AUD_X054014_GuidKey,'XPREPAPEL',AUD_old_XPREPAPEL,AUD_new_XPREPAPEL FROM BANTPROD.AUD_X054014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054014_UOn AND AUDMstId = AUD_X054014_GuidKey AND AUDMstFld = 'XPREPAPEL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054014_UOn,AUD_X054014_GuidKey,'XPRETOPE',AUD_old_XPRETOPE,AUD_new_XPRETOPE FROM BANTPROD.AUD_X054014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054014_UOn AND AUDMstId = AUD_X054014_GuidKey AND AUDMstFld = 'XPRETOPE'); DELETE FROM AUD_X054014_AUDIT  WHERE  EXISTS
(SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_X054014_UOn AND AUDMstId = AUD_X054014_GuidKey);  COMMIT ;END IF;END;
/

