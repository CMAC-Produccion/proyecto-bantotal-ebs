CREATE OR REPLACE PROCEDURE AUD_C_REP003_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_REP003_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003',CONCAT( CONCAT( CONCAT( CONCAT( '|REP001COD=', RTRIM(COALESCE(AUD_old_REP001COD,AUD_new_REP001COD)) ),CONCAT( '|REP002CONS=', RTRIM(COALESCE(AUD_old_REP002CONS,AUD_new_REP002CONS)) ) ),CONCAT( '|REP003COL=', RTRIM(COALESCE(AUD_old_REP003COL,AUD_new_REP003COL)) ) ),'|' ),AUD_REP003_UBT,AUD_REP003_UBU,AUD_REP003_UBM,AUD_REP003_UBP,AUD_REP003_UBR,AUD_REP003_UAs,AUD_REP003_UBC,AUD_REP003_UBA,AUD_REP003_UBS, '', 'BANTOTAL', '', '', '',AUD_REP003_UT FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP001COD',AUD_old_REP001COD,AUD_new_REP001COD FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP001COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP002CONS',AUD_old_REP002CONS,AUD_new_REP002CONS FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP002CONS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003CAYU',AUD_old_REP003CAYU,AUD_new_REP003CAYU FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003CAYU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003CDSC',AUD_old_REP003CDSC,AUD_new_REP003CDSC FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003CDSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003CNOM',AUD_old_REP003CNOM,AUD_new_REP003CNOM FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003CNOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003COL',AUD_old_REP003COL,AUD_new_REP003COL FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003COL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003CVDE',AUD_old_REP003CVDE,AUD_new_REP003CVDE FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003CVDE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003DSC',AUD_old_REP003DSC,AUD_new_REP003DSC FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003EXP',AUD_old_REP003EXP,AUD_new_REP003EXP FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003EXP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003GPBY',AUD_old_REP003GPBY,AUD_new_REP003GPBY FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003GPBY'); INSERT INTO BANTPROD.AUD005 S
ELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003LARG',AUD_old_REP003LARG,AUD_new_REP003LARG FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003LARG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003NIV',AUD_old_REP003NIV,AUD_new_REP003NIV FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003NIV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003PREC',AUD_old_REP003PREC,AUD_new_REP003PREC FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003PREC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP003_UOn,AUD_REP003_GuidKey,'REP003TYPE',AUD_old_REP003TYPE,AUD_new_REP003TYPE FROM BANTPROD.AUD_REP003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey AND AUDMstFld = 'REP003TYPE'); DELETE FROM AUD_REP003_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_REP003_UOn AND AUDMstId = AUD_REP003_GuidKey);  COMMIT ;END IF;END;
/

