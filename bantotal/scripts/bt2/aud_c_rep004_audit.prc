CREATE OR REPLACE PROCEDURE AUD_C_REP004_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_REP004_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004',CONCAT( CONCAT( CONCAT( '|REP001COD=', RTRIM(COALESCE(AUD_old_REP001COD,AUD_new_REP001COD)) ),CONCAT( '|REP004PARMCOD=', RTRIM(COALESCE(AUD_old_REP004PARMCOD,AUD_new_REP004PARMCOD)) ) ),'|' ),AUD_REP004_UBT,AUD_REP004_UBU,AUD_REP004_UBM,AUD_REP004_UBP,AUD_REP004_UBR,AUD_REP004_UAs,AUD_REP004_UBC,AUD_REP004_UBA,AUD_REP004_UBS, '', 'BANTOTAL', '', '', '',AUD_REP004_UT FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP001COD',AUD_old_REP001COD,AUD_new_REP001COD FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP001COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP001PARMDSC',AUD_old_REP001PARMDSC,AUD_new_REP001PARMDSC FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP001PARMDSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004CAYU',AUD_old_REP004CAYU,AUD_new_REP004CAYU FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004CAYU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004CDSC',AUD_old_REP004CDSC,AUD_new_REP004CDSC FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004CDSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004CNOM',AUD_old_REP004CNOM,AUD_new_REP004CNOM FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004CNOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004CVDE',AUD_old_REP004CVDE,AUD_new_REP004CVDE FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004CVDE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004LARG',AUD_old_REP004LARG,AUD_new_REP004LARG FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004LARG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004PARMCOD',AUD_old_REP004PARMCOD,AUD_new_REP004PARMCOD FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004PARMCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004PARMTYPE',AUD_old_REP004PARMTYPE,AUD_new_REP004PARMTYPE FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004PARMTYPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004PHPR',AUD_old_REP004PHPR,AUD_new_REP004PHPR FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004PHPR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_RE
P004_GuidKey,'REP004PPROMPT',AUD_old_REP004PPROMPT,AUD_new_REP004PPROMPT FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004PPROMPT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004PRCONS',AUD_old_REP004PRCONS,AUD_new_REP004PRCONS FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004PRCONS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004PREC',AUD_old_REP004PREC,AUD_new_REP004PREC FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004PREC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP004_UOn,AUD_REP004_GuidKey,'REP004PRREP',AUD_old_REP004PRREP,AUD_new_REP004PRREP FROM BANTPROD.AUD_REP004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey AND AUDMstFld = 'REP004PRREP'); DELETE FROM AUD_REP004_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_REP004_UOn AND AUDMstId = AUD_REP004_GuidKey);  COMMIT ;END IF;END;
/

