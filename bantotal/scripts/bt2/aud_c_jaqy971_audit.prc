CREATE OR REPLACE PROCEDURE AUD_C_JAQY971_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_JAQY971_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971',CONCAT( CONCAT( CONCAT( '|JAQY971CORR=', RTRIM(COALESCE(AUD_old_JAQY971CORR,AUD_new_JAQY971CORR)) ),CONCAT( '|JAQY971FECR=', RTRIM(COALESCE(AUD_old_JAQY971FECR,AUD_new_JAQY971FECR)) ) ),'|' ),AUD_JAQY971_UBT,AUD_JAQY971_UBU,AUD_JAQY971_UBM,AUD_JAQY971_UBP,AUD_JAQY971_UBR,AUD_JAQY971_UAs,AUD_JAQY971_UBC,AUD_JAQY971_UBA,AUD_JAQY971_UBS, '', 'BANTOTAL', '', '', '',AUD_JAQY971_UT FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971CORR',AUD_old_JAQY971CORR,AUD_new_JAQY971CORR FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971CORR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971ESTA',AUD_old_JAQY971ESTA,AUD_new_JAQY971ESTA FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971ESTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971FECD',TO_CHAR(AUD_old_JAQY971FECD,'YYYY-MM-DD'),TO_CHAR(AUD_new_JAQY971FECD,'YYYY-MM-DD') FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971FECD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971FECR',TO_CHAR(AUD_old_JAQY971FECR,'YYYY-MM-DD'),TO_CHAR(AUD_new_JAQY971FECR,'YYYY-MM-DD') FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971FECR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971FECT',TO_CHAR(AUD_old_JAQY971FECT,'YYYY-MM-DD'),TO_CHAR(AUD_new_JAQY971FECT,'YYYY-MM-DD') FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971FECT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971HABI',AUD_old_JAQY971HABI,AUD_new_JAQY971HABI FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971HABI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971MDA',AUD_old_JAQY971MDA,AUD_new_JAQY971MDA FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971MDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971MOD',AUD_old_JAQY971MOD,AUD_new_JAQY971MOD FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971MODT',AUD_old_JAQY971MODT,AUD_new_JAQY971MODT FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971MODT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971MTOP',AUD_old_JAQY971MTOP,AUD_new_JAQY971MTOP FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT
 EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971MTOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971NCTA',AUD_old_JAQY971NCTA,AUD_new_JAQY971NCTA FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971NCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971OPER',AUD_old_JAQY971OPER,AUD_new_JAQY971OPER FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971OPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971PAPE',AUD_old_JAQY971PAPE,AUD_new_JAQY971PAPE FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971PAPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971PGCO',AUD_old_JAQY971PGCO,AUD_new_JAQY971PGCO FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971PGCO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971PGTR',AUD_old_JAQY971PGTR,AUD_new_JAQY971PGTR FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971PGTR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971RELT',AUD_old_JAQY971RELT,AUD_new_JAQY971RELT FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971RELT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971SBOP',AUD_old_JAQY971SBOP,AUD_new_JAQY971SBOP FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971SBOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971SCAP',AUD_old_JAQY971SCAP,AUD_new_JAQY971SCAP FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971SCAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971STAT',AUD_old_JAQY971STAT,AUD_new_JAQY971STAT FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971STAT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971SUCD',AUD_old_JAQY971SUCD,AUD_new_JAQY971SUCD FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971SUCD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971SUCR',AUD_old_JAQY971SUCR,AUD_new_JAQY971SUCR FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971SUCR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971SUCT',AUD_old_JAQY971SUCT,AUD_new_JAQY971SUCT FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971SUCT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971SUCU',AUD_old_JAQY971SUCU,AUD_new_JAQY971SUCU FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM
 BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971SUCU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971TIPO',AUD_old_JAQY971TIPO,AUD_new_JAQY971TIPO FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971TIPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971TOPE',AUD_old_JAQY971TOPE,AUD_new_JAQY971TOPE FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971TOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971TRAN',AUD_old_JAQY971TRAN,AUD_new_JAQY971TRAN FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971TRAN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971USUD',AUD_old_JAQY971USUD,AUD_new_JAQY971USUD FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971USUD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQY971_UOn,AUD_JAQY971_GuidKey,'JAQY971USUR',AUD_old_JAQY971USUR,AUD_new_JAQY971USUR FROM BANTPROD.AUD_JAQY971_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey AND AUDMstFld = 'JAQY971USUR'); DELETE FROM AUD_JAQY971_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_JAQY971_UOn AND AUDMstId = AUD_JAQY971_GuidKey);  COMMIT ;END IF;END;
/

