CREATE OR REPLACE PROCEDURE AUD_C_FST026_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST026_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST026_UOn,AUD_FST026_GuidKey,'FST026',CONCAT( CONCAT( '|CECOD=', RTRIM(COALESCE(AUD_old_CECOD,AUD_new_CECOD)) ),'|' ),AUD_FST026_UBT,AUD_FST026_UBU,AUD_FST026_UBM,AUD_FST026_UBP,AUD_FST026_UBR,AUD_FST026_UAs,AUD_FST026_UBC,AUD_FST026_UBA,AUD_FST026_UBS, '', 'BANTOTAL', '', '', '',AUD_FST026_UT FROM BANTPROD.AUD_FST026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST026_UOn AND AUDMstId = AUD_FST026_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST026_UOn,AUD_FST026_GuidKey,'CECOD',AUD_old_CECOD,AUD_new_CECOD FROM BANTPROD.AUD_FST026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST026_UOn AND AUDMstId = AUD_FST026_GuidKey AND AUDMstFld = 'CECOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST026_UOn,AUD_FST026_GuidKey,'CENOM',AUD_old_CENOM,AUD_new_CENOM FROM BANTPROD.AUD_FST026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST026_UOn AND AUDMstId = AUD_FST026_GuidKey AND AUDMstFld = 'CENOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST026_UOn,AUD_FST026_GuidKey,'CENOMR',AUD_old_CENOMR,AUD_new_CENOMR FROM BANTPROD.AUD_FST026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST026_UOn AND AUDMstId = AUD_FST026_GuidKey AND AUDMstFld = 'CENOMR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST026_UOn,AUD_FST026_GuidKey,'CEPOP',AUD_old_CEPOP,AUD_new_CEPOP FROM BANTPROD.AUD_FST026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST026_UOn AND AUDMstId = AUD_FST026_GuidKey AND AUDMstFld = 'CEPOP'); DELETE FROM AUD_FST026_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST026_UOn AND AUDMstId = AUD_FST026_GuidKey);  COMMIT ;END IF;END;
/

