CREATE OR REPLACE PROCEDURE AUD_C_SNG060_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG060_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG060_UOn,AUD_SNG060_GuidKey,'SNG060',CONCAT( CONCAT( '|SNG060PQT=', RTRIM(COALESCE(AUD_old_SNG060PQT,AUD_new_SNG060PQT)) ),'|' ),AUD_SNG060_UBT,AUD_SNG060_UBU,AUD_SNG060_UBM,AUD_SNG060_UBP,AUD_SNG060_UBR,AUD_SNG060_UAs,AUD_SNG060_UBC,AUD_SNG060_UBA,AUD_SNG060_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG060_UT FROM BANTPROD.AUD_SNG060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG060_UOn AND AUDMstId = AUD_SNG060_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG060_UOn,AUD_SNG060_GuidKey,'SNG057USR',AUD_old_SNG057USR,AUD_new_SNG057USR FROM BANTPROD.AUD_SNG060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG060_UOn AND AUDMstId = AUD_SNG060_GuidKey AND AUDMstFld = 'SNG057USR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG060_UOn,AUD_SNG060_GuidKey,'SNG060EMP',AUD_old_SNG060EMP,AUD_new_SNG060EMP FROM BANTPROD.AUD_SNG060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG060_UOn AND AUDMstId = AUD_SNG060_GuidKey AND AUDMstFld = 'SNG060EMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG060_UOn,AUD_SNG060_GuidKey,'SNG060EST',AUD_old_SNG060EST,AUD_new_SNG060EST FROM BANTPROD.AUD_SNG060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG060_UOn AND AUDMstId = AUD_SNG060_GuidKey AND AUDMstFld = 'SNG060EST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG060_UOn,AUD_SNG060_GuidKey,'SNG060FAP',TO_CHAR(AUD_old_SNG060FAP,'YYYY-MM-DD'),TO_CHAR(AUD_new_SNG060FAP,'YYYY-MM-DD') FROM BANTPROD.AUD_SNG060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG060_UOn AND AUDMstId = AUD_SNG060_GuidKey AND AUDMstFld = 'SNG060FAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG060_UOn,AUD_SNG060_GuidKey,'SNG060NOW',TO_CHAR(AUD_old_SNG060NOW,'YYYY-MM-DD'),TO_CHAR(AUD_new_SNG060NOW,'YYYY-MM-DD') FROM BANTPROD.AUD_SNG060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG060_UOn AND AUDMstId = AUD_SNG060_GuidKey AND AUDMstFld = 'SNG060NOW'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG060_UOn,AUD_SNG060_GuidKey,'SNG060PQT',AUD_old_SNG060PQT,AUD_new_SNG060PQT FROM BANTPROD.AUD_SNG060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG060_UOn AND AUDMstId = AUD_SNG060_GuidKey AND AUDMstFld = 'SNG060PQT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG060_UOn,AUD_SNG060_GuidKey,'SNG060SUC',AUD_old_SNG060SUC,AUD_new_SNG060SUC FROM BANTPROD.AUD_SNG060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG060_UOn AND AUDMstId = AUD_SNG060_GuidKey AND AUDMstFld = 'SNG060SUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG060_UOn,AUD_SNG060_GuidKey,'SNG060WRK',AUD_old_SNG060WRK,AUD_new_SNG060WRK FROM BANTPROD.AUD_SNG060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG060_UOn AND AUDMstId = AUD_SNG060_GuidKey AND AUDMstFld = 'SNG060WRK'); DELETE FROM AUD_SNG060_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG060_UOn AND AUDMstId = AUD_SNG060_GuidKey);  COMMIT ;END IF;END;
/

