CREATE OR REPLACE PROCEDURE AUD_C_FSR006_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSR006_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSR006_UOn,AUD_FSR006_GuidKey,'FSR006',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|CTNRO=', RTRIM(COALESCE(AUD_old_CTNRO,AUD_new_CTNRO)) ),CONCAT( '|DOCOD=', RTRIM(COALESCE(AUD_old_DOCOD,AUD_new_DOCOD)) ) ),CONCAT( '|DOORD=', RTRIM(COALESCE(AUD_old_DOORD,AUD_new_DOORD)) ) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),'|' ),AUD_FSR006_UBT,AUD_FSR006_UBU,AUD_FSR006_UBM,AUD_FSR006_UBP,AUD_FSR006_UBR,AUD_FSR006_UAs,AUD_FSR006_UBC,AUD_FSR006_UBA,AUD_FSR006_UBS, '', 'BANTOTAL', '', '', '',AUD_FSR006_UT FROM BANTPROD.AUD_FSR006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR006_UOn AND AUDMstId = AUD_FSR006_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR006_UOn,AUD_FSR006_GuidKey,'CTNRO',AUD_old_CTNRO,AUD_new_CTNRO FROM BANTPROD.AUD_FSR006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR006_UOn AND AUDMstId = AUD_FSR006_GuidKey AND AUDMstFld = 'CTNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR006_UOn,AUD_FSR006_GuidKey,'DOCOD',AUD_old_DOCOD,AUD_new_DOCOD FROM BANTPROD.AUD_FSR006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR006_UOn AND AUDMstId = AUD_FSR006_GuidKey AND AUDMstFld = 'DOCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR006_UOn,AUD_FSR006_GuidKey,'DOFAX',AUD_old_DOFAX,AUD_new_DOFAX FROM BANTPROD.AUD_FSR006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR006_UOn AND AUDMstId = AUD_FSR006_GuidKey AND AUDMstFld = 'DOFAX'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR006_UOn,AUD_FSR006_GuidKey,'DOORD',AUD_old_DOORD,AUD_new_DOORD FROM BANTPROD.AUD_FSR006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR006_UOn AND AUDMstId = AUD_FSR006_GuidKey AND AUDMstFld = 'DOORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR006_UOn,AUD_FSR006_GuidKey,'DOTELF',AUD_old_DOTELF,AUD_new_DOTELF FROM BANTPROD.AUD_FSR006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR006_UOn AND AUDMstId = AUD_FSR006_GuidKey AND AUDMstFld = 'DOTELF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR006_UOn,AUD_FSR006_GuidKey,'DOTLEX',AUD_old_DOTLEX,AUD_new_DOTLEX FROM BANTPROD.AUD_FSR006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR006_UOn AND AUDMstId = AUD_FSR006_GuidKey AND AUDMstFld = 'DOTLEX'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR006_UOn,AUD_FSR006_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSR006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR006_UOn AND AUDMstId = AUD_FSR006_GuidKey AND AUDMstFld = 'PGCOD'); DELETE FROM AUD_FSR006_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR006_UOn AND AUDMstId = AUD_FSR006_GuidKey);  COMMIT ;END IF;END;
/

