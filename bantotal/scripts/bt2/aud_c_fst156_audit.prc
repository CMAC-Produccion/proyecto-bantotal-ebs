CREATE OR REPLACE PROCEDURE AUD_C_FST156_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST156_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST156_UOn,AUD_FST156_GuidKey,'FST156',CONCAT( CONCAT( '|AGTECOD=', RTRIM(COALESCE(AUD_old_AGTECOD,AUD_new_AGTECOD)) ),'|' ),AUD_FST156_UBT,AUD_FST156_UBU,AUD_FST156_UBM,AUD_FST156_UBP,AUD_FST156_UBR,AUD_FST156_UAs,AUD_FST156_UBC,AUD_FST156_UBA,AUD_FST156_UBS, '', 'BANTOTAL', '', '', '',AUD_FST156_UT FROM BANTPROD.AUD_FST156_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST156_UOn AND AUDMstId = AUD_FST156_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST156_UOn,AUD_FST156_GuidKey,'AGTECOD',AUD_old_AGTECOD,AUD_new_AGTECOD FROM BANTPROD.AUD_FST156_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST156_UOn AND AUDMstId = AUD_FST156_GuidKey AND AUDMstFld = 'AGTECOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST156_UOn,AUD_FST156_GuidKey,'AGTENOM',AUD_old_AGTENOM,AUD_new_AGTENOM FROM BANTPROD.AUD_FST156_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST156_UOn AND AUDMstId = AUD_FST156_GuidKey AND AUDMstFld = 'AGTENOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST156_UOn,AUD_FST156_GuidKey,'AGTESTS',AUD_old_AGTESTS,AUD_new_AGTESTS FROM BANTPROD.AUD_FST156_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST156_UOn AND AUDMstId = AUD_FST156_GuidKey AND AUDMstFld = 'AGTESTS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST156_UOn,AUD_FST156_GuidKey,'AGTESUC',AUD_old_AGTESUC,AUD_new_AGTESUC FROM BANTPROD.AUD_FST156_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST156_UOn AND AUDMstId = AUD_FST156_GuidKey AND AUDMstFld = 'AGTESUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST156_UOn,AUD_FST156_GuidKey,'AGTETIP',AUD_old_AGTETIP,AUD_new_AGTETIP FROM BANTPROD.AUD_FST156_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST156_UOn AND AUDMstId = AUD_FST156_GuidKey AND AUDMstFld = 'AGTETIP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST156_UOn,AUD_FST156_GuidKey,'AGTEUSR',AUD_old_AGTEUSR,AUD_new_AGTEUSR FROM BANTPROD.AUD_FST156_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST156_UOn AND AUDMstId = AUD_FST156_GuidKey AND AUDMstFld = 'AGTEUSR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST156_UOn,AUD_FST156_GuidKey,'CARGOCOD',AUD_old_CARGOCOD,AUD_new_CARGOCOD FROM BANTPROD.AUD_FST156_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST156_UOn AND AUDMstId = AUD_FST156_GuidKey AND AUDMstFld = 'CARGOCOD'); DELETE FROM AUD_FST156_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST156_UOn AND AUDMstId = AUD_FST156_GuidKey);  COMMIT ;END IF;END;
/

