CREATE OR REPLACE PROCEDURE AUD_C_FSR012_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSR012_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'FSR012',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|P1COD=', RTRIM(COALESCE(AUD_old_P1COD,AUD_new_P1COD)) ),CONCAT( '|P1CTA=', RTRIM(COALESCE(AUD_old_P1CTA,AUD_new_P1CTA)) ) ),CONCAT( '|P1MDA=', RTRIM(COALESCE(AUD_old_P1MDA,AUD_new_P1MDA)) ) ),CONCAT( '|P1MOD=', RTRIM(COALESCE(AUD_old_P1MOD,AUD_new_P1MOD)) ) ),CONCAT( '|P1NDOC=', RTRIM(COALESCE(AUD_old_P1NDOC,AUD_new_P1NDOC)) ) ),CONCAT( '|P1OPER=', RTRIM(COALESCE(AUD_old_P1OPER,AUD_new_P1OPER)) ) ),CONCAT( '|P1PAIS=', RTRIM(COALESCE(AUD_old_P1PAIS,AUD_new_P1PAIS)) ) ),CONCAT( '|P1PAP=', RTRIM(COALESCE(AUD_old_P1PAP,AUD_new_P1PAP)) ) ),CONCAT( '|P1SBOP=', RTRIM(COALESCE(AUD_old_P1SBOP,AUD_new_P1SBOP)) ) ),CONCAT( '|P1SUC=', RTRIM(COALESCE(AUD_old_P1SUC,AUD_new_P1SUC)) ) ),CONCAT( '|P1TDOC=', RTRIM(COALESCE(AUD_old_P1TDOC,AUD_new_P1TDOC)) ) ),CONCAT( '|P1TOPE=', RTRIM(COALESCE(AUD_old_P1TOPE,AUD_new_P1TOPE)) ) ),CONCAT( '|RELCOD=', RTRIM(COALESCE(AUD_old_RELCOD,AUD_new_RELCOD)) ) ),'|' ),AUD_FSR012_UBT,AUD_FSR012_UBU,AUD_FSR012_UBM,AUD_FSR012_UBP,AUD_FSR012_UBR,AUD_FSR012_UAs,AUD_FSR012_UBC,AUD_FSR012_UBA,AUD_FSR012_UBS, '', 'BANTOTAL', '', '', '',AUD_FSR012_UT FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1COD',AUD_old_P1COD,AUD_new_P1COD FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1CTA',AUD_old_P1CTA,AUD_new_P1CTA FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1CTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1MDA',AUD_old_P1MDA,AUD_new_P1MDA FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1MDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1MOD',AUD_old_P1MOD,AUD_new_P1MOD FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1NDOC',AUD_old_P1NDOC,AUD_new_P1NDOC FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1NDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1OPER',AUD_old_P1OPER,AUD_new_P1OPER FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1OPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1PAIS',AUD_old_P1PAIS,AUD_new_P1PAIS FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1PAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1PAP',AUD_old_P1PAP,AUD_new_P1PAP FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1PAP'); INSERT INTO B
ANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1PORC',AUD_old_P1PORC,AUD_new_P1PORC FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1PORC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1SBOP',AUD_old_P1SBOP,AUD_new_P1SBOP FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1SBOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1SUC',AUD_old_P1SUC,AUD_new_P1SUC FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1SUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1TDOC',AUD_old_P1TDOC,AUD_new_P1TDOC FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1TDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'P1TOPE',AUD_old_P1TOPE,AUD_new_P1TOPE FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'P1TOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR012_UOn,AUD_FSR012_GuidKey,'RELCOD',AUD_old_RELCOD,AUD_new_RELCOD FROM BANTPROD.AUD_FSR012_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey AND AUDMstFld = 'RELCOD'); DELETE FROM AUD_FSR012_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR012_UOn AND AUDMstId = AUD_FSR012_GuidKey);  COMMIT ;END IF;END;
/

