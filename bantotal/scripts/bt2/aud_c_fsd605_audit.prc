CREATE OR REPLACE PROCEDURE AUD_C_FSD605_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD605_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'FSD605',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|RDCOD=', RTRIM(COALESCE(AUD_old_RDCOD,AUD_new_RDCOD)) ),CONCAT( '|RDCTA=', RTRIM(COALESCE(AUD_old_RDCTA,AUD_new_RDCTA)) ) ),CONCAT( '|RDMDA=', RTRIM(COALESCE(AUD_old_RDMDA,AUD_new_RDMDA)) ) ),CONCAT( '|RDMOD=', RTRIM(COALESCE(AUD_old_RDMOD,AUD_new_RDMOD)) ) ),CONCAT( '|RDOPER=', RTRIM(COALESCE(AUD_old_RDOPER,AUD_new_RDOPER)) ) ),CONCAT( '|RDPAP=', RTRIM(COALESCE(AUD_old_RDPAP,AUD_new_RDPAP)) ) ),CONCAT( '|RDSBOP=', RTRIM(COALESCE(AUD_old_RDSBOP,AUD_new_RDSBOP)) ) ),CONCAT( '|RDSUC=', RTRIM(COALESCE(AUD_old_RDSUC,AUD_new_RDSUC)) ) ),CONCAT( '|RDTOPE=', RTRIM(COALESCE(AUD_old_RDTOPE,AUD_new_RDTOPE)) ) ),'|' ),AUD_FSD605_UBT,AUD_FSD605_UBU,AUD_FSD605_UBM,AUD_FSD605_UBP,AUD_FSD605_UBR,AUD_FSD605_UAs,AUD_FSD605_UBC,AUD_FSD605_UBA,AUD_FSD605_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD605_UT FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDCLTCOD',AUD_old_RDCLTCOD,AUD_new_RDCLTCOD FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDCLTCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDCOD',AUD_old_RDCOD,AUD_new_RDCOD FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDCTA',AUD_old_RDCTA,AUD_new_RDCTA FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDMDA',AUD_old_RDMDA,AUD_new_RDMDA FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDMOD',AUD_old_RDMOD,AUD_new_RDMOD FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDOPER',AUD_old_RDOPER,AUD_new_RDOPER FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDOPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDPAP',AUD_old_RDPAP,AUD_new_RDPAP FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDPLUS',AUD_old_RDPLUS,AUD_new_RDPLUS FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDPLUS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDPZO',AUD_old_RDPZO,AUD_new_RDPZO FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDPZO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD60
5_UOn,AUD_FSD605_GuidKey,'RDSBOP',AUD_old_RDSBOP,AUD_new_RDSBOP FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDSBOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDSUC',AUD_old_RDSUC,AUD_new_RDSUC FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDSUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDTASA',AUD_old_RDTASA,AUD_new_RDTASA FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDTASA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDTOPE',AUD_old_RDTOPE,AUD_new_RDTOPE FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDTOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD605_UOn,AUD_FSD605_GuidKey,'RDTTAS',AUD_old_RDTTAS,AUD_new_RDTTAS FROM BANTPROD.AUD_FSD605_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey AND AUDMstFld = 'RDTTAS'); DELETE FROM AUD_FSD605_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD605_UOn AND AUDMstId = AUD_FSD605_GuidKey);  COMMIT ;END IF;END;
/

