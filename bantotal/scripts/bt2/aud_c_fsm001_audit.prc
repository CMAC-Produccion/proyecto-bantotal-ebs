CREATE OR REPLACE PROCEDURE AUD_C_FSM001_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSM001_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSM001_UOn,AUD_FSM001_GuidKey,'FSM001',CONCAT( CONCAT( '|PRGNOM=', RTRIM(COALESCE(AUD_old_PRGNOM,AUD_new_PRGNOM)) ),'|' ),AUD_FSM001_UBT,AUD_FSM001_UBU,AUD_FSM001_UBM,AUD_FSM001_UBP,AUD_FSM001_UBR,AUD_FSM001_UAs,AUD_FSM001_UBC,AUD_FSM001_UBA,AUD_FSM001_UBS, '', 'BANTOTAL', '', '', '',AUD_FSM001_UT FROM BANTPROD.AUD_FSM001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSM001_UOn AND AUDMstId = AUD_FSM001_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSM001_UOn,AUD_FSM001_GuidKey,'PRGDSC1',AUD_old_PRGDSC1,AUD_new_PRGDSC1 FROM BANTPROD.AUD_FSM001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSM001_UOn AND AUDMstId = AUD_FSM001_GuidKey AND AUDMstFld = 'PRGDSC1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSM001_UOn,AUD_FSM001_GuidKey,'PRGDSC2',AUD_old_PRGDSC2,AUD_new_PRGDSC2 FROM BANTPROD.AUD_FSM001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSM001_UOn AND AUDMstId = AUD_FSM001_GuidKey AND AUDMstFld = 'PRGDSC2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSM001_UOn,AUD_FSM001_GuidKey,'PRGNIV',AUD_old_PRGNIV,AUD_new_PRGNIV FROM BANTPROD.AUD_FSM001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSM001_UOn AND AUDMstId = AUD_FSM001_GuidKey AND AUDMstFld = 'PRGNIV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSM001_UOn,AUD_FSM001_GuidKey,'PRGNOM',AUD_old_PRGNOM,AUD_new_PRGNOM FROM BANTPROD.AUD_FSM001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSM001_UOn AND AUDMstId = AUD_FSM001_GuidKey AND AUDMstFld = 'PRGNOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSM001_UOn,AUD_FSM001_GuidKey,'PRGTPO',AUD_old_PRGTPO,AUD_new_PRGTPO FROM BANTPROD.AUD_FSM001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSM001_UOn AND AUDMstId = AUD_FSM001_GuidKey AND AUDMstFld = 'PRGTPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSM001_UOn,AUD_FSM001_GuidKey,'PRGTXT',AUD_old_PRGTXT,AUD_new_PRGTXT FROM BANTPROD.AUD_FSM001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSM001_UOn AND AUDMstId = AUD_FSM001_GuidKey AND AUDMstFld = 'PRGTXT'); DELETE FROM AUD_FSM001_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSM001_UOn AND AUDMstId = AUD_FSM001_GuidKey);  COMMIT ;END IF;END;
/

