CREATE OR REPLACE PROCEDURE AUD_C_SNGP05_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNGP05_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNGP05_UOn,AUD_SNGP05_GuidKey,'SNGP05',CONCAT( CONCAT( CONCAT( '|SNGP05PGC=', RTRIM(COALESCE(AUD_old_SNGP05PGC,AUD_new_SNGP05PGC)) ),CONCAT( '|SNGP09COD=', RTRIM(COALESCE(AUD_old_SNGP09COD,AUD_new_SNGP09COD)) ) ),'|' ),AUD_SNGP05_UBT,AUD_SNGP05_UBU,AUD_SNGP05_UBM,AUD_SNGP05_UBP,AUD_SNGP05_UBR,AUD_SNGP05_UAs,AUD_SNGP05_UBC,AUD_SNGP05_UBA,AUD_SNGP05_UBS, '', 'BANTOTAL', '', '', '',AUD_SNGP05_UT FROM BANTPROD.AUD_SNGP05_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGP05_UOn AND AUDMstId = AUD_SNGP05_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP05_UOn,AUD_SNGP05_GuidKey,'SNGP05CHR1',AUD_old_SNGP05CHR1,AUD_new_SNGP05CHR1 FROM BANTPROD.AUD_SNGP05_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP05_UOn AND AUDMstId = AUD_SNGP05_GuidKey AND AUDMstFld = 'SNGP05CHR1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP05_UOn,AUD_SNGP05_GuidKey,'SNGP05INT9',AUD_old_SNGP05INT9,AUD_new_SNGP05INT9 FROM BANTPROD.AUD_SNGP05_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP05_UOn AND AUDMstId = AUD_SNGP05_GuidKey AND AUDMstFld = 'SNGP05INT9'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP05_UOn,AUD_SNGP05_GuidKey,'SNGP05PGC',AUD_old_SNGP05PGC,AUD_new_SNGP05PGC FROM BANTPROD.AUD_SNGP05_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP05_UOn AND AUDMstId = AUD_SNGP05_GuidKey AND AUDMstFld = 'SNGP05PGC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP05_UOn,AUD_SNGP05_GuidKey,'SNGP05PGM1',AUD_old_SNGP05PGM1,AUD_new_SNGP05PGM1 FROM BANTPROD.AUD_SNGP05_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP05_UOn AND AUDMstId = AUD_SNGP05_GuidKey AND AUDMstFld = 'SNGP05PGM1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP05_UOn,AUD_SNGP05_GuidKey,'SNGP09COD',AUD_old_SNGP09COD,AUD_new_SNGP09COD FROM BANTPROD.AUD_SNGP05_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP05_UOn AND AUDMstId = AUD_SNGP05_GuidKey AND AUDMstFld = 'SNGP09COD'); DELETE FROM AUD_SNGP05_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGP05_UOn AND AUDMstId = AUD_SNGP05_GuidKey);  COMMIT ;END IF;END;
/

