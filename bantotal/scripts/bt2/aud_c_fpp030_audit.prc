CREATE OR REPLACE PROCEDURE AUD_C_FPP030_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FPP030_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'FPP030',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PP010PRD=', RTRIM(COALESCE(AUD_old_PP010PRD,AUD_new_PP010PRD)) ),CONCAT( '|PP016COD=', RTRIM(COALESCE(AUD_old_PP016COD,AUD_new_PP016COD)) ) ),CONCAT( '|PP016TIPO=', RTRIM(COALESCE(AUD_old_PP016TIPO,AUD_new_PP016TIPO)) ) ),CONCAT( '|PP017PAR=', RTRIM(COALESCE(AUD_old_PP017PAR,AUD_new_PP017PAR)) ) ),CONCAT( '|PP030EMP=', RTRIM(COALESCE(AUD_old_PP030EMP,AUD_new_PP030EMP)) ) ),CONCAT( '|PP030MDA=', RTRIM(COALESCE(AUD_old_PP030MDA,AUD_new_PP030MDA)) ) ),CONCAT( '|PP030MOD=', RTRIM(COALESCE(AUD_old_PP030MOD,AUD_new_PP030MOD)) ) ),CONCAT( '|PP030PAP=', RTRIM(COALESCE(AUD_old_PP030PAP,AUD_new_PP030PAP)) ) ),CONCAT( '|PP030TOP=', RTRIM(COALESCE(AUD_old_PP030TOP,AUD_new_PP030TOP)) ) ),'|' ),AUD_FPP030_UBT,AUD_FPP030_UBU,AUD_FPP030_UBM,AUD_FPP030_UBP,AUD_FPP030_UBR,AUD_FPP030_UAs,AUD_FPP030_UBC,AUD_FPP030_UBA,AUD_FPP030_UBS, '', 'BANTOTAL', '', '', '',AUD_FPP030_UT FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP010PRD',AUD_old_PP010PRD,AUD_new_PP010PRD FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP010PRD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP016COD',AUD_old_PP016COD,AUD_new_PP016COD FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP016COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP016TIPO',AUD_old_PP016TIPO,AUD_new_PP016TIPO FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP016TIPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP017PAR',AUD_old_PP017PAR,AUD_new_PP017PAR FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP017PAR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030CAR1',AUD_old_PP030CAR1,AUD_new_PP030CAR1 FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030CAR1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030CAR2',AUD_old_PP030CAR2,AUD_new_PP030CAR2 FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030CAR2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030CAR3',AUD_old_PP030CAR3,AUD_new_PP030CAR3 FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030CAR3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030DSC',AUD_old_PP030DSC,AUD_new_PP030DSC FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030EMP',AUD_old_PP030EMP,AUD_new_PP030EMP FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT
 EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030EMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030FEC1',TO_CHAR(AUD_old_PP030FEC1,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP030FEC1,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030FEC1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030FEC2',TO_CHAR(AUD_old_PP030FEC2,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP030FEC2,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030FEC2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030FEC3',TO_CHAR(AUD_old_PP030FEC3,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP030FEC3,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030FEC3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030IMP1',AUD_old_PP030IMP1,AUD_new_PP030IMP1 FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030IMP1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030IMP2',AUD_old_PP030IMP2,AUD_new_PP030IMP2 FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030IMP2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030IMP3',AUD_old_PP030IMP3,AUD_new_PP030IMP3 FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030IMP3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030MDA',AUD_old_PP030MDA,AUD_new_PP030MDA FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030MDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030MOD',AUD_old_PP030MOD,AUD_new_PP030MOD FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030MODI',AUD_old_PP030MODI,AUD_new_PP030MODI FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030MODI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030NUM1',AUD_old_PP030NUM1,AUD_new_PP030NUM1 FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030NUM1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030NUM2',AUD_old_PP030NUM2,AUD_new_PP030NUM2 FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030NUM2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030NUM3',AUD_old_PP030NUM3,AUD_new_PP030NUM3 FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030NUM3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030ORD',AUD_old_PP030ORD,AUD_new_PP030ORD FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn
 AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030ORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030PAP',AUD_old_PP030PAP,AUD_new_PP030PAP FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030PAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP030_UOn,AUD_FPP030_GuidKey,'PP030TOP',AUD_old_PP030TOP,AUD_new_PP030TOP FROM BANTPROD.AUD_FPP030_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey AND AUDMstFld = 'PP030TOP'); DELETE FROM AUD_FPP030_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP030_UOn AND AUDMstId = AUD_FPP030_GuidKey);  COMMIT ;END IF;END;
/

