CREATE OR REPLACE PROCEDURE AUD_C_FPP015_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FPP015_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'FPP015',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PP010PRD=', RTRIM(COALESCE(AUD_old_PP010PRD,AUD_new_PP010PRD)) ),CONCAT( '|PP015COD=', RTRIM(COALESCE(AUD_old_PP015COD,AUD_new_PP015COD)) ) ),CONCAT( '|PP015EMP=', RTRIM(COALESCE(AUD_old_PP015EMP,AUD_new_PP015EMP)) ) ),CONCAT( '|PP015TIPO=', RTRIM(COALESCE(AUD_old_PP015TIPO,AUD_new_PP015TIPO)) ) ),CONCAT( '|PP017PAR=', RTRIM(COALESCE(AUD_old_PP017PAR,AUD_new_PP017PAR)) ) ),'|' ),AUD_FPP015_UBT,AUD_FPP015_UBU,AUD_FPP015_UBM,AUD_FPP015_UBP,AUD_FPP015_UBR,AUD_FPP015_UAs,AUD_FPP015_UBC,AUD_FPP015_UBA,AUD_FPP015_UBS, '', 'BANTOTAL', '', '', '',AUD_FPP015_UT FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP010PRD',AUD_old_PP010PRD,AUD_new_PP010PRD FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP010PRD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015CAR1',AUD_old_PP015CAR1,AUD_new_PP015CAR1 FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015CAR1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015CAR2',AUD_old_PP015CAR2,AUD_new_PP015CAR2 FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015CAR2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015CAR3',AUD_old_PP015CAR3,AUD_new_PP015CAR3 FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015CAR3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015COD',AUD_old_PP015COD,AUD_new_PP015COD FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015DSC',AUD_old_PP015DSC,AUD_new_PP015DSC FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015EMP',AUD_old_PP015EMP,AUD_new_PP015EMP FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015EMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015FEC1',TO_CHAR(AUD_old_PP015FEC1,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP015FEC1,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015FEC1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015FEC2',TO_CHAR(AUD_old_PP015FEC2,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP015FEC2,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015FEC2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015FEC3',TO_CHAR(AUD_old_PP015FEC3,'YYYY-
MM-DD'),TO_CHAR(AUD_new_PP015FEC3,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015FEC3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015IMP1',AUD_old_PP015IMP1,AUD_new_PP015IMP1 FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015IMP1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015IMP2',AUD_old_PP015IMP2,AUD_new_PP015IMP2 FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015IMP2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015IMP3',AUD_old_PP015IMP3,AUD_new_PP015IMP3 FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015IMP3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015MOD',AUD_old_PP015MOD,AUD_new_PP015MOD FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015NUM1',AUD_old_PP015NUM1,AUD_new_PP015NUM1 FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015NUM1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015NUM2',AUD_old_PP015NUM2,AUD_new_PP015NUM2 FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015NUM2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015NUM3',AUD_old_PP015NUM3,AUD_new_PP015NUM3 FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015NUM3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015ORD',AUD_old_PP015ORD,AUD_new_PP015ORD FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015ORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP015TIPO',AUD_old_PP015TIPO,AUD_new_PP015TIPO FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP015TIPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP015_UOn,AUD_FPP015_GuidKey,'PP017PAR',AUD_old_PP017PAR,AUD_new_PP017PAR FROM BANTPROD.AUD_FPP015_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey AND AUDMstFld = 'PP017PAR'); DELETE FROM AUD_FPP015_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP015_UOn AND AUDMstId = AUD_FPP015_GuidKey);  COMMIT ;END IF;END;
/

