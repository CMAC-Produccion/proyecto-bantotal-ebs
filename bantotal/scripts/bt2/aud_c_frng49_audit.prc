CREATE OR REPLACE PROCEDURE AUD_C_FRNG49_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FRNG49_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FRNG49_UOn,AUD_FRNG49_GuidKey,'FRNG49',CONCAT( CONCAT( '|RNG49COD=', RTRIM(COALESCE(AUD_old_RNG49COD,AUD_new_RNG49COD)) ),'|' ),AUD_FRNG49_UBT,AUD_FRNG49_UBU,AUD_FRNG49_UBM,AUD_FRNG49_UBP,AUD_FRNG49_UBR,AUD_FRNG49_UAs,AUD_FRNG49_UBC,AUD_FRNG49_UBA,AUD_FRNG49_UBS, '', 'BANTOTAL', '', '', '',AUD_FRNG49_UT FROM BANTPROD.AUD_FRNG49_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG49_UOn AND AUDMstId = AUD_FRNG49_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG49_UOn,AUD_FRNG49_GuidKey,'RNG49ATR',AUD_old_RNG49ATR,AUD_new_RNG49ATR FROM BANTPROD.AUD_FRNG49_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG49_UOn AND AUDMstId = AUD_FRNG49_GuidKey AND AUDMstFld = 'RNG49ATR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG49_UOn,AUD_FRNG49_GuidKey,'RNG49CNT',AUD_old_RNG49CNT,AUD_new_RNG49CNT FROM BANTPROD.AUD_FRNG49_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG49_UOn AND AUDMstId = AUD_FRNG49_GuidKey AND AUDMstFld = 'RNG49CNT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG49_UOn,AUD_FRNG49_GuidKey,'RNG49COD',AUD_old_RNG49COD,AUD_new_RNG49COD FROM BANTPROD.AUD_FRNG49_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG49_UOn AND AUDMstId = AUD_FRNG49_GuidKey AND AUDMstFld = 'RNG49COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG49_UOn,AUD_FRNG49_GuidKey,'RNG49DSC',AUD_old_RNG49DSC,AUD_new_RNG49DSC FROM BANTPROD.AUD_FRNG49_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG49_UOn AND AUDMstId = AUD_FRNG49_GuidKey AND AUDMstFld = 'RNG49DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG49_UOn,AUD_FRNG49_GuidKey,'RNG49HIS',AUD_old_RNG49HIS,AUD_new_RNG49HIS FROM BANTPROD.AUD_FRNG49_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG49_UOn AND AUDMstId = AUD_FRNG49_GuidKey AND AUDMstFld = 'RNG49HIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG49_UOn,AUD_FRNG49_GuidKey,'RNG49ULT',AUD_old_RNG49ULT,AUD_new_RNG49ULT FROM BANTPROD.AUD_FRNG49_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG49_UOn AND AUDMstId = AUD_FRNG49_GuidKey AND AUDMstFld = 'RNG49ULT'); DELETE FROM AUD_FRNG49_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG49_UOn AND AUDMstId = AUD_FRNG49_GuidKey);  COMMIT ;END IF;END;
/

