CREATE OR REPLACE PROCEDURE AUD_C_PRFM00_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_PRFM00_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFM00',CONCAT( CONCAT( CONCAT( CONCAT( '|MODULO=', RTRIM(COALESCE(AUD_old_MODULO,AUD_new_MODULO)) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|PRFGCOD=', RTRIM(COALESCE(AUD_old_PRFGCOD,AUD_new_PRFGCOD)) ) ),'|' ),AUD_PRFM00_UBT,AUD_PRFM00_UBU,AUD_PRFM00_UBM,AUD_PRFM00_UBP,AUD_PRFM00_UBR,AUD_PRFM00_UAs,AUD_PRFM00_UBC,AUD_PRFM00_UBA,AUD_PRFM00_UBS, '', 'BANTOTAL', '', '', '',AUD_PRFM00_UT FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'MODULO',AUD_old_MODULO,AUD_new_MODULO FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'MODULO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFGCOD',AUD_old_PRFGCOD,AUD_new_PRFGCOD FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFMCONF',AUD_old_PRFMCONF,AUD_new_PRFMCONF FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFMCONF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFMFECALT',TO_CHAR(AUD_old_PRFMFECALT,'YYYY-MM-DD'),TO_CHAR(AUD_new_PRFMFECALT,'YYYY-MM-DD') FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFMFECALT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFMFECIMP',TO_CHAR(AUD_old_PRFMFECIMP,'YYYY-MM-DD'),TO_CHAR(AUD_new_PRFMFECIMP,'YYYY-MM-DD') FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFMFECIMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFMIMPAC',AUD_old_PRFMIMPAC,AUD_new_PRFMIMPAC FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFMIMPAC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFMING',AUD_old_PRFMING,AUD_new_PRFMING FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFMING'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFMPROD',AUD_old_PRFMPROD,AUD_new_PRFMPROD FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFMPROD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFMSN1',AUD_old_PRFMSN1,AUD_new_PRFMSN1 FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFMSN1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_U
On,AUD_PRFM00_GuidKey,'PRFMSN2',AUD_old_PRFMSN2,AUD_new_PRFMSN2 FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFMSN2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFMSN3',AUD_old_PRFMSN3,AUD_new_PRFMSN3 FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFMSN3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFMSUP',AUD_old_PRFMSUP,AUD_new_PRFMSUP FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFMSUP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFM00_UOn,AUD_PRFM00_GuidKey,'PRFMUSER',AUD_old_PRFMUSER,AUD_new_PRFMUSER FROM BANTPROD.AUD_PRFM00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey AND AUDMstFld = 'PRFMUSER'); DELETE FROM AUD_PRFM00_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_PRFM00_UOn AND AUDMstId = AUD_PRFM00_GuidKey);  COMMIT ;END IF;END;
/

