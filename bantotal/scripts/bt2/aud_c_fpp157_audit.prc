CREATE OR REPLACE PROCEDURE AUD_C_FPP157_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FPP157_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'FPP157',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PP157CAR=', RTRIM(COALESCE(AUD_old_PP157CAR,AUD_new_PP157CAR)) ),CONCAT( '|PP157CORR=', RTRIM(COALESCE(AUD_old_PP157CORR,AUD_new_PP157CORR)) ) ),CONCAT( '|PP157EMP=', RTRIM(COALESCE(AUD_old_PP157EMP,AUD_new_PP157EMP)) ) ),CONCAT( '|PP157EST=', RTRIM(COALESCE(AUD_old_PP157EST,AUD_new_PP157EST)) ) ),CONCAT( '|PP157MDA=', RTRIM(COALESCE(AUD_old_PP157MDA,AUD_new_PP157MDA)) ) ),CONCAT( '|PP157MOD=', RTRIM(COALESCE(AUD_old_PP157MOD,AUD_new_PP157MOD)) ) ),CONCAT( '|PP157NUM=', RTRIM(COALESCE(AUD_old_PP157NUM,AUD_new_PP157NUM)) ) ),CONCAT( '|PP157PAP=', RTRIM(COALESCE(AUD_old_PP157PAP,AUD_new_PP157PAP)) ) ),CONCAT( '|PP157TOP=', RTRIM(COALESCE(AUD_old_PP157TOP,AUD_new_PP157TOP)) ) ),'|' ),AUD_FPP157_UBT,AUD_FPP157_UBU,AUD_FPP157_UBM,AUD_FPP157_UBP,AUD_FPP157_UBR,AUD_FPP157_UAs,AUD_FPP157_UBC,AUD_FPP157_UBA,AUD_FPP157_UBS, '', 'BANTOTAL', '', '', '',AUD_FPP157_UT FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157AUX1',AUD_old_PP157AUX1,AUD_new_PP157AUX1 FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157AUX1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157AUX2',AUD_old_PP157AUX2,AUD_new_PP157AUX2 FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157AUX2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157AUX3',TO_CHAR(AUD_old_PP157AUX3,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP157AUX3,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157AUX3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157AUX4',AUD_old_PP157AUX4,AUD_new_PP157AUX4 FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157AUX4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157CAR',AUD_old_PP157CAR,AUD_new_PP157CAR FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157CAR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157CORR',AUD_old_PP157CORR,AUD_new_PP157CORR FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157CORR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157EMP',AUD_old_PP157EMP,AUD_new_PP157EMP FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157EMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157EST',AUD_old_PP157EST,AUD_new_PP157EST FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157EST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157MDA',AUD_old_PP157MDA,AUD_new_P
P157MDA FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157MDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157MO',AUD_old_PP157MO,AUD_new_PP157MO FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157MO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157MOD',AUD_old_PP157MOD,AUD_new_PP157MOD FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157NUM',AUD_old_PP157NUM,AUD_new_PP157NUM FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157NUM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157PAP',AUD_old_PP157PAP,AUD_new_PP157PAP FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157PAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157TOP',AUD_old_PP157TOP,AUD_new_PP157TOP FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157TOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP157_UOn,AUD_FPP157_GuidKey,'PP157TRN',AUD_old_PP157TRN,AUD_new_PP157TRN FROM BANTPROD.AUD_FPP157_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey AND AUDMstFld = 'PP157TRN'); DELETE FROM AUD_FPP157_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP157_UOn AND AUDMstId = AUD_FPP157_GuidKey);  COMMIT ;END IF;END;
/

