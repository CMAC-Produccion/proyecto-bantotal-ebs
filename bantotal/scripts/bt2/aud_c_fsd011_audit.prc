CREATE OR REPLACE PROCEDURE AUD_C_FSD011_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD011_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'FSD011',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ),CONCAT( '|SCCTA=', RTRIM(COALESCE(AUD_old_SCCTA,AUD_new_SCCTA)) ) ),CONCAT( '|SCMDA=', RTRIM(COALESCE(AUD_old_SCMDA,AUD_new_SCMDA)) ) ),CONCAT( '|SCOPER=', RTRIM(COALESCE(AUD_old_SCOPER,AUD_new_SCOPER)) ) ),CONCAT( '|SCPAP=', RTRIM(COALESCE(AUD_old_SCPAP,AUD_new_SCPAP)) ) ),CONCAT( '|SCRUB=', RTRIM(COALESCE(AUD_old_SCRUB,AUD_new_SCRUB)) ) ),CONCAT( '|SCSBOP=', RTRIM(COALESCE(AUD_old_SCSBOP,AUD_new_SCSBOP)) ) ),CONCAT( '|SCSUC=', RTRIM(COALESCE(AUD_old_SCSUC,AUD_new_SCSUC)) ) ),CONCAT( '|SCTOPE=', RTRIM(COALESCE(AUD_old_SCTOPE,AUD_new_SCTOPE)) ) ),'|' ),AUD_FSD011_UBT,AUD_FSD011_UBU,AUD_FSD011_UBM,AUD_FSD011_UBP,AUD_FSD011_UBR,AUD_FSD011_UAs,AUD_FSD011_UBC,AUD_FSD011_UBA,AUD_FSD011_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD011_UT FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCCAP',AUD_old_SCCAP,AUD_new_SCCAP FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCCAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCCC',AUD_old_SCCC,AUD_new_SCCC FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCCC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCCTA',AUD_old_SCCTA,AUD_new_SCCTA FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCFCON',TO_CHAR(AUD_old_SCFCON,'YYYY-MM-DD'),TO_CHAR(AUD_new_SCFCON,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCFCON'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCFULM',TO_CHAR(AUD_old_SCFULM,'YYYY-MM-DD'),TO_CHAR(AUD_new_SCFULM,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCFULM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCFUNC',AUD_old_SCFUNC,AUD_new_SCFUNC FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCFUNC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCFVAL',TO_CHAR(AUD_old_SCFVAL,'YYYY-MM-DD'),TO_CHAR(AUD_new_SCFVAL,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCFVAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCFVTO',TO_CHAR(AUD_old_SCFVTO,'YYYY-MM-DD'),TO_CHAR(AUD_new_SCFVTO,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXIS
TS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCFVTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCGRU',AUD_old_SCGRU,AUD_new_SCGRU FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCGRU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCMDA',AUD_old_SCMDA,AUD_new_SCMDA FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCMOD',AUD_old_SCMOD,AUD_new_SCMOD FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCOPER',AUD_old_SCOPER,AUD_new_SCOPER FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCOPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCPAP',AUD_old_SCPAP,AUD_new_SCPAP FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCPLZO',AUD_old_SCPLZO,AUD_new_SCPLZO FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCPLZO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCPZO',AUD_old_SCPZO,AUD_new_SCPZO FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCPZO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCRUB',AUD_old_SCRUB,AUD_new_SCRUB FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCRUB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCSBOP',AUD_old_SCSBOP,AUD_new_SCSBOP FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCSBOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCSDO',AUD_old_SCSDO,AUD_new_SCSDO FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCSDO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCSDOH',AUD_old_SCSDOH,AUD_new_SCSDOH FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCSDOH'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCSEGM',AUD_old_SCSEGM,AUD_new_SCSEGM FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCSEGM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCSTAT',AUD_old_SCSTAT,AUD_new_SCSTAT FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCSTAT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCSUC',AUD_old_SCSUC,AUD_new_SCSUC FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_Guid
Key AND AUDMstFld = 'SCSUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCTIT',AUD_old_SCTIT,AUD_new_SCTIT FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCTIT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD011_UOn,AUD_FSD011_GuidKey,'SCTOPE',AUD_old_SCTOPE,AUD_new_SCTOPE FROM BANTPROD.AUD_FSD011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey AND AUDMstFld = 'SCTOPE'); DELETE FROM AUD_FSD011_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD011_UOn AND AUDMstId = AUD_FSD011_GuidKey);  COMMIT ;END IF;END;
/

