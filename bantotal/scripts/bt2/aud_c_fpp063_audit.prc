CREATE OR REPLACE PROCEDURE AUD_C_FPP063_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FPP063_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'FPP063',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ),CONCAT( '|PP063INI=', RTRIM(COALESCE(AUD_old_PP063INI,AUD_new_PP063INI)) ) ),CONCAT( '|PP063TIPO=', RTRIM(COALESCE(AUD_old_PP063TIPO,AUD_new_PP063TIPO)) ) ),CONCAT( '|XPREMOD=', RTRIM(COALESCE(AUD_old_XPREMOD,AUD_new_XPREMOD)) ) ),CONCAT( '|XPREMONEDA=', RTRIM(COALESCE(AUD_old_XPREMONEDA,AUD_new_XPREMONEDA)) ) ),CONCAT( '|XPREPAPEL=', RTRIM(COALESCE(AUD_old_XPREPAPEL,AUD_new_XPREPAPEL)) ) ),CONCAT( '|XPRETOPE=', RTRIM(COALESCE(AUD_old_XPRETOPE,AUD_new_XPRETOPE)) ) ),'|' ),AUD_FPP063_UBT,AUD_FPP063_UBU,AUD_FPP063_UBM,AUD_FPP063_UBP,AUD_FPP063_UBR,AUD_FPP063_UAs,AUD_FPP063_UBC,AUD_FPP063_UBA,AUD_FPP063_UBS, '', 'BANTOTAL', '', '', '',AUD_FPP063_UT FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063AUX1',AUD_old_PP063AUX1,AUD_new_PP063AUX1 FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063AUX1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063AUX2',AUD_old_PP063AUX2,AUD_new_PP063AUX2 FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063AUX2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063AUX3',AUD_old_PP063AUX3,AUD_new_PP063AUX3 FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063AUX3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063AUX4',AUD_old_PP063AUX4,AUD_new_PP063AUX4 FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063AUX4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063AUX5',AUD_old_PP063AUX5,AUD_new_PP063AUX5 FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063AUX5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063AUX6',TO_CHAR(AUD_old_PP063AUX6,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP063AUX6,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063AUX6'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063AUX7',AUD_old_PP063AUX7,AUD_new_PP063AUX7 FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063AUX7'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063INI',AUD_old_PP063INI,AUD_new_PP063INI FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063I
NI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063MODAL',AUD_old_PP063MODAL,AUD_new_PP063MODAL FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063MODAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063MTO',AUD_old_PP063MTO,AUD_new_PP063MTO FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063MTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063PORC',AUD_old_PP063PORC,AUD_new_PP063PORC FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063PORC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'PP063TIPO',AUD_old_PP063TIPO,AUD_new_PP063TIPO FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'PP063TIPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'XPREMOD',AUD_old_XPREMOD,AUD_new_XPREMOD FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'XPREMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'XPREMONEDA',AUD_old_XPREMONEDA,AUD_new_XPREMONEDA FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'XPREMONEDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'XPREPAPEL',AUD_old_XPREPAPEL,AUD_new_XPREPAPEL FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'XPREPAPEL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP063_UOn,AUD_FPP063_GuidKey,'XPRETOPE',AUD_old_XPRETOPE,AUD_new_XPRETOPE FROM BANTPROD.AUD_FPP063_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey AND AUDMstFld = 'XPRETOPE'); DELETE FROM AUD_FPP063_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP063_UOn AND AUDMstId = AUD_FPP063_GuidKey);  COMMIT ;END IF;END;
/

