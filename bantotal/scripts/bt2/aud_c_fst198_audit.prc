CREATE OR REPLACE PROCEDURE AUD_C_FST198_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST198_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'FST198',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|TP1COD=', RTRIM(COALESCE(AUD_old_TP1COD,AUD_new_TP1COD)) ),CONCAT( '|TP1COD1=', RTRIM(COALESCE(AUD_old_TP1COD1,AUD_new_TP1COD1)) ) ),CONCAT( '|TP1CORR1=', RTRIM(COALESCE(AUD_old_TP1CORR1,AUD_new_TP1CORR1)) ) ),CONCAT( '|TP1CORR2=', RTRIM(COALESCE(AUD_old_TP1CORR2,AUD_new_TP1CORR2)) ) ),CONCAT( '|TP1CORR3=', RTRIM(COALESCE(AUD_old_TP1CORR3,AUD_new_TP1CORR3)) ) ),'|' ),AUD_FST198_UBT,AUD_FST198_UBU,AUD_FST198_UBM,AUD_FST198_UBP,AUD_FST198_UBR,AUD_FST198_UAs,AUD_FST198_UBC,AUD_FST198_UBA,AUD_FST198_UBS, '', 'BANTOTAL', '', '', '',AUD_FST198_UT FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1COD',AUD_old_TP1COD,AUD_new_TP1COD FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND AUDMstFld = 'TP1COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1COD1',AUD_old_TP1COD1,AUD_new_TP1COD1 FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND AUDMstFld = 'TP1COD1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1CORR1',AUD_old_TP1CORR1,AUD_new_TP1CORR1 FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND AUDMstFld = 'TP1CORR1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1CORR2',AUD_old_TP1CORR2,AUD_new_TP1CORR2 FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND AUDMstFld = 'TP1CORR2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1CORR3',AUD_old_TP1CORR3,AUD_new_TP1CORR3 FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND AUDMstFld = 'TP1CORR3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1DESC',AUD_old_TP1DESC,AUD_new_TP1DESC FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND AUDMstFld = 'TP1DESC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1IMP1',AUD_old_TP1IMP1,AUD_new_TP1IMP1 FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND AUDMstFld = 'TP1IMP1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1IMP2',AUD_old_TP1IMP2,AUD_new_TP1IMP2 FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND AUDMstFld = 'TP1IMP2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1IMP3',AUD_old_TP1IMP3,AUD_new_TP1IMP3 FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND AUDMstFld = 'TP1IMP3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1NRO1',AUD_old_TP1NRO1,AUD_new_TP1NRO1 FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND
AUDMstFld = 'TP1NRO1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1NRO2',AUD_old_TP1NRO2,AUD_new_TP1NRO2 FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND AUDMstFld = 'TP1NRO2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST198_UOn,AUD_FST198_GuidKey,'TP1NRO3',AUD_old_TP1NRO3,AUD_new_TP1NRO3 FROM BANTPROD.AUD_FST198_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey AND AUDMstFld = 'TP1NRO3'); DELETE FROM AUD_FST198_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST198_UOn AND AUDMstId = AUD_FST198_GuidKey);  COMMIT ;END IF;END;
/

