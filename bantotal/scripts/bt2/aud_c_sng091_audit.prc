CREATE OR REPLACE PROCEDURE AUD_C_SNG091_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG091_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG091_UOn,AUD_SNG091_GuidKey,'SNG091',CONCAT( CONCAT( CONCAT( '|SNG001INST=', RTRIM(COALESCE(AUD_old_SNG001INST,AUD_new_SNG001INST)) ),CONCAT( '|SNG091AUT=', RTRIM(COALESCE(AUD_old_SNG091AUT,AUD_new_SNG091AUT)) ) ),'|' ),AUD_SNG091_UBT,AUD_SNG091_UBU,AUD_SNG091_UBM,AUD_SNG091_UBP,AUD_SNG091_UBR,AUD_SNG091_UAs,AUD_SNG091_UBC,AUD_SNG091_UBA,AUD_SNG091_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG091_UT FROM BANTPROD.AUD_SNG091_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG091_UOn AND AUDMstId = AUD_SNG091_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG091_UOn,AUD_SNG091_GuidKey,'SNG001INST',AUD_old_SNG001INST,AUD_new_SNG001INST FROM BANTPROD.AUD_SNG091_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG091_UOn AND AUDMstId = AUD_SNG091_GuidKey AND AUDMstFld = 'SNG001INST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG091_UOn,AUD_SNG091_GuidKey,'SNG090PQT',AUD_old_SNG090PQT,AUD_new_SNG090PQT FROM BANTPROD.AUD_SNG091_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG091_UOn AND AUDMstId = AUD_SNG091_GuidKey AND AUDMstFld = 'SNG090PQT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG091_UOn,AUD_SNG091_GuidKey,'SNG091AUT',AUD_old_SNG091AUT,AUD_new_SNG091AUT FROM BANTPROD.AUD_SNG091_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG091_UOn AND AUDMstId = AUD_SNG091_GuidKey AND AUDMstFld = 'SNG091AUT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG091_UOn,AUD_SNG091_GuidKey,'SNG091NUM',AUD_old_SNG091NUM,AUD_new_SNG091NUM FROM BANTPROD.AUD_SNG091_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG091_UOn AND AUDMstId = AUD_SNG091_GuidKey AND AUDMstFld = 'SNG091NUM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG091_UOn,AUD_SNG091_GuidKey,'SNG091RES',AUD_old_SNG091RES,AUD_new_SNG091RES FROM BANTPROD.AUD_SNG091_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG091_UOn AND AUDMstId = AUD_SNG091_GuidKey AND AUDMstFld = 'SNG091RES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG091_UOn,AUD_SNG091_GuidKey,'SNG091TPO',AUD_old_SNG091TPO,AUD_new_SNG091TPO FROM BANTPROD.AUD_SNG091_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG091_UOn AND AUDMstId = AUD_SNG091_GuidKey AND AUDMstFld = 'SNG091TPO'); DELETE FROM AUD_SNG091_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG091_UOn AND AUDMstId = AUD_SNG091_GuidKey);  COMMIT ;END IF;END;
/

