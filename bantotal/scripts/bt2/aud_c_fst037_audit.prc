CREATE OR REPLACE PROCEDURE AUD_C_FST037_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST037_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'FST037',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|INSCOD=', RTRIM(COALESCE(AUD_old_INSCOD,AUD_new_INSCOD)) ),CONCAT( '|INSORD=', RTRIM(COALESCE(AUD_old_INSORD,AUD_new_INSORD)) ) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|TRMOD=', RTRIM(COALESCE(AUD_old_TRMOD,AUD_new_TRMOD)) ) ),CONCAT( '|TRNRO=', RTRIM(COALESCE(AUD_old_TRNRO,AUD_new_TRNRO)) ) ),CONCAT( '|TRORD=', RTRIM(COALESCE(AUD_old_TRORD,AUD_new_TRORD)) ) ),'|' ),AUD_FST037_UBT,AUD_FST037_UBU,AUD_FST037_UBM,AUD_FST037_UBP,AUD_FST037_UBR,AUD_FST037_UAs,AUD_FST037_UBC,AUD_FST037_UBA,AUD_FST037_UBS, '', 'BANTOTAL', '', '', '',AUD_FST037_UT FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'INCODM',AUD_old_INCODM,AUD_new_INCODM FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'INCODM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'INSAPL',AUD_old_INSAPL,AUD_new_INSAPL FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'INSAPL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'INSCOD',AUD_old_INSCOD,AUD_new_INSCOD FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'INSCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'INSCOM',AUD_old_INSCOM,AUD_new_INSCOM FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'INSCOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'INSCTA',AUD_old_INSCTA,AUD_new_INSCTA FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'INSCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'INSMOD',AUD_old_INSMOD,AUD_new_INSMOD FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'INSMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'INSOBL',AUD_old_INSOBL,AUD_new_INSOBL FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'INSOBL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'INSORD',AUD_old_INSORD,AUD_new_INSORD FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'INSORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'INSPER',AUD_old_INSPER,AUD_new_INSPER FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'INSPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'INSRUB',AUD_old_INSRUB,AUD_new_INSRUB FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND A
UDMstFld = 'INSRUB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'TRMOD',AUD_old_TRMOD,AUD_new_TRMOD FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'TRMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'TRNRO',AUD_old_TRNRO,AUD_new_TRNRO FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'TRNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST037_UOn,AUD_FST037_GuidKey,'TRORD',AUD_old_TRORD,AUD_new_TRORD FROM BANTPROD.AUD_FST037_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey AND AUDMstFld = 'TRORD'); DELETE FROM AUD_FST037_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST037_UOn AND AUDMstId = AUD_FST037_GuidKey);  COMMIT ;END IF;END;
/

