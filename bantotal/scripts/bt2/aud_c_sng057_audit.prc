CREATE OR REPLACE PROCEDURE AUD_C_SNG057_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG057_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG057_UOn,AUD_SNG057_GuidKey,'SNG057',CONCAT( CONCAT( CONCAT( '|SNG055EMP=', RTRIM(COALESCE(AUD_old_SNG055EMP,AUD_new_SNG055EMP)) ),CONCAT( '|SNG057USR=', RTRIM(COALESCE(AUD_old_SNG057USR,AUD_new_SNG057USR)) ) ),'|' ),AUD_SNG057_UBT,AUD_SNG057_UBU,AUD_SNG057_UBM,AUD_SNG057_UBP,AUD_SNG057_UBR,AUD_SNG057_UAs,AUD_SNG057_UBC,AUD_SNG057_UBA,AUD_SNG057_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG057_UT FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG057_UOn,AUD_SNG057_GuidKey,'SNG055CAR',AUD_old_SNG055CAR,AUD_new_SNG055CAR FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey AND AUDMstFld = 'SNG055CAR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG057_UOn,AUD_SNG057_GuidKey,'SNG055EMP',AUD_old_SNG055EMP,AUD_new_SNG055EMP FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey AND AUDMstFld = 'SNG055EMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG057_UOn,AUD_SNG057_GuidKey,'SNG057AUT',AUD_old_SNG057AUT,AUD_new_SNG057AUT FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey AND AUDMstFld = 'SNG057AUT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG057_UOn,AUD_SNG057_GuidKey,'SNG057FIN',TO_CHAR(AUD_old_SNG057FIN,'YYYY-MM-DD'),TO_CHAR(AUD_new_SNG057FIN,'YYYY-MM-DD') FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey AND AUDMstFld = 'SNG057FIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG057_UOn,AUD_SNG057_GuidKey,'SNG057INI',TO_CHAR(AUD_old_SNG057INI,'YYYY-MM-DD'),TO_CHAR(AUD_new_SNG057INI,'YYYY-MM-DD') FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey AND AUDMstFld = 'SNG057INI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG057_UOn,AUD_SNG057_GuidKey,'SNG057JEF',AUD_old_SNG057JEF,AUD_new_SNG057JEF FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey AND AUDMstFld = 'SNG057JEF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG057_UOn,AUD_SNG057_GuidKey,'SNG057PRC',AUD_old_SNG057PRC,AUD_new_SNG057PRC FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey AND AUDMstFld = 'SNG057PRC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG057_UOn,AUD_SNG057_GuidKey,'SNG057SUP',AUD_old_SNG057SUP,AUD_new_SNG057SUP FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey AND AUDMstFld = 'SNG057SUP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG057_UOn,AUD_SNG057_GuidKey,'SNG057TSK',AUD_old_SNG057TSK,AUD_new_SNG057TSK FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey AND AUDMstFld = 'SNG057TSK'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG057_UOn,AUD_SNG057_GuidKey,'SNG057USR',AUD_old_SNG057USR,AUD_new_SNG057USR FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey AND AUDMstFld = 'SNG057USR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG057_UOn,AUD_SN
G057_GuidKey,'SNG057WKF',AUD_old_SNG057WKF,AUD_new_SNG057WKF FROM BANTPROD.AUD_SNG057_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey AND AUDMstFld = 'SNG057WKF'); DELETE FROM AUD_SNG057_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG057_UOn AND AUDMstId = AUD_SNG057_GuidKey);  COMMIT ;END IF;END;
/

