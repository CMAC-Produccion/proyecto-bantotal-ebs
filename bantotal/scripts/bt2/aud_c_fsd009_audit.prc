CREATE OR REPLACE PROCEDURE AUD_C_FSD009_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD009_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD009_UOn,AUD_FSD009_GuidKey,'FSD009',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|CTNRO=', RTRIM(COALESCE(AUD_old_CTNRO,AUD_new_CTNRO)) ),CONCAT( '|GRNRO=', RTRIM(COALESCE(AUD_old_GRNRO,AUD_new_GRNRO)) ) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|TGCOD=', RTRIM(COALESCE(AUD_old_TGCOD,AUD_new_TGCOD)) ) ),'|' ),AUD_FSD009_UBT,AUD_FSD009_UBU,AUD_FSD009_UBM,AUD_FSD009_UBP,AUD_FSD009_UBR,AUD_FSD009_UAs,AUD_FSD009_UBC,AUD_FSD009_UBA,AUD_FSD009_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD009_UT FROM BANTPROD.AUD_FSD009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD009_UOn AND AUDMstId = AUD_FSD009_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD009_UOn,AUD_FSD009_GuidKey,'CTNRO',AUD_old_CTNRO,AUD_new_CTNRO FROM BANTPROD.AUD_FSD009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD009_UOn AND AUDMstId = AUD_FSD009_GuidKey AND AUDMstFld = 'CTNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD009_UOn,AUD_FSD009_GuidKey,'GRINCOD',AUD_old_GRINCOD,AUD_new_GRINCOD FROM BANTPROD.AUD_FSD009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD009_UOn AND AUDMstId = AUD_FSD009_GuidKey AND AUDMstFld = 'GRINCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD009_UOn,AUD_FSD009_GuidKey,'GRNRO',AUD_old_GRNRO,AUD_new_GRNRO FROM BANTPROD.AUD_FSD009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD009_UOn AND AUDMstId = AUD_FSD009_GuidKey AND AUDMstFld = 'GRNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD009_UOn,AUD_FSD009_GuidKey,'GRPORC',AUD_old_GRPORC,AUD_new_GRPORC FROM BANTPROD.AUD_FSD009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD009_UOn AND AUDMstId = AUD_FSD009_GuidKey AND AUDMstFld = 'GRPORC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD009_UOn,AUD_FSD009_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSD009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD009_UOn AND AUDMstId = AUD_FSD009_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD009_UOn,AUD_FSD009_GuidKey,'TGCOD',AUD_old_TGCOD,AUD_new_TGCOD FROM BANTPROD.AUD_FSD009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD009_UOn AND AUDMstId = AUD_FSD009_GuidKey AND AUDMstFld = 'TGCOD'); DELETE FROM AUD_FSD009_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD009_UOn AND AUDMstId = AUD_FSD009_GuidKey);  COMMIT ;END IF;END;
/

