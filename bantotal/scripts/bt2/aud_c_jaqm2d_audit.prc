CREATE OR REPLACE PROCEDURE AUD_C_JAQM2D_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_JAQM2D_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2D',CONCAT( CONCAT( CONCAT( '|JAQM2DCOD=', RTRIM(COALESCE(AUD_old_JAQM2DCOD,AUD_new_JAQM2DCOD)) ),CONCAT( '|JAQM2DINS=', RTRIM(COALESCE(AUD_old_JAQM2DINS,AUD_new_JAQM2DINS)) ) ),'|' ),AUD_JAQM2D_UBT,AUD_JAQM2D_UBU,AUD_JAQM2D_UBM,AUD_JAQM2D_UBP,AUD_JAQM2D_UBR,AUD_JAQM2D_UAs,AUD_JAQM2D_UBC,AUD_JAQM2D_UBA,AUD_JAQM2D_UBS, '', 'BANTOTAL', '', '', '',AUD_JAQM2D_UT FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAC1',AUD_old_JAQM2DAC1,AUD_new_JAQM2DAC1 FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAC1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAC2',AUD_old_JAQM2DAC2,AUD_new_JAQM2DAC2 FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAC2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAC3',AUD_old_JAQM2DAC3,AUD_new_JAQM2DAC3 FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAC3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAD1',TO_CHAR(AUD_old_JAQM2DAD1,'YYYY-MM-DD'),TO_CHAR(AUD_new_JAQM2DAD1,'YYYY-MM-DD') FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAD1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAD2',TO_CHAR(AUD_old_JAQM2DAD2,'YYYY-MM-DD'),TO_CHAR(AUD_new_JAQM2DAD2,'YYYY-MM-DD') FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAD2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAD3',TO_CHAR(AUD_old_JAQM2DAD3,'YYYY-MM-DD'),TO_CHAR(AUD_new_JAQM2DAD3,'YYYY-MM-DD') FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAD3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAI1',AUD_old_JAQM2DAI1,AUD_new_JAQM2DAI1 FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAI1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAI2',AUD_old_JAQM2DAI2,AUD_new_JAQM2DAI2 FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAI2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAI3',AUD_old_JAQM2DAI3,AUD_new_JAQM2DAI3 FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAI3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAN1',AUD_old_JAQM2DAN1,AUD_new_JAQM2DAN1 FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAN1'); INSERT INTO
BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAN2',AUD_old_JAQM2DAN2,AUD_new_JAQM2DAN2 FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAN2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DAN3',AUD_old_JAQM2DAN3,AUD_new_JAQM2DAN3 FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DAN3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DANA',AUD_old_JAQM2DANA,AUD_new_JAQM2DANA FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DANA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DCOD',AUD_old_JAQM2DCOD,AUD_new_JAQM2DCOD FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DCTA',AUD_old_JAQM2DCTA,AUD_new_JAQM2DCTA FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DEST',AUD_old_JAQM2DEST,AUD_new_JAQM2DEST FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DEST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DFEC',TO_CHAR(AUD_old_JAQM2DFEC,'YYYY-MM-DD'),TO_CHAR(AUD_new_JAQM2DFEC,'YYYY-MM-DD') FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DFEC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DFRE',AUD_old_JAQM2DFRE,AUD_new_JAQM2DFRE FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DFRE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DHRA',AUD_old_JAQM2DHRA,AUD_new_JAQM2DHRA FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DHRA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DINS',AUD_old_JAQM2DINS,AUD_new_JAQM2DINS FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DINS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DMON',AUD_old_JAQM2DMON,AUD_new_JAQM2DMON FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DMON'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DNCT',AUD_old_JAQM2DNCT,AUD_new_JAQM2DNCT FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DNCT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DNOM',AUD_old_JAQM2DNOM,AUD_new_JAQM2DNOM FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DNOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQM2D_UOn,AUD_JAQM2D_GuidKey,'JAQM2DOGR',AUD_old_JAQM2DOGR,AUD_new_JAQM2DOGR FROM BANTPROD.AUD_JAQM2D_AUDIT WHERE NOT E
XISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey AND AUDMstFld = 'JAQM2DOGR'); DELETE FROM AUD_JAQM2D_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_JAQM2D_UOn AND AUDMstId = AUD_JAQM2D_GuidKey);  COMMIT ;END IF;END;
/

