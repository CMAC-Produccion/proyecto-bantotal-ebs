CREATE OR REPLACE PROCEDURE AUD_C_FRNG47_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FRNG47_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FRNG47_UOn,AUD_FRNG47_GuidKey,'FRNG47',CONCAT( CONCAT( '|RNG47COD=', RTRIM(COALESCE(AUD_old_RNG47COD,AUD_new_RNG47COD)) ),'|' ),AUD_FRNG47_UBT,AUD_FRNG47_UBU,AUD_FRNG47_UBM,AUD_FRNG47_UBP,AUD_FRNG47_UBR,AUD_FRNG47_UAs,AUD_FRNG47_UBC,AUD_FRNG47_UBA,AUD_FRNG47_UBS, '', 'BANTOTAL', '', '', '',AUD_FRNG47_UT FROM BANTPROD.AUD_FRNG47_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG47_UOn AND AUDMstId = AUD_FRNG47_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG47_UOn,AUD_FRNG47_GuidKey,'RNG47COD',AUD_old_RNG47COD,AUD_new_RNG47COD FROM BANTPROD.AUD_FRNG47_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG47_UOn AND AUDMstId = AUD_FRNG47_GuidKey AND AUDMstFld = 'RNG47COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG47_UOn,AUD_FRNG47_GuidKey,'RNG47DSC',AUD_old_RNG47DSC,AUD_new_RNG47DSC FROM BANTPROD.AUD_FRNG47_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG47_UOn AND AUDMstId = AUD_FRNG47_GuidKey AND AUDMstFld = 'RNG47DSC'); DELETE FROM AUD_FRNG47_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG47_UOn AND AUDMstId = AUD_FRNG47_GuidKey);  COMMIT ;END IF;END;
/

