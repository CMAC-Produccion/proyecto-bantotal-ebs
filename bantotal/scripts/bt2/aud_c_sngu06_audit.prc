CREATE OR REPLACE PROCEDURE AUD_C_SNGU06_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNGU06_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|SNGU02PGC=', RTRIM(COALESCE(AUD_old_SNGU02PGC,AUD_new_SNGU02PGC)) ),CONCAT( '|SNGU02USR=', RTRIM(COALESCE(AUD_old_SNGU02USR,AUD_new_SNGU02USR)) ) ),CONCAT( '|SNGU06COL=', RTRIM(COALESCE(AUD_old_SNGU06COL,AUD_new_SNGU06COL)) ) ),CONCAT( '|SNGU06DEP=', RTRIM(COALESCE(AUD_old_SNGU06DEP,AUD_new_SNGU06DEP)) ) ),CONCAT( '|SNGU06LOC=', RTRIM(COALESCE(AUD_old_SNGU06LOC,AUD_new_SNGU06LOC)) ) ),'|' ),AUD_SNGU06_UBT,AUD_SNGU06_UBU,AUD_SNGU06_UBM,AUD_SNGU06_UBP,AUD_SNGU06_UBR,AUD_SNGU06_UAs,AUD_SNGU06_UBC,AUD_SNGU06_UBA,AUD_SNGU06_UBS, '', 'BANTOTAL', '', '', '',AUD_SNGU06_UT FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU02PGC',AUD_old_SNGU02PGC,AUD_new_SNGU02PGC FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU02PGC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU02USR',AUD_old_SNGU02USR,AUD_new_SNGU02USR FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU02USR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06AU1',AUD_old_SNGU06AU1,AUD_new_SNGU06AU1 FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU06AU1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06AU2',AUD_old_SNGU06AU2,AUD_new_SNGU06AU2 FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU06AU2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06AU3',TO_CHAR(AUD_old_SNGU06AU3,'YYYY-MM-DD'),TO_CHAR(AUD_new_SNGU06AU3,'YYYY-MM-DD') FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU06AU3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06AU4',TO_CHAR(AUD_old_SNGU06AU4,'YYYY-MM-DD'),TO_CHAR(AUD_new_SNGU06AU4,'YYYY-MM-DD') FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU06AU4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06AU5',AUD_old_SNGU06AU5,AUD_new_SNGU06AU5 FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU06AU5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06AU6',AUD_old_SNGU06AU6,AUD_new_SNGU06AU6 FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU06AU6'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06AU7',AUD_old_SNGU06AU7,AUD_new_SNGU06AU7 FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU06AU7'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06AU8',AUD_
old_SNGU06AU8,AUD_new_SNGU06AU8 FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU06AU8'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06COL',AUD_old_SNGU06COL,AUD_new_SNGU06COL FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU06COL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06DEP',AUD_old_SNGU06DEP,AUD_new_SNGU06DEP FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU06DEP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGU06_UOn,AUD_SNGU06_GuidKey,'SNGU06LOC',AUD_old_SNGU06LOC,AUD_new_SNGU06LOC FROM BANTPROD.AUD_SNGU06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey AND AUDMstFld = 'SNGU06LOC'); DELETE FROM AUD_SNGU06_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGU06_UOn AND AUDMstId = AUD_SNGU06_GuidKey);  COMMIT ;END IF;END;
/

