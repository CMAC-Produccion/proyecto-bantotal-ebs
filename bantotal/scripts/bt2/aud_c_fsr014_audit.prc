CREATE OR REPLACE PROCEDURE AUD_C_FSR014_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSR014_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSR014_UOn,AUD_FSR014_GuidKey,'FSR014',CONCAT( CONCAT( CONCAT( '|RRCOD=', RTRIM(COALESCE(AUD_old_RRCOD,AUD_new_RRCOD)) ),CONCAT( '|RUBRO=', RTRIM(COALESCE(AUD_old_RUBRO,AUD_new_RUBRO)) ) ),'|' ),AUD_FSR014_UBT,AUD_FSR014_UBU,AUD_FSR014_UBM,AUD_FSR014_UBP,AUD_FSR014_UBR,AUD_FSR014_UAs,AUD_FSR014_UBC,AUD_FSR014_UBA,AUD_FSR014_UBS, '', 'BANTOTAL', '', '', '',AUD_FSR014_UT FROM BANTPROD.AUD_FSR014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR014_UOn AND AUDMstId = AUD_FSR014_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR014_UOn,AUD_FSR014_GuidKey,'RRCOD',AUD_old_RRCOD,AUD_new_RRCOD FROM BANTPROD.AUD_FSR014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR014_UOn AND AUDMstId = AUD_FSR014_GuidKey AND AUDMstFld = 'RRCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR014_UOn,AUD_FSR014_GuidKey,'RRRUBR',AUD_old_RRRUBR,AUD_new_RRRUBR FROM BANTPROD.AUD_FSR014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR014_UOn AND AUDMstId = AUD_FSR014_GuidKey AND AUDMstFld = 'RRRUBR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR014_UOn,AUD_FSR014_GuidKey,'RUBRO',AUD_old_RUBRO,AUD_new_RUBRO FROM BANTPROD.AUD_FSR014_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR014_UOn AND AUDMstId = AUD_FSR014_GuidKey AND AUDMstFld = 'RUBRO'); DELETE FROM AUD_FSR014_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR014_UOn AND AUDMstId = AUD_FSR014_GuidKey);  COMMIT ;END IF;END;
/

