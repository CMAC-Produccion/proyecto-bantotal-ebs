CREATE OR REPLACE PROCEDURE AUD_C_FSX018_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSX018_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'FSX018',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|SICOD=', RTRIM(COALESCE(AUD_old_SICOD,AUD_new_SICOD)) ),CONCAT( '|SICORR=', RTRIM(COALESCE(AUD_old_SICORR,AUD_new_SICORR)) ) ),CONCAT( '|SIMOD=', RTRIM(COALESCE(AUD_old_SIMOD,AUD_new_SIMOD)) ) ),CONCAT( '|SINIMP=', RTRIM(COALESCE(AUD_old_SINIMP,AUD_new_SINIMP)) ) ),CONCAT( '|SITRAN=', RTRIM(COALESCE(AUD_old_SITRAN,AUD_new_SITRAN)) ) ),'|' ),AUD_FSX018_UBT,AUD_FSX018_UBU,AUD_FSX018_UBM,AUD_FSX018_UBP,AUD_FSX018_UBR,AUD_FSX018_UAs,AUD_FSX018_UBC,AUD_FSX018_UBA,AUD_FSX018_UBS, '', 'BANTOTAL', '', '', '',AUD_FSX018_UT FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SIATRIB',AUD_old_SIATRIB,AUD_new_SIATRIB FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SIATRIB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SICOD',AUD_old_SICOD,AUD_new_SICOD FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SICOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SICORR',AUD_old_SICORR,AUD_new_SICORR FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SICORR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SICPTOAYUD',AUD_old_SICPTOAYUD,AUD_new_SICPTOAYUD FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SICPTOAYUD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SICPTODSC',AUD_old_SICPTODSC,AUD_new_SICPTODSC FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SICPTODSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SICPTOLARG',AUD_old_SICPTOLARG,AUD_new_SICPTOLARG FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SICPTOLARG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SICPTONOM',AUD_old_SICPTONOM,AUD_new_SICPTONOM FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SICPTONOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SICPTOPREC',AUD_old_SICPTOPREC,AUD_new_SICPTOPREC FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SICPTOPREC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SICPTOTIPO',AUD_old_SICPTOTIPO,AUD_new_SICPTOTIPO FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SICPTOTIPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SICPTOVDEF',AUD_old_SICPTOVDEF,AUD_new_SICPTOVDEF FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId
 = AUD_FSX018_GuidKey AND AUDMstFld = 'SICPTOVDEF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SIIDIOMA',AUD_old_SIIDIOMA,AUD_new_SIIDIOMA FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SIIDIOMA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SIMOD',AUD_old_SIMOD,AUD_new_SIMOD FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SIMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SINIMP',AUD_old_SINIMP,AUD_new_SINIMP FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SINIMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SIORD',AUD_old_SIORD,AUD_new_SIORD FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SIORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SIRENGLON',AUD_old_SIRENGLON,AUD_new_SIRENGLON FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SIRENGLON'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SITIPO',AUD_old_SITIPO,AUD_new_SITIPO FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SITIPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX018_UOn,AUD_FSX018_GuidKey,'SITRAN',AUD_old_SITRAN,AUD_new_SITRAN FROM BANTPROD.AUD_FSX018_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey AND AUDMstFld = 'SITRAN'); DELETE FROM AUD_FSX018_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSX018_UOn AND AUDMstId = AUD_FSX018_GuidKey);  COMMIT ;END IF;END;
/

