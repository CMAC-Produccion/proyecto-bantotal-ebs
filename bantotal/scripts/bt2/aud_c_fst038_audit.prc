CREATE OR REPLACE PROCEDURE AUD_C_FST038_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST038_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST038_UOn,AUD_FST038_GuidKey,'FST038',CONCAT( CONCAT( '|RELCOD=', RTRIM(COALESCE(AUD_old_RELCOD,AUD_new_RELCOD)) ),'|' ),AUD_FST038_UBT,AUD_FST038_UBU,AUD_FST038_UBM,AUD_FST038_UBP,AUD_FST038_UBR,AUD_FST038_UAs,AUD_FST038_UBC,AUD_FST038_UBA,AUD_FST038_UBS, '', 'BANTOTAL', '', '', '',AUD_FST038_UT FROM BANTPROD.AUD_FST038_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST038_UOn AND AUDMstId = AUD_FST038_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST038_UOn,AUD_FST038_GuidKey,'RELCOD',AUD_old_RELCOD,AUD_new_RELCOD FROM BANTPROD.AUD_FST038_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST038_UOn AND AUDMstId = AUD_FST038_GuidKey AND AUDMstFld = 'RELCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST038_UOn,AUD_FST038_GuidKey,'RELNOM',AUD_old_RELNOM,AUD_new_RELNOM FROM BANTPROD.AUD_FST038_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST038_UOn AND AUDMstId = AUD_FST038_GuidKey AND AUDMstFld = 'RELNOM'); DELETE FROM AUD_FST038_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST038_UOn AND AUDMstId = AUD_FST038_GuidKey);  COMMIT ;END IF;END;
/

