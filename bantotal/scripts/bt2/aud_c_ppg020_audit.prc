CREATE OR REPLACE PROCEDURE AUD_C_PPG020_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_PPG020_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_PPG020_UOn,AUD_PPG020_GuidKey,'PPG020',CONCAT( CONCAT( CONCAT( '|PPG020CIT=', RTRIM(COALESCE(AUD_old_PPG020CIT,AUD_new_PPG020CIT)) ),CONCAT( '|PPG020CTB=', RTRIM(COALESCE(AUD_old_PPG020CTB,AUD_new_PPG020CTB)) ) ),'|' ),AUD_PPG020_UBT,AUD_PPG020_UBU,AUD_PPG020_UBM,AUD_PPG020_UBP,AUD_PPG020_UBR,AUD_PPG020_UAs,AUD_PPG020_UBC,AUD_PPG020_UBA,AUD_PPG020_UBS, '', 'BANTOTAL', '', '', '',AUD_PPG020_UT FROM BANTPROD.AUD_PPG020_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_PPG020_UOn AND AUDMstId = AUD_PPG020_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_PPG020_UOn,AUD_PPG020_GuidKey,'PPG020AU1',AUD_old_PPG020AU1,AUD_new_PPG020AU1 FROM BANTPROD.AUD_PPG020_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PPG020_UOn AND AUDMstId = AUD_PPG020_GuidKey AND AUDMstFld = 'PPG020AU1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PPG020_UOn,AUD_PPG020_GuidKey,'PPG020AU2',AUD_old_PPG020AU2,AUD_new_PPG020AU2 FROM BANTPROD.AUD_PPG020_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PPG020_UOn AND AUDMstId = AUD_PPG020_GuidKey AND AUDMstFld = 'PPG020AU2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PPG020_UOn,AUD_PPG020_GuidKey,'PPG020AU3',TO_CHAR(AUD_old_PPG020AU3,'YYYY-MM-DD'),TO_CHAR(AUD_new_PPG020AU3,'YYYY-MM-DD') FROM BANTPROD.AUD_PPG020_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PPG020_UOn AND AUDMstId = AUD_PPG020_GuidKey AND AUDMstFld = 'PPG020AU3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PPG020_UOn,AUD_PPG020_GuidKey,'PPG020AU4',AUD_old_PPG020AU4,AUD_new_PPG020AU4 FROM BANTPROD.AUD_PPG020_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PPG020_UOn AND AUDMstId = AUD_PPG020_GuidKey AND AUDMstFld = 'PPG020AU4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PPG020_UOn,AUD_PPG020_GuidKey,'PPG020AU5',AUD_old_PPG020AU5,AUD_new_PPG020AU5 FROM BANTPROD.AUD_PPG020_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PPG020_UOn AND AUDMstId = AUD_PPG020_GuidKey AND AUDMstFld = 'PPG020AU5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PPG020_UOn,AUD_PPG020_GuidKey,'PPG020CIT',AUD_old_PPG020CIT,AUD_new_PPG020CIT FROM BANTPROD.AUD_PPG020_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PPG020_UOn AND AUDMstId = AUD_PPG020_GuidKey AND AUDMstFld = 'PPG020CIT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PPG020_UOn,AUD_PPG020_GuidKey,'PPG020CTB',AUD_old_PPG020CTB,AUD_new_PPG020CTB FROM BANTPROD.AUD_PPG020_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PPG020_UOn AND AUDMstId = AUD_PPG020_GuidKey AND AUDMstFld = 'PPG020CTB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PPG020_UOn,AUD_PPG020_GuidKey,'PPG020DIT',AUD_old_PPG020DIT,AUD_new_PPG020DIT FROM BANTPROD.AUD_PPG020_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PPG020_UOn AND AUDMstId = AUD_PPG020_GuidKey AND AUDMstFld = 'PPG020DIT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PPG020_UOn,AUD_PPG020_GuidKey,'PPG020IHA',AUD_old_PPG020IHA,AUD_new_PPG020IHA FROM BANTPROD.AUD_PPG020_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PPG020_UOn AND AUDMstId = AUD_PPG020_GuidKey AND AUDMstFld = 'PPG020IHA'); DELETE FROM AUD_PPG020_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_PPG020_UOn AND AUDMstId = AUD_PPG020_GuidKey);  COMMIT ;END IF;END;
/

