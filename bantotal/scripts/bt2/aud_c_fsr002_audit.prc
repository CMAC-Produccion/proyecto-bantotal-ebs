CREATE OR REPLACE PROCEDURE AUD_C_FSR002_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSR002_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSR002_UOn,AUD_FSR002_GuidKey,'FSR002',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PENDOC=', RTRIM(COALESCE(AUD_old_PENDOC,AUD_new_PENDOC)) ),CONCAT( '|PEPAIS=', RTRIM(COALESCE(AUD_old_PEPAIS,AUD_new_PEPAIS)) ) ),CONCAT( '|PETDOC=', RTRIM(COALESCE(AUD_old_PETDOC,AUD_new_PETDOC)) ) ),CONCAT( '|RPCCYG=', RTRIM(COALESCE(AUD_old_RPCCYG,AUD_new_RPCCYG)) ) ),CONCAT( '|RPNDOC=', RTRIM(COALESCE(AUD_old_RPNDOC,AUD_new_RPNDOC)) ) ),CONCAT( '|RPPAIS=', RTRIM(COALESCE(AUD_old_RPPAIS,AUD_new_RPPAIS)) ) ),CONCAT( '|RPTDOC=', RTRIM(COALESCE(AUD_old_RPTDOC,AUD_new_RPTDOC)) ) ),'|' ),AUD_FSR002_UBT,AUD_FSR002_UBU,AUD_FSR002_UBM,AUD_FSR002_UBP,AUD_FSR002_UBR,AUD_FSR002_UAs,AUD_FSR002_UBC,AUD_FSR002_UBA,AUD_FSR002_UBS, '', 'BANTOTAL', '', '', '',AUD_FSR002_UT FROM BANTPROD.AUD_FSR002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR002_UOn AND AUDMstId = AUD_FSR002_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR002_UOn,AUD_FSR002_GuidKey,'PENDOC',AUD_old_PENDOC,AUD_new_PENDOC FROM BANTPROD.AUD_FSR002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR002_UOn AND AUDMstId = AUD_FSR002_GuidKey AND AUDMstFld = 'PENDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR002_UOn,AUD_FSR002_GuidKey,'PEPAIS',AUD_old_PEPAIS,AUD_new_PEPAIS FROM BANTPROD.AUD_FSR002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR002_UOn AND AUDMstId = AUD_FSR002_GuidKey AND AUDMstFld = 'PEPAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR002_UOn,AUD_FSR002_GuidKey,'PETDOC',AUD_old_PETDOC,AUD_new_PETDOC FROM BANTPROD.AUD_FSR002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR002_UOn AND AUDMstId = AUD_FSR002_GuidKey AND AUDMstFld = 'PETDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR002_UOn,AUD_FSR002_GuidKey,'RPCCYG',AUD_old_RPCCYG,AUD_new_RPCCYG FROM BANTPROD.AUD_FSR002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR002_UOn AND AUDMstId = AUD_FSR002_GuidKey AND AUDMstFld = 'RPCCYG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR002_UOn,AUD_FSR002_GuidKey,'RPNDOC',AUD_old_RPNDOC,AUD_new_RPNDOC FROM BANTPROD.AUD_FSR002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR002_UOn AND AUDMstId = AUD_FSR002_GuidKey AND AUDMstFld = 'RPNDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR002_UOn,AUD_FSR002_GuidKey,'RPPAIS',AUD_old_RPPAIS,AUD_new_RPPAIS FROM BANTPROD.AUD_FSR002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR002_UOn AND AUDMstId = AUD_FSR002_GuidKey AND AUDMstFld = 'RPPAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR002_UOn,AUD_FSR002_GuidKey,'RPRPAT',AUD_old_RPRPAT,AUD_new_RPRPAT FROM BANTPROD.AUD_FSR002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR002_UOn AND AUDMstId = AUD_FSR002_GuidKey AND AUDMstFld = 'RPRPAT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR002_UOn,AUD_FSR002_GuidKey,'RPTDOC',AUD_old_RPTDOC,AUD_new_RPTDOC FROM BANTPROD.AUD_FSR002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR002_UOn AND AUDMstId = AUD_FSR002_GuidKey AND AUDMstFld = 'RPTDOC'); DELETE FROM AUD_FSR002_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR002_UOn AND AUDMstId = AUD_FSR002_GuidKey);  COMMIT ;END IF;END;
/

