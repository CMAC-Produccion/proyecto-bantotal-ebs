CREATE OR REPLACE PROCEDURE AUD_C_SNG054_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG054_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG054_UOn,AUD_SNG054_GuidKey,'SNG054',CONCAT( CONCAT( CONCAT( CONCAT( '|SNG052TEM=', RTRIM(COALESCE(AUD_old_SNG052TEM,AUD_new_SNG052TEM)) ),CONCAT( '|SNG053CMB=', RTRIM(COALESCE(AUD_old_SNG053CMB,AUD_new_SNG053CMB)) ) ),CONCAT( '|SNG064COD=', RTRIM(COALESCE(AUD_old_SNG064COD,AUD_new_SNG064COD)) ) ),'|' ),AUD_SNG054_UBT,AUD_SNG054_UBU,AUD_SNG054_UBM,AUD_SNG054_UBP,AUD_SNG054_UBR,AUD_SNG054_UAs,AUD_SNG054_UBC,AUD_SNG054_UBA,AUD_SNG054_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG054_UT FROM BANTPROD.AUD_SNG054_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG054_UOn AND AUDMstId = AUD_SNG054_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG054_UOn,AUD_SNG054_GuidKey,'SNG052TEM',AUD_old_SNG052TEM,AUD_new_SNG052TEM FROM BANTPROD.AUD_SNG054_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG054_UOn AND AUDMstId = AUD_SNG054_GuidKey AND AUDMstFld = 'SNG052TEM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG054_UOn,AUD_SNG054_GuidKey,'SNG053CMB',AUD_old_SNG053CMB,AUD_new_SNG053CMB FROM BANTPROD.AUD_SNG054_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG054_UOn AND AUDMstId = AUD_SNG054_GuidKey AND AUDMstFld = 'SNG053CMB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG054_UOn,AUD_SNG054_GuidKey,'SNG054ORD',AUD_old_SNG054ORD,AUD_new_SNG054ORD FROM BANTPROD.AUD_SNG054_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG054_UOn AND AUDMstId = AUD_SNG054_GuidKey AND AUDMstFld = 'SNG054ORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG054_UOn,AUD_SNG054_GuidKey,'SNG064COD',AUD_old_SNG064COD,AUD_new_SNG064COD FROM BANTPROD.AUD_SNG054_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG054_UOn AND AUDMstId = AUD_SNG054_GuidKey AND AUDMstFld = 'SNG064COD'); DELETE FROM AUD_SNG054_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG054_UOn AND AUDMstId = AUD_SNG054_GuidKey);  COMMIT ;END IF;END;
/

