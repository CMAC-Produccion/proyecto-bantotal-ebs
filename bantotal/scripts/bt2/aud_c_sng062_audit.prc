CREATE OR REPLACE PROCEDURE AUD_C_SNG062_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG062_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG062',CONCAT( CONCAT( '|SNG062AUT=', RTRIM(COALESCE(AUD_old_SNG062AUT,AUD_new_SNG062AUT)) ),'|' ),AUD_SNG062_UBT,AUD_SNG062_UBU,AUD_SNG062_UBM,AUD_SNG062_UBP,AUD_SNG062_UBR,AUD_SNG062_UAs,AUD_SNG062_UBC,AUD_SNG062_UBA,AUD_SNG062_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG062_UT FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG053CMB',AUD_old_SNG053CMB,AUD_new_SNG053CMB FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG053CMB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG061TEM',AUD_old_SNG061TEM,AUD_new_SNG061TEM FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG061TEM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG062AUT',AUD_old_SNG062AUT,AUD_new_SNG062AUT FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG062AUT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG062DSC',AUD_old_SNG062DSC,AUD_new_SNG062DSC FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG062DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG062EST',AUD_old_SNG062EST,AUD_new_SNG062EST FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG062EST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG062EXP',AUD_old_SNG062EXP,AUD_new_SNG062EXP FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG062EXP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG062NDOC',AUD_old_SNG062NDOC,AUD_new_SNG062NDOC FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG062NDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG062PRG',AUD_old_SNG062PRG,AUD_new_SNG062PRG FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG062PRG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG062RES',AUD_old_SNG062RES,AUD_new_SNG062RES FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG062RES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG062RET',AUD_old_SNG062RET,AUD_new_SNG062RET FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG062RET'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG062WHO',AUD_old_SNG062WHO,AUD_new_SNG062WHO FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn
 AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG062WHO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG062_UOn,AUD_SNG062_GuidKey,'SNG064COD',AUD_old_SNG064COD,AUD_new_SNG064COD FROM BANTPROD.AUD_SNG062_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey AND AUDMstFld = 'SNG064COD'); DELETE FROM AUD_SNG062_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG062_UOn AND AUDMstId = AUD_SNG062_GuidKey);  COMMIT ;END IF;END;
/

