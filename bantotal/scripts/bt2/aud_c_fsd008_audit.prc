CREATE OR REPLACE PROCEDURE AUD_C_FSD008_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD008_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'FSD008',CONCAT( CONCAT( CONCAT( '|CTNRO=', RTRIM(COALESCE(AUD_old_CTNRO,AUD_new_CTNRO)) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),'|' ),AUD_FSD008_UBT,AUD_FSD008_UBU,AUD_FSD008_UBM,AUD_FSD008_UBP,AUD_FSD008_UBR,AUD_FSD008_UAs,AUD_FSD008_UBC,AUD_FSD008_UBA,AUD_FSD008_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD008_UT FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTCBCU',AUD_old_CTCBCU,AUD_new_CTCBCU FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTCBCU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTCCLI',AUD_old_CTCCLI,AUD_new_CTCCLI FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTCCLI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTCORP',AUD_old_CTCORP,AUD_new_CTCORP FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTCORP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTCRIE',AUD_old_CTCRIE,AUD_new_CTCRIE FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTCRIE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTEJCT',AUD_old_CTEJCT,AUD_new_CTEJCT FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTEJCT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTEMPL',AUD_old_CTEMPL,AUD_new_CTEMPL FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTEMPL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTFALT',TO_CHAR(AUD_old_CTFALT,'YYYY-MM-DD'),TO_CHAR(AUD_new_CTFALT,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTFALT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTFBAJ',TO_CHAR(AUD_old_CTFBAJ,'YYYY-MM-DD'),TO_CHAR(AUD_new_CTFBAJ,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTFBAJ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTFCNF',TO_CHAR(AUD_old_CTFCNF,'YYYY-MM-DD'),TO_CHAR(AUD_new_CTFCNF,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTFCNF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTIFIN',AUD_old_CTIFIN,AUD_new_CTIFIN FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTIFIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTIMAB',AUD_old_CTIMAB,AUD_new_CTIMAB FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS
(SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTIMAB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTNGTE',AUD_old_CTNGTE,AUD_new_CTNGTE FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTNGTE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTNOM',AUD_old_CTNOM,AUD_new_CTNOM FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTNOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTNRO',AUD_old_CTNRO,AUD_new_CTNRO FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTNROI',AUD_old_CTNROI,AUD_new_CTNROI FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTNROI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTPIN',AUD_old_CTPIN,AUD_new_CTPIN FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTPIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTPROV',AUD_old_CTPROV,AUD_new_CTPROV FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTPROV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTRCOR',AUD_old_CTRCOR,AUD_new_CTRCOR FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTRCOR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTRESI',AUD_old_CTRESI,AUD_new_CTRESI FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTRESI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'CTSEGM',AUD_old_CTSEGM,AUD_new_CTSEGM FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'CTSEGM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD008_UOn,AUD_FSD008_GuidKey,'SECCOD',AUD_old_SECCOD,AUD_new_SECCOD FROM BANTPROD.AUD_FSD008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey AND AUDMstFld = 'SECCOD'); DELETE FROM AUD_FSD008_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD008_UOn AND AUDMstId = AUD_FSD008_GuidKey);  COMMIT ;END IF;END;
/

