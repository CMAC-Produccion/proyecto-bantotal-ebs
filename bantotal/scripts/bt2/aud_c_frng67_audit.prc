CREATE OR REPLACE PROCEDURE AUD_C_FRNG67_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FRNG67_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FRNG67_UOn,AUD_FRNG67_GuidKey,'FRNG67',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|RNG49COD=', RTRIM(COALESCE(AUD_old_RNG49COD,AUD_new_RNG49COD)) ),CONCAT( '|RNG50GRP=', RTRIM(COALESCE(AUD_old_RNG50GRP,AUD_new_RNG50GRP)) ) ),CONCAT( '|RNG51COD=', RTRIM(COALESCE(AUD_old_RNG51COD,AUD_new_RNG51COD)) ) ),CONCAT( '|RNG67COR=', RTRIM(COALESCE(AUD_old_RNG67COR,AUD_new_RNG67COR)) ) ),'|' ),AUD_FRNG67_UBT,AUD_FRNG67_UBU,AUD_FRNG67_UBM,AUD_FRNG67_UBP,AUD_FRNG67_UBR,AUD_FRNG67_UAs,AUD_FRNG67_UBC,AUD_FRNG67_UBA,AUD_FRNG67_UBS, '', 'BANTOTAL', '', '', '',AUD_FRNG67_UT FROM BANTPROD.AUD_FRNG67_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG67_UOn AND AUDMstId = AUD_FRNG67_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG67_UOn,AUD_FRNG67_GuidKey,'RNG49COD',AUD_old_RNG49COD,AUD_new_RNG49COD FROM BANTPROD.AUD_FRNG67_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG67_UOn AND AUDMstId = AUD_FRNG67_GuidKey AND AUDMstFld = 'RNG49COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG67_UOn,AUD_FRNG67_GuidKey,'RNG50GRP',AUD_old_RNG50GRP,AUD_new_RNG50GRP FROM BANTPROD.AUD_FRNG67_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG67_UOn AND AUDMstId = AUD_FRNG67_GuidKey AND AUDMstFld = 'RNG50GRP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG67_UOn,AUD_FRNG67_GuidKey,'RNG51COD',AUD_old_RNG51COD,AUD_new_RNG51COD FROM BANTPROD.AUD_FRNG67_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG67_UOn AND AUDMstId = AUD_FRNG67_GuidKey AND AUDMstFld = 'RNG51COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG67_UOn,AUD_FRNG67_GuidKey,'RNG67COR',AUD_old_RNG67COR,AUD_new_RNG67COR FROM BANTPROD.AUD_FRNG67_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG67_UOn AND AUDMstId = AUD_FRNG67_GuidKey AND AUDMstFld = 'RNG67COR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG67_UOn,AUD_FRNG67_GuidKey,'RNG67VAL',AUD_old_RNG67VAL,AUD_new_RNG67VAL FROM BANTPROD.AUD_FRNG67_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG67_UOn AND AUDMstId = AUD_FRNG67_GuidKey AND AUDMstFld = 'RNG67VAL'); DELETE FROM AUD_FRNG67_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG67_UOn AND AUDMstId = AUD_FRNG67_GuidKey);  COMMIT ;END IF;END;
/

