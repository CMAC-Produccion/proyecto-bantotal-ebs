CREATE OR REPLACE PROCEDURE AUD_C_FSD201_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD201_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'FSD201',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|LNFACT=', RTRIM(COALESCE(AUD_old_LNFACT,AUD_new_LNFACT)) ),CONCAT( '|LNNDOC=', RTRIM(COALESCE(AUD_old_LNNDOC,AUD_new_LNNDOC)) ) ),CONCAT( '|LNPAIS=', RTRIM(COALESCE(AUD_old_LNPAIS,AUD_new_LNPAIS)) ) ),CONCAT( '|LNTDOC=', RTRIM(COALESCE(AUD_old_LNTDOC,AUD_new_LNTDOC)) ) ),CONCAT( '|TLIS=', RTRIM(COALESCE(AUD_old_TLIS,AUD_new_TLIS)) ) ),'|' ),AUD_FSD201_UBT,AUD_FSD201_UBU,AUD_FSD201_UBM,AUD_FSD201_UBP,AUD_FSD201_UBR,AUD_FSD201_UAs,AUD_FSD201_UBC,AUD_FSD201_UBA,AUD_FSD201_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD201_UT FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNAPE1',AUD_old_LNAPE1,AUD_new_LNAPE1 FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNAPE1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNAPEA',AUD_old_LNAPEA,AUD_new_LNAPEA FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNAPEA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNDENO',AUD_old_LNDENO,AUD_new_LNDENO FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNDENO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNFACT',TO_CHAR(AUD_old_LNFACT,'YYYY-MM-DD'),TO_CHAR(AUD_new_LNFACT,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNFACT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNMOFDES',TO_CHAR(AUD_old_LNMOFDES,'YYYY-MM-DD'),TO_CHAR(AUD_new_LNMOFDES,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNMOFDES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNMOFHAS',TO_CHAR(AUD_old_LNMOFHAS,'YYYY-MM-DD'),TO_CHAR(AUD_new_LNMOFHAS,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNMOFHAS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNMOOBS',AUD_old_LNMOOBS,AUD_new_LNMOOBS FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNMOOBS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNMOTDES',AUD_old_LNMOTDES,AUD_new_LNMOTDES FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNMOTDES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNMOTINA',AUD_old_LNMOTINA,AUD_new_LNMOTINA FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNMOTINA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNNDOC',AUD_old_LNNDOC,AUD_new_LNNDOC FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT
* FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNNDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNNOM1',AUD_old_LNNOM1,AUD_new_LNNOM1 FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNNOM1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNNOMA',AUD_old_LNNOMA,AUD_new_LNNOMA FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNNOMA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNPAIS',AUD_old_LNPAIS,AUD_new_LNPAIS FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNPAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'LNTDOC',AUD_old_LNTDOC,AUD_new_LNTDOC FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'LNTDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD201_UOn,AUD_FSD201_GuidKey,'TLIS',AUD_old_TLIS,AUD_new_TLIS FROM BANTPROD.AUD_FSD201_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey AND AUDMstFld = 'TLIS'); DELETE FROM AUD_FSD201_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD201_UOn AND AUDMstId = AUD_FSD201_GuidKey);  COMMIT ;END IF;END;
/

