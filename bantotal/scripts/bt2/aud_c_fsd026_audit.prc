CREATE OR REPLACE PROCEDURE AUD_C_FSD026_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD026_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'FSD026',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|COCOD=', RTRIM(COALESCE(AUD_old_COCOD,AUD_new_COCOD)) ),CONCAT( '|COCTA=', RTRIM(COALESCE(AUD_old_COCTA,AUD_new_COCTA)) ) ),CONCAT( '|COFECH=', RTRIM(COALESCE(AUD_old_COFECH,AUD_new_COFECH)) ) ),CONCAT( '|COMDA=', RTRIM(COALESCE(AUD_old_COMDA,AUD_new_COMDA)) ) ),CONCAT( '|COMOD=', RTRIM(COALESCE(AUD_old_COMOD,AUD_new_COMOD)) ) ),CONCAT( '|COMTO=', RTRIM(COALESCE(AUD_old_COMTO,AUD_new_COMTO)) ) ),CONCAT( '|COPAP=', RTRIM(COALESCE(AUD_old_COPAP,AUD_new_COPAP)) ) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),'|' ),AUD_FSD026_UBT,AUD_FSD026_UBU,AUD_FSD026_UBM,AUD_FSD026_UBP,AUD_FSD026_UBR,AUD_FSD026_UAs,AUD_FSD026_UBC,AUD_FSD026_UBA,AUD_FSD026_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD026_UT FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'COCOD',AUD_old_COCOD,AUD_new_COCOD FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'COCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'COCTA',AUD_old_COCTA,AUD_new_COCTA FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'COCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'COFECH',TO_CHAR(AUD_old_COFECH,'YYYY-MM-DD'),TO_CHAR(AUD_new_COFECH,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'COFECH'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'COIMP',AUD_old_COIMP,AUD_new_COIMP FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'COIMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'COMAX',AUD_old_COMAX,AUD_new_COMAX FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'COMAX'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'COMDA',AUD_old_COMDA,AUD_new_COMDA FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'COMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'COMIN',AUD_old_COMIN,AUD_new_COMIN FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'COMIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'COMOD',AUD_old_COMOD,AUD_new_COMOD FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'COMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'COMTO',AUD_old_COMTO,AUD_new_COMTO FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'COMTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'COPAP',AUD_old_COPAP,AUD_new
_COPAP FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'COPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'COTASA',AUD_old_COTASA,AUD_new_COTASA FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'COTASA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD026_UOn,AUD_FSD026_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSD026_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey AND AUDMstFld = 'PGCOD'); DELETE FROM AUD_FSD026_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD026_UOn AND AUDMstId = AUD_FSD026_GuidKey);  COMMIT ;END IF;END;
/

