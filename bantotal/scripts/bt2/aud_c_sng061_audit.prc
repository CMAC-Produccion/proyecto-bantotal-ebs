CREATE OR REPLACE PROCEDURE AUD_C_SNG061_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG061_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG061_UOn,AUD_SNG061_GuidKey,'SNG061',CONCAT( CONCAT( '|SNG061TEM=', RTRIM(COALESCE(AUD_old_SNG061TEM,AUD_new_SNG061TEM)) ),'|' ),AUD_SNG061_UBT,AUD_SNG061_UBU,AUD_SNG061_UBM,AUD_SNG061_UBP,AUD_SNG061_UBR,AUD_SNG061_UAs,AUD_SNG061_UBC,AUD_SNG061_UBA,AUD_SNG061_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG061_UT FROM BANTPROD.AUD_SNG061_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG061_UOn AND AUDMstId = AUD_SNG061_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG061_UOn,AUD_SNG061_GuidKey,'SNG052TEM',AUD_old_SNG052TEM,AUD_new_SNG052TEM FROM BANTPROD.AUD_SNG061_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG061_UOn AND AUDMstId = AUD_SNG061_GuidKey AND AUDMstFld = 'SNG052TEM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG061_UOn,AUD_SNG061_GuidKey,'SNG060PQT',AUD_old_SNG060PQT,AUD_new_SNG060PQT FROM BANTPROD.AUD_SNG061_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG061_UOn AND AUDMstId = AUD_SNG061_GuidKey AND AUDMstFld = 'SNG060PQT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG061_UOn,AUD_SNG061_GuidKey,'SNG061EST',AUD_old_SNG061EST,AUD_new_SNG061EST FROM BANTPROD.AUD_SNG061_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG061_UOn AND AUDMstId = AUD_SNG061_GuidKey AND AUDMstFld = 'SNG061EST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG061_UOn,AUD_SNG061_GuidKey,'SNG061EXP',AUD_old_SNG061EXP,AUD_new_SNG061EXP FROM BANTPROD.AUD_SNG061_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG061_UOn AND AUDMstId = AUD_SNG061_GuidKey AND AUDMstFld = 'SNG061EXP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG061_UOn,AUD_SNG061_GuidKey,'SNG061PRO',AUD_old_SNG061PRO,AUD_new_SNG061PRO FROM BANTPROD.AUD_SNG061_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG061_UOn AND AUDMstId = AUD_SNG061_GuidKey AND AUDMstFld = 'SNG061PRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG061_UOn,AUD_SNG061_GuidKey,'SNG061TEM',AUD_old_SNG061TEM,AUD_new_SNG061TEM FROM BANTPROD.AUD_SNG061_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG061_UOn AND AUDMstId = AUD_SNG061_GuidKey AND AUDMstFld = 'SNG061TEM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG061_UOn,AUD_SNG061_GuidKey,'SNG061TPO',AUD_old_SNG061TPO,AUD_new_SNG061TPO FROM BANTPROD.AUD_SNG061_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG061_UOn AND AUDMstId = AUD_SNG061_GuidKey AND AUDMstFld = 'SNG061TPO'); DELETE FROM AUD_SNG061_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG061_UOn AND AUDMstId = AUD_SNG061_GuidKey);  COMMIT ;END IF;END;
/

