CREATE OR REPLACE PROCEDURE AUD_C_FPP016_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FPP016_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'FPP016',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PP010PRD=', RTRIM(COALESCE(AUD_old_PP010PRD,AUD_new_PP010PRD)) ),CONCAT( '|PP016COD=', RTRIM(COALESCE(AUD_old_PP016COD,AUD_new_PP016COD)) ) ),CONCAT( '|PP016EMP=', RTRIM(COALESCE(AUD_old_PP016EMP,AUD_new_PP016EMP)) ) ),CONCAT( '|PP016TIPO=', RTRIM(COALESCE(AUD_old_PP016TIPO,AUD_new_PP016TIPO)) ) ),CONCAT( '|PP017PAR=', RTRIM(COALESCE(AUD_old_PP017PAR,AUD_new_PP017PAR)) ) ),'|' ),AUD_FPP016_UBT,AUD_FPP016_UBU,AUD_FPP016_UBM,AUD_FPP016_UBP,AUD_FPP016_UBR,AUD_FPP016_UAs,AUD_FPP016_UBC,AUD_FPP016_UBA,AUD_FPP016_UBS, '', 'BANTOTAL', '', '', '',AUD_FPP016_UT FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP010PRD',AUD_old_PP010PRD,AUD_new_PP010PRD FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP010PRD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016CAR1',AUD_old_PP016CAR1,AUD_new_PP016CAR1 FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016CAR1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016CAR2',AUD_old_PP016CAR2,AUD_new_PP016CAR2 FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016CAR2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016CAR3',AUD_old_PP016CAR3,AUD_new_PP016CAR3 FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016CAR3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016COD',AUD_old_PP016COD,AUD_new_PP016COD FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016DSC',AUD_old_PP016DSC,AUD_new_PP016DSC FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016EMP',AUD_old_PP016EMP,AUD_new_PP016EMP FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016EMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016FEC1',TO_CHAR(AUD_old_PP016FEC1,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP016FEC1,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016FEC1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016FEC2',TO_CHAR(AUD_old_PP016FEC2,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP016FEC2,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016FEC2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016FEC3',TO_CHAR(AUD_old_PP016FEC3,'YYYY-
MM-DD'),TO_CHAR(AUD_new_PP016FEC3,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016FEC3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016IMP1',AUD_old_PP016IMP1,AUD_new_PP016IMP1 FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016IMP1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016IMP2',AUD_old_PP016IMP2,AUD_new_PP016IMP2 FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016IMP2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016IMP3',AUD_old_PP016IMP3,AUD_new_PP016IMP3 FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016IMP3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016MOD',AUD_old_PP016MOD,AUD_new_PP016MOD FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016NUM1',AUD_old_PP016NUM1,AUD_new_PP016NUM1 FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016NUM1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016NUM2',AUD_old_PP016NUM2,AUD_new_PP016NUM2 FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016NUM2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016NUM3',AUD_old_PP016NUM3,AUD_new_PP016NUM3 FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016NUM3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016ORD',AUD_old_PP016ORD,AUD_new_PP016ORD FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016ORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP016TIPO',AUD_old_PP016TIPO,AUD_new_PP016TIPO FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP016TIPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP016_UOn,AUD_FPP016_GuidKey,'PP017PAR',AUD_old_PP017PAR,AUD_new_PP017PAR FROM BANTPROD.AUD_FPP016_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey AND AUDMstFld = 'PP017PAR'); DELETE FROM AUD_FPP016_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP016_UOn AND AUDMstId = AUD_FPP016_GuidKey);  COMMIT ;END IF;END;
/

