CREATE OR REPLACE PROCEDURE AUD_C_SNGP09_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNGP09_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNGP09_UOn,AUD_SNGP09_GuidKey,'SNGP09',CONCAT( CONCAT( '|SNGP09COD=', RTRIM(COALESCE(AUD_old_SNGP09COD,AUD_new_SNGP09COD)) ),'|' ),AUD_SNGP09_UBT,AUD_SNGP09_UBU,AUD_SNGP09_UBM,AUD_SNGP09_UBP,AUD_SNGP09_UBR,AUD_SNGP09_UAs,AUD_SNGP09_UBC,AUD_SNGP09_UBA,AUD_SNGP09_UBS, '', 'BANTOTAL', '', '', '',AUD_SNGP09_UT FROM BANTPROD.AUD_SNGP09_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGP09_UOn AND AUDMstId = AUD_SNGP09_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP09_UOn,AUD_SNGP09_GuidKey,'SNGP09COD',AUD_old_SNGP09COD,AUD_new_SNGP09COD FROM BANTPROD.AUD_SNGP09_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP09_UOn AND AUDMstId = AUD_SNGP09_GuidKey AND AUDMstFld = 'SNGP09COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP09_UOn,AUD_SNGP09_GuidKey,'SNGP09DSC',AUD_old_SNGP09DSC,AUD_new_SNGP09DSC FROM BANTPROD.AUD_SNGP09_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP09_UOn AND AUDMstId = AUD_SNGP09_GuidKey AND AUDMstFld = 'SNGP09DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP09_UOn,AUD_SNGP09_GuidKey,'SNGP09NIV',AUD_old_SNGP09NIV,AUD_new_SNGP09NIV FROM BANTPROD.AUD_SNGP09_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP09_UOn AND AUDMstId = AUD_SNGP09_GuidKey AND AUDMstFld = 'SNGP09NIV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP09_UOn,AUD_SNGP09_GuidKey,'SNGP09PGM',AUD_old_SNGP09PGM,AUD_new_SNGP09PGM FROM BANTPROD.AUD_SNGP09_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP09_UOn AND AUDMstId = AUD_SNGP09_GuidKey AND AUDMstFld = 'SNGP09PGM'); DELETE FROM AUD_SNGP09_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGP09_UOn AND AUDMstId = AUD_SNGP09_GuidKey);  COMMIT ;END IF;END;
/

