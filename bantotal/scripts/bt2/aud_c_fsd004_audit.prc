CREATE OR REPLACE PROCEDURE AUD_C_FSD004_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD004_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'FSD004',CONCAT( CONCAT( CONCAT( CONCAT( '|IFNDOC=', RTRIM(COALESCE(AUD_old_IFNDOC,AUD_new_IFNDOC)) ),CONCAT( '|IFPAIS=', RTRIM(COALESCE(AUD_old_IFPAIS,AUD_new_IFPAIS)) ) ),CONCAT( '|IFTDOC=', RTRIM(COALESCE(AUD_old_IFTDOC,AUD_new_IFTDOC)) ) ),'|' ),AUD_FSD004_UBT,AUD_FSD004_UBU,AUD_FSD004_UBM,AUD_FSD004_UBP,AUD_FSD004_UBR,AUD_FSD004_UAs,AUD_FSD004_UBC,AUD_FSD004_UBA,AUD_FSD004_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD004_UT FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFCANT',AUD_old_IFCANT,AUD_new_IFCANT FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFCANT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFCEXT',AUD_old_IFCEXT,AUD_new_IFCEXT FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFCEXT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFCSWF',AUD_old_IFCSWF,AUD_new_IFCSWF FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFCSWF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFCTLX',AUD_old_IFCTLX,AUD_new_IFCTLX FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFCTLX'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFFAUT',AUD_old_IFFAUT,AUD_new_IFFAUT FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFFAUT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFFBAL',TO_CHAR(AUD_old_IFFBAL,'YYYY-MM-DD'),TO_CHAR(AUD_new_IFFBAL,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFFBAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFFCAN',TO_CHAR(AUD_old_IFFCAN,'YYYY-MM-DD'),TO_CHAR(AUD_new_IFFCAN,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFFCAN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFFPBA',TO_CHAR(AUD_old_IFFPBA,'YYYY-MM-DD'),TO_CHAR(AUD_new_IFFPBA,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFFPBA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFLCRC',AUD_old_IFLCRC,AUD_new_IFLCRC FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFLCRC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFLCRO',AUD_old_IFLCRO,AUD_new_IFLCRO FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFLCRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'I
FNDOC',AUD_old_IFNDOC,AUD_new_IFNDOC FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFNDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFNOM',AUD_old_IFNOM,AUD_new_IFNOM FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFNOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFPAIS',AUD_old_IFPAIS,AUD_new_IFPAIS FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFPAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFPBAL',AUD_old_IFPBAL,AUD_new_IFPBAL FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFPBAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFPLIN',AUD_old_IFPLIN,AUD_new_IFPLIN FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFPLIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFSWIF',AUD_old_IFSWIF,AUD_new_IFSWIF FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFSWIF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'IFTDOC',AUD_old_IFTDOC,AUD_new_IFTDOC FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'IFTDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD004_UOn,AUD_FSD004_GuidKey,'TIFCOD',AUD_old_TIFCOD,AUD_new_TIFCOD FROM BANTPROD.AUD_FSD004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey AND AUDMstFld = 'TIFCOD'); DELETE FROM AUD_FSD004_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD004_UOn AND AUDMstId = AUD_FSD004_GuidKey);  COMMIT ;END IF;END;
/

