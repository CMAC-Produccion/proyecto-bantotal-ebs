CREATE OR REPLACE PROCEDURE AUD_C_FST047_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST047_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST047_UOn,AUD_FST047_GuidKey,'FST047',CONCAT( CONCAT( CONCAT( CONCAT( '|MODULO=', RTRIM(COALESCE(AUD_old_MODULO,AUD_new_MODULO)) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|UBUSER=', RTRIM(COALESCE(AUD_old_UBUSER,AUD_new_UBUSER)) ) ),'|' ),AUD_FST047_UBT,AUD_FST047_UBU,AUD_FST047_UBM,AUD_FST047_UBP,AUD_FST047_UBR,AUD_FST047_UAs,AUD_FST047_UBC,AUD_FST047_UBA,AUD_FST047_UBS, '', 'BANTOTAL', '', '', '',AUD_FST047_UT FROM BANTPROD.AUD_FST047_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST047_UOn,AUD_FST047_GuidKey,'MODULO',AUD_old_MODULO,AUD_new_MODULO FROM BANTPROD.AUD_FST047_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey AND AUDMstFld = 'MODULO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST047_UOn,AUD_FST047_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FST047_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST047_UOn,AUD_FST047_GuidKey,'UBCONF',AUD_old_UBCONF,AUD_new_UBCONF FROM BANTPROD.AUD_FST047_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey AND AUDMstFld = 'UBCONF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST047_UOn,AUD_FST047_GuidKey,'UBING',AUD_old_UBING,AUD_new_UBING FROM BANTPROD.AUD_FST047_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey AND AUDMstFld = 'UBING'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST047_UOn,AUD_FST047_GuidKey,'UBPROD',AUD_old_UBPROD,AUD_new_UBPROD FROM BANTPROD.AUD_FST047_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey AND AUDMstFld = 'UBPROD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST047_UOn,AUD_FST047_GuidKey,'UBSN1',AUD_old_UBSN1,AUD_new_UBSN1 FROM BANTPROD.AUD_FST047_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey AND AUDMstFld = 'UBSN1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST047_UOn,AUD_FST047_GuidKey,'UBSN2',AUD_old_UBSN2,AUD_new_UBSN2 FROM BANTPROD.AUD_FST047_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey AND AUDMstFld = 'UBSN2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST047_UOn,AUD_FST047_GuidKey,'UBSN3',AUD_old_UBSN3,AUD_new_UBSN3 FROM BANTPROD.AUD_FST047_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey AND AUDMstFld = 'UBSN3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST047_UOn,AUD_FST047_GuidKey,'UBSUP',AUD_old_UBSUP,AUD_new_UBSUP FROM BANTPROD.AUD_FST047_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey AND AUDMstFld = 'UBSUP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST047_UOn,AUD_FST047_GuidKey,'UBUSER',AUD_old_UBUSER,AUD_new_UBUSER FROM BANTPROD.AUD_FST047_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey AND AUDMstFld = 'UBUSER'); DELETE FROM AUD_FST047_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST047_UOn AND AUDMstId = AUD_FST047_GuidKey);  COMMIT ;END IF;END;
/

