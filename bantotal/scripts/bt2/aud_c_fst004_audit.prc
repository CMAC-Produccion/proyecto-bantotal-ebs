CREATE OR REPLACE PROCEDURE AUD_C_FST004_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST004_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'FST004',CONCAT( CONCAT( CONCAT( '|MODULO=', RTRIM(COALESCE(AUD_old_MODULO,AUD_new_MODULO)) ),CONCAT( '|TOTOPE=', RTRIM(COALESCE(AUD_old_TOTOPE,AUD_new_TOTOPE)) ) ),'|' ),AUD_FST004_UBT,AUD_FST004_UBU,AUD_FST004_UBM,AUD_FST004_UBP,AUD_FST004_UBR,AUD_FST004_UAs,AUD_FST004_UBC,AUD_FST004_UBA,AUD_FST004_UBS, '', 'BANTOTAL', '', '', '',AUD_FST004_UT FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'MODULO',AUD_old_MODULO,AUD_new_MODULO FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'MODULO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOCD1',AUD_old_TOCD1,AUD_new_TOCD1 FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOCD1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOCD2',AUD_old_TOCD2,AUD_new_TOCD2 FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOCD2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOCD3',AUD_old_TOCD3,AUD_new_TOCD3 FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOCD3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOCD4',AUD_old_TOCD4,AUD_new_TOCD4 FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOCD4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOCD5',AUD_old_TOCD5,AUD_new_TOCD5 FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOCD5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOELEG',AUD_old_TOELEG,AUD_new_TOELEG FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOELEG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TONOM',AUD_old_TONOM,AUD_new_TONOM FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TONOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOPERI',AUD_old_TOPERI,AUD_new_TOPERI FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOPERI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOSN1',AUD_old_TOSN1,AUD_new_TOSN1 FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOSN1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOSN2',AUD_old_TOSN2,AUD_new_TOSN2 FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOSN2'); INSERT INTO BANTPROD.AUD005 SELEC
T AUD_FST004_UOn,AUD_FST004_GuidKey,'TOSN3',AUD_old_TOSN3,AUD_new_TOSN3 FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOSN3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOSN4',AUD_old_TOSN4,AUD_new_TOSN4 FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOSN4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOSN5',AUD_old_TOSN5,AUD_new_TOSN5 FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOSN5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOTOPE',AUD_old_TOTOPE,AUD_new_TOTOPE FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOTOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST004_UOn,AUD_FST004_GuidKey,'TOTPIZ',AUD_old_TOTPIZ,AUD_new_TOTPIZ FROM BANTPROD.AUD_FST004_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey AND AUDMstFld = 'TOTPIZ'); DELETE FROM AUD_FST004_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST004_UOn AND AUDMstId = AUD_FST004_GuidKey);  COMMIT ;END IF;END;
/

