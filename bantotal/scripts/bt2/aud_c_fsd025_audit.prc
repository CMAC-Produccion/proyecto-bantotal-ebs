CREATE OR REPLACE PROCEDURE AUD_C_FSD025_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD025_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD025_UOn,AUD_FSD025_GuidKey,'FSD025',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ),CONCAT( '|TAFDES=', RTRIM(COALESCE(AUD_old_TAFDES,AUD_new_TAFDES)) ) ),CONCAT( '|TAMDA=', RTRIM(COALESCE(AUD_old_TAMDA,AUD_new_TAMDA)) ) ),CONCAT( '|TAMOD=', RTRIM(COALESCE(AUD_old_TAMOD,AUD_new_TAMOD)) ) ),CONCAT( '|TAMTO=', RTRIM(COALESCE(AUD_old_TAMTO,AUD_new_TAMTO)) ) ),CONCAT( '|TAPAP=', RTRIM(COALESCE(AUD_old_TAPAP,AUD_new_TAPAP)) ) ),CONCAT( '|TPIZAR=', RTRIM(COALESCE(AUD_old_TPIZAR,AUD_new_TPIZAR)) ) ),'|' ),AUD_FSD025_UBT,AUD_FSD025_UBU,AUD_FSD025_UBM,AUD_FSD025_UBP,AUD_FSD025_UBR,AUD_FSD025_UAs,AUD_FSD025_UBC,AUD_FSD025_UBA,AUD_FSD025_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD025_UT FROM BANTPROD.AUD_FSD025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD025_UOn AND AUDMstId = AUD_FSD025_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD025_UOn,AUD_FSD025_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSD025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD025_UOn AND AUDMstId = AUD_FSD025_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD025_UOn,AUD_FSD025_GuidKey,'TAFDES',TO_CHAR(AUD_old_TAFDES,'YYYY-MM-DD'),TO_CHAR(AUD_new_TAFDES,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD025_UOn AND AUDMstId = AUD_FSD025_GuidKey AND AUDMstFld = 'TAFDES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD025_UOn,AUD_FSD025_GuidKey,'TAFINV',AUD_old_TAFINV,AUD_new_TAFINV FROM BANTPROD.AUD_FSD025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD025_UOn AND AUDMstId = AUD_FSD025_GuidKey AND AUDMstFld = 'TAFINV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD025_UOn,AUD_FSD025_GuidKey,'TAMDA',AUD_old_TAMDA,AUD_new_TAMDA FROM BANTPROD.AUD_FSD025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD025_UOn AND AUDMstId = AUD_FSD025_GuidKey AND AUDMstFld = 'TAMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD025_UOn,AUD_FSD025_GuidKey,'TAMOD',AUD_old_TAMOD,AUD_new_TAMOD FROM BANTPROD.AUD_FSD025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD025_UOn AND AUDMstId = AUD_FSD025_GuidKey AND AUDMstFld = 'TAMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD025_UOn,AUD_FSD025_GuidKey,'TAMTO',AUD_old_TAMTO,AUD_new_TAMTO FROM BANTPROD.AUD_FSD025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD025_UOn AND AUDMstId = AUD_FSD025_GuidKey AND AUDMstFld = 'TAMTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD025_UOn,AUD_FSD025_GuidKey,'TAPAP',AUD_old_TAPAP,AUD_new_TAPAP FROM BANTPROD.AUD_FSD025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD025_UOn AND AUDMstId = AUD_FSD025_GuidKey AND AUDMstFld = 'TAPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD025_UOn,AUD_FSD025_GuidKey,'TATTAS',AUD_old_TATTAS,AUD_new_TATTAS FROM BANTPROD.AUD_FSD025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD025_UOn AND AUDMstId = AUD_FSD025_GuidKey AND AUDMstFld = 'TATTAS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD025_UOn,AUD_FSD025_GuidKey,'TPIZAR',AUD_old_TPIZAR,AUD_new_TPIZAR FROM BANTPROD.AUD_FSD025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD025_UOn AND AUDMstId = AUD_FSD025_GuidKey AND AUDMstFld = 'TPIZAR'); DELETE FROM AUD_FSD025_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD025_UOn AND AUDMstId = AUD_FSD025_GuidKey);  COMMIT ;END IF
;END;
/

