CREATE OR REPLACE PROCEDURE AUD_C_FSR427_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSR427_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'FSR427',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|TASCTA=', RTRIM(COALESCE(AUD_old_TASCTA,AUD_new_TASCTA)) ),CONCAT( '|TASEMP=', RTRIM(COALESCE(AUD_old_TASEMP,AUD_new_TASEMP)) ) ),CONCAT( '|TASFDES=', RTRIM(COALESCE(AUD_old_TASFDES,AUD_new_TASFDES)) ) ),CONCAT( '|TASMDA=', RTRIM(COALESCE(AUD_old_TASMDA,AUD_new_TASMDA)) ) ),CONCAT( '|TASMOD=', RTRIM(COALESCE(AUD_old_TASMOD,AUD_new_TASMOD)) ) ),CONCAT( '|TASMTO=', RTRIM(COALESCE(AUD_old_TASMTO,AUD_new_TASMTO)) ) ),CONCAT( '|TASPAP=', RTRIM(COALESCE(AUD_old_TASPAP,AUD_new_TASPAP)) ) ),CONCAT( '|TASPIZ=', RTRIM(COALESCE(AUD_old_TASPIZ,AUD_new_TASPIZ)) ) ),CONCAT( '|TASPZO=', RTRIM(COALESCE(AUD_old_TASPZO,AUD_new_TASPZO)) ) ),CONCAT( '|TASSOP=', RTRIM(COALESCE(AUD_old_TASSOP,AUD_new_TASSOP)) ) ),'|' ),AUD_FSR427_UBT,AUD_FSR427_UBU,AUD_FSR427_UBM,AUD_FSR427_UBP,AUD_FSR427_UBR,AUD_FSR427_UAs,AUD_FSR427_UBC,AUD_FSR427_UBA,AUD_FSR427_UBS, '', 'BANTOTAL', '', '', '',AUD_FSR427_UT FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'TASCTA',AUD_old_TASCTA,AUD_new_TASCTA FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey AND AUDMstFld = 'TASCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'TASEMP',AUD_old_TASEMP,AUD_new_TASEMP FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey AND AUDMstFld = 'TASEMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'TASFDES',TO_CHAR(AUD_old_TASFDES,'YYYY-MM-DD'),TO_CHAR(AUD_new_TASFDES,'YYYY-MM-DD') FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey AND AUDMstFld = 'TASFDES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'TASMDA',AUD_old_TASMDA,AUD_new_TASMDA FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey AND AUDMstFld = 'TASMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'TASMOD',AUD_old_TASMOD,AUD_new_TASMOD FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey AND AUDMstFld = 'TASMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'TASMTO',AUD_old_TASMTO,AUD_new_TASMTO FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey AND AUDMstFld = 'TASMTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'TASPAP',AUD_old_TASPAP,AUD_new_TASPAP FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey AND AUDMstFld = 'TASPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'TASPIZ',AUD_old_TASPIZ,AUD_new_TASPIZ FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey AND AUDMstFld = 'TASPIZ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'TASPZO',AUD_old_TASPZO,AUD_new_TASPZO FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELE
CT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey AND AUDMstFld = 'TASPZO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'TASSOP',AUD_old_TASSOP,AUD_new_TASSOP FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey AND AUDMstFld = 'TASSOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR427_UOn,AUD_FSR427_GuidKey,'TASTASA',AUD_old_TASTASA,AUD_new_TASTASA FROM BANTPROD.AUD_FSR427_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey AND AUDMstFld = 'TASTASA'); DELETE FROM AUD_FSR427_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR427_UOn AND AUDMstId = AUD_FSR427_GuidKey);  COMMIT ;END IF;END;
/

