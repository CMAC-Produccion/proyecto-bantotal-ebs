CREATE OR REPLACE PROCEDURE AUD_C_PRFT00_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_PRFT00_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFT00',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|MODULO=', RTRIM(COALESCE(AUD_old_MODULO,AUD_new_MODULO)) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|PRFGCOD=', RTRIM(COALESCE(AUD_old_PRFGCOD,AUD_new_PRFGCOD)) ) ),CONCAT( '|TRNRO=', RTRIM(COALESCE(AUD_old_TRNRO,AUD_new_TRNRO)) ) ),'|' ),AUD_PRFT00_UBT,AUD_PRFT00_UBU,AUD_PRFT00_UBM,AUD_PRFT00_UBP,AUD_PRFT00_UBR,AUD_PRFT00_UAs,AUD_PRFT00_UBC,AUD_PRFT00_UBA,AUD_PRFT00_UBS, '', 'BANTOTAL', '', '', '',AUD_PRFT00_UT FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'MODULO',AUD_old_MODULO,AUD_new_MODULO FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'MODULO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFGCOD',AUD_old_PRFGCOD,AUD_new_PRFGCOD FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFMTCONF',AUD_old_PRFMTCONF,AUD_new_PRFMTCONF FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFMTCONF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFMTFECAL',TO_CHAR(AUD_old_PRFMTFECAL,'YYYY-MM-DD'),TO_CHAR(AUD_new_PRFMTFECAL,'YYYY-MM-DD') FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFMTFECAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFMTFECIM',TO_CHAR(AUD_old_PRFMTFECIM,'YYYY-MM-DD'),TO_CHAR(AUD_new_PRFMTFECIM,'YYYY-MM-DD') FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFMTFECIM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFMTIMPAC',AUD_old_PRFMTIMPAC,AUD_new_PRFMTIMPAC FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFMTIMPAC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFMTING',AUD_old_PRFMTING,AUD_new_PRFMTING FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFMTING'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFMTPROD',AUD_old_PRFMTPROD,AUD_new_PRFMTPROD FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFMTPROD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFMTSN1',AUD_old_PRFMTSN1,AUD_new_PRFMTSN1 FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId =
 AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFMTSN1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFMTSN2',AUD_old_PRFMTSN2,AUD_new_PRFMTSN2 FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFMTSN2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFMTSN3',AUD_old_PRFMTSN3,AUD_new_PRFMTSN3 FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFMTSN3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFMTSUP',AUD_old_PRFMTSUP,AUD_new_PRFMTSUP FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFMTSUP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'PRFMTUSER',AUD_old_PRFMTUSER,AUD_new_PRFMTUSER FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'PRFMTUSER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PRFT00_UOn,AUD_PRFT00_GuidKey,'TRNRO',AUD_old_TRNRO,AUD_new_TRNRO FROM BANTPROD.AUD_PRFT00_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey AND AUDMstFld = 'TRNRO'); DELETE FROM AUD_PRFT00_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_PRFT00_UOn AND AUDMstId = AUD_PRFT00_GuidKey);  COMMIT ;END IF;END;
/

