CREATE OR REPLACE PROCEDURE AUD_C_FSD027_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD027_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'FSD027',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|CTNRO=', RTRIM(COALESCE(AUD_old_CTNRO,AUD_new_CTNRO)) ),CONCAT( '|MODULO=', RTRIM(COALESCE(AUD_old_MODULO,AUD_new_MODULO)) ) ),CONCAT( '|MONEDA=', RTRIM(COALESCE(AUD_old_MONEDA,AUD_new_MONEDA)) ) ),CONCAT( '|PAPEL=', RTRIM(COALESCE(AUD_old_PAPEL,AUD_new_PAPEL)) ) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|TPFDES=', RTRIM(COALESCE(AUD_old_TPFDES,AUD_new_TPFDES)) ) ),CONCAT( '|TPIZAR=', RTRIM(COALESCE(AUD_old_TPIZAR,AUD_new_TPIZAR)) ) ),CONCAT( '|TPMTO=', RTRIM(COALESCE(AUD_old_TPMTO,AUD_new_TPMTO)) ) ),'|' ),AUD_FSD027_UBT,AUD_FSD027_UBU,AUD_FSD027_UBM,AUD_FSD027_UBP,AUD_FSD027_UBR,AUD_FSD027_UAs,AUD_FSD027_UBC,AUD_FSD027_UBA,AUD_FSD027_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD027_UT FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'CTNRO',AUD_old_CTNRO,AUD_new_CTNRO FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey AND AUDMstFld = 'CTNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'MODULO',AUD_old_MODULO,AUD_new_MODULO FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey AND AUDMstFld = 'MODULO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'MONEDA',AUD_old_MONEDA,AUD_new_MONEDA FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey AND AUDMstFld = 'MONEDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'PAPEL',AUD_old_PAPEL,AUD_new_PAPEL FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey AND AUDMstFld = 'PAPEL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'TPFDES',TO_CHAR(AUD_old_TPFDES,'YYYY-MM-DD'),TO_CHAR(AUD_new_TPFDES,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey AND AUDMstFld = 'TPFDES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'TPFINV',AUD_old_TPFINV,AUD_new_TPFINV FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey AND AUDMstFld = 'TPFINV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'TPIZAR',AUD_old_TPIZAR,AUD_new_TPIZAR FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey AND AUDMstFld = 'TPIZAR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'TPMTO',AUD_old_TPMTO,AUD_new_TPMTO FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey AND AUDMstFld = 'TPMTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'TPT
TAS',AUD_old_TPTTAS,AUD_new_TPTTAS FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey AND AUDMstFld = 'TPTTAS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD027_UOn,AUD_FSD027_GuidKey,'TPVIG',AUD_old_TPVIG,AUD_new_TPVIG FROM BANTPROD.AUD_FSD027_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey AND AUDMstFld = 'TPVIG'); DELETE FROM AUD_FSD027_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD027_UOn AND AUDMstId = AUD_FSD027_GuidKey);  COMMIT ;END IF;END;
/

