CREATE OR REPLACE PROCEDURE AUD_C_MBC006_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_MBC006_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBC006',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|MBCCFCH=', RTRIM(COALESCE(AUD_old_MBCCFCH,AUD_new_MBCCFCH)) ),CONCAT( '|MBCCHRA=', RTRIM(COALESCE(AUD_old_MBCCHRA,AUD_new_MBCCHRA)) ) ),CONCAT( '|MBCCMON=', RTRIM(COALESCE(AUD_old_MBCCMON,AUD_new_MBCCMON)) ) ),CONCAT( '|MBCCTPO=', RTRIM(COALESCE(AUD_old_MBCCTPO,AUD_new_MBCCTPO)) ) ),CONCAT( '|MBCCVAL=', RTRIM(COALESCE(AUD_old_MBCCVAL,AUD_new_MBCCVAL)) ) ),CONCAT( '|MBCEMP=', RTRIM(COALESCE(AUD_old_MBCEMP,AUD_new_MBCEMP)) ) ),CONCAT( '|MBCRUB=', RTRIM(COALESCE(AUD_old_MBCRUB,AUD_new_MBCRUB)) ) ),CONCAT( '|MBCSUC=', RTRIM(COALESCE(AUD_old_MBCSUC,AUD_new_MBCSUC)) ) ),'|' ),AUD_MBC006_UBT,AUD_MBC006_UBU,AUD_MBC006_UBM,AUD_MBC006_UBP,AUD_MBC006_UBR,AUD_MBC006_UAs,AUD_MBC006_UBC,AUD_MBC006_UBA,AUD_MBC006_UBS, '', 'BANTOTAL', '', '', '',AUD_MBC006_UT FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBC6AUX1',AUD_old_MBC6AUX1,AUD_new_MBC6AUX1 FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBC6AUX1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBC6AUX2',AUD_old_MBC6AUX2,AUD_new_MBC6AUX2 FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBC6AUX2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCCAJ',AUD_old_MBCCAJ,AUD_new_MBCCAJ FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCCAJ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCCEGR',AUD_old_MBCCEGR,AUD_new_MBCCEGR FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCCEGR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCCFCH',TO_CHAR(AUD_old_MBCCFCH,'YYYY-MM-DD'),TO_CHAR(AUD_new_MBCCFCH,'YYYY-MM-DD') FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCCFCH'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCCHRA',AUD_old_MBCCHRA,AUD_new_MBCCHRA FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCCHRA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCCING',AUD_old_MBCCING,AUD_new_MBCCING FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCCING'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCCINI',AUD_old_MBCCINI,AUD_new_MBCCINI FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCCINI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCCMON',AUD_old_MBCCMON,AUD_new_MBCCMON FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'M
BCCMON'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCCTPO',AUD_old_MBCCTPO,AUD_new_MBCCTPO FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCCTPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCCUSU',AUD_old_MBCCUSU,AUD_new_MBCCUSU FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCCUSU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCCVAL',AUD_old_MBCCVAL,AUD_new_MBCCVAL FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCCVAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCEGRIN',AUD_old_MBCEGRIN,AUD_new_MBCEGRIN FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCEGRIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCEMP',AUD_old_MBCEMP,AUD_new_MBCEMP FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCEMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCINGIN',AUD_old_MBCINGIN,AUD_new_MBCINGIN FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCINGIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCINIIN',AUD_old_MBCINIIN,AUD_new_MBCINIIN FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCINIIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCRUB',AUD_old_MBCRUB,AUD_new_MBCRUB FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCRUB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC006_UOn,AUD_MBC006_GuidKey,'MBCSUC',AUD_old_MBCSUC,AUD_new_MBCSUC FROM BANTPROD.AUD_MBC006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey AND AUDMstFld = 'MBCSUC'); DELETE FROM AUD_MBC006_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_MBC006_UOn AND AUDMstId = AUD_MBC006_GuidKey);  COMMIT ;END IF;END;
/

