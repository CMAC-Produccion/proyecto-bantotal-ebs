CREATE OR REPLACE PROCEDURE AUD_C_SNG065_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG065_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065',CONCAT( CONCAT( CONCAT( '|SNG062AUT=', RTRIM(COALESCE(AUD_old_SNG062AUT,AUD_new_SNG062AUT)) ),CONCAT( '|SNG065ORD=', RTRIM(COALESCE(AUD_old_SNG065ORD,AUD_new_SNG065ORD)) ) ),'|' ),AUD_SNG065_UBT,AUD_SNG065_UBU,AUD_SNG065_UBM,AUD_SNG065_UBP,AUD_SNG065_UBR,AUD_SNG065_UAs,AUD_SNG065_UBC,AUD_SNG065_UBA,AUD_SNG065_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG065_UT FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG046MTO',AUD_old_SNG046MTO,AUD_new_SNG046MTO FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG046MTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG062AUT',AUD_old_SNG062AUT,AUD_new_SNG062AUT FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG062AUT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065CAR',AUD_old_SNG065CAR,AUD_new_SNG065CAR FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065CAR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065COM',AUD_old_SNG065COM,AUD_new_SNG065COM FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065COM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065EMP',AUD_old_SNG065EMP,AUD_new_SNG065EMP FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065EMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065EST',AUD_old_SNG065EST,AUD_new_SNG065EST FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065EST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065FAP',TO_CHAR(AUD_old_SNG065FAP,'YYYY-MM-DD'),TO_CHAR(AUD_new_SNG065FAP,'YYYY-MM-DD') FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065FAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065INS',AUD_old_SNG065INS,AUD_new_SNG065INS FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065INS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065NOW',TO_CHAR(AUD_old_SNG065NOW,'YYYY-MM-DD'),TO_CHAR(AUD_new_SNG065NOW,'YYYY-MM-DD') FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065NOW'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065ORD',AUD_old_SNG065ORD,AUD_new_SNG065ORD FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065ORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SN
G065_GuidKey,'SNG065RES',AUD_old_SNG065RES,AUD_new_SNG065RES FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065RES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065SUC',AUD_old_SNG065SUC,AUD_new_SNG065SUC FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065SUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065SUP',AUD_old_SNG065SUP,AUD_new_SNG065SUP FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065SUP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065USR',AUD_old_SNG065USR,AUD_new_SNG065USR FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065USR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG065_UOn,AUD_SNG065_GuidKey,'SNG065WRK',AUD_old_SNG065WRK,AUD_new_SNG065WRK FROM BANTPROD.AUD_SNG065_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey AND AUDMstFld = 'SNG065WRK'); DELETE FROM AUD_SNG065_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG065_UOn AND AUDMstId = AUD_SNG065_GuidKey);  COMMIT ;END IF;END;
/

