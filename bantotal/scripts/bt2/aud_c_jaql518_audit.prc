CREATE OR REPLACE PROCEDURE AUD_C_JAQL518_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_JAQL518_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_JAQL518_UOn,AUD_JAQL518_GuidKey,'JAQL518',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|JAQL518COENT=', RTRIM(COALESCE(AUD_old_JAQL518COENT,AUD_new_JAQL518COENT)) ),CONCAT( '|JAQL518COTSV=', RTRIM(COALESCE(AUD_old_JAQL518COTSV,AUD_new_JAQL518COTSV)) ) ),CONCAT( '|JAQL518PGCOD=', RTRIM(COALESCE(AUD_old_JAQL518PGCOD,AUD_new_JAQL518PGCOD)) ) ),CONCAT( '|JAQL518PGSUC=', RTRIM(COALESCE(AUD_old_JAQL518PGSUC,AUD_new_JAQL518PGSUC)) ) ),'|' ),AUD_JAQL518_UBT,AUD_JAQL518_UBU,AUD_JAQL518_UBM,AUD_JAQL518_UBP,AUD_JAQL518_UBR,AUD_JAQL518_UAs,AUD_JAQL518_UBC,AUD_JAQL518_UBA,AUD_JAQL518_UBS, '', 'BANTOTAL', '', '', '',AUD_JAQL518_UT FROM BANTPROD.AUD_JAQL518_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_JAQL518_UOn AND AUDMstId = AUD_JAQL518_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQL518_UOn,AUD_JAQL518_GuidKey,'JAQL518COBRA',AUD_old_JAQL518COBRA,AUD_new_JAQL518COBRA FROM BANTPROD.AUD_JAQL518_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQL518_UOn AND AUDMstId = AUD_JAQL518_GuidKey AND AUDMstFld = 'JAQL518COBRA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQL518_UOn,AUD_JAQL518_GuidKey,'JAQL518COENT',AUD_old_JAQL518COENT,AUD_new_JAQL518COENT FROM BANTPROD.AUD_JAQL518_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQL518_UOn AND AUDMstId = AUD_JAQL518_GuidKey AND AUDMstFld = 'JAQL518COENT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQL518_UOn,AUD_JAQL518_GuidKey,'JAQL518COTSV',AUD_old_JAQL518COTSV,AUD_new_JAQL518COTSV FROM BANTPROD.AUD_JAQL518_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQL518_UOn AND AUDMstId = AUD_JAQL518_GuidKey AND AUDMstFld = 'JAQL518COTSV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQL518_UOn,AUD_JAQL518_GuidKey,'JAQL518ESREG',AUD_old_JAQL518ESREG,AUD_new_JAQL518ESREG FROM BANTPROD.AUD_JAQL518_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQL518_UOn AND AUDMstId = AUD_JAQL518_GuidKey AND AUDMstFld = 'JAQL518ESREG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQL518_UOn,AUD_JAQL518_GuidKey,'JAQL518EXONE',AUD_old_JAQL518EXONE,AUD_new_JAQL518EXONE FROM BANTPROD.AUD_JAQL518_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQL518_UOn AND AUDMstId = AUD_JAQL518_GuidKey AND AUDMstFld = 'JAQL518EXONE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQL518_UOn,AUD_JAQL518_GuidKey,'JAQL518PGCOD',AUD_old_JAQL518PGCOD,AUD_new_JAQL518PGCOD FROM BANTPROD.AUD_JAQL518_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQL518_UOn AND AUDMstId = AUD_JAQL518_GuidKey AND AUDMstFld = 'JAQL518PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQL518_UOn,AUD_JAQL518_GuidKey,'JAQL518PGSUC',AUD_old_JAQL518PGSUC,AUD_new_JAQL518PGSUC FROM BANTPROD.AUD_JAQL518_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQL518_UOn AND AUDMstId = AUD_JAQL518_GuidKey AND AUDMstFld = 'JAQL518PGSUC'); DELETE FROM AUD_JAQL518_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_JAQL518_UOn AND AUDMstId = AUD_JAQL518_GuidKey);  COMMIT ;END IF;END;
/

