CREATE OR REPLACE PROCEDURE AUD_C_FST036_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST036_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST036_UOn,AUD_FST036_GuidKey,'FST036',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ),CONCAT( '|TRMOD=', RTRIM(COALESCE(AUD_old_TRMOD,AUD_new_TRMOD)) ) ),CONCAT( '|TRNRO=', RTRIM(COALESCE(AUD_old_TRNRO,AUD_new_TRNRO)) ) ),CONCAT( '|TRORD=', RTRIM(COALESCE(AUD_old_TRORD,AUD_new_TRORD)) ) ),CONCAT( '|TRSBOR=', RTRIM(COALESCE(AUD_old_TRSBOR,AUD_new_TRSBOR)) ) ),'|' ),AUD_FST036_UBT,AUD_FST036_UBU,AUD_FST036_UBM,AUD_FST036_UBP,AUD_FST036_UBR,AUD_FST036_UAs,AUD_FST036_UBC,AUD_FST036_UBA,AUD_FST036_UBS, '', 'BANTOTAL', '', '', '',AUD_FST036_UT FROM BANTPROD.AUD_FST036_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST036_UOn,AUD_FST036_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FST036_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST036_UOn,AUD_FST036_GuidKey,'TRCRES',AUD_old_TRCRES,AUD_new_TRCRES FROM BANTPROD.AUD_FST036_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey AND AUDMstFld = 'TRCRES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST036_UOn,AUD_FST036_GuidKey,'TRMOD',AUD_old_TRMOD,AUD_new_TRMOD FROM BANTPROD.AUD_FST036_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey AND AUDMstFld = 'TRMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST036_UOn,AUD_FST036_GuidKey,'TRMODU',AUD_old_TRMODU,AUD_new_TRMODU FROM BANTPROD.AUD_FST036_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey AND AUDMstFld = 'TRMODU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST036_UOn,AUD_FST036_GuidKey,'TRNRO',AUD_old_TRNRO,AUD_new_TRNRO FROM BANTPROD.AUD_FST036_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey AND AUDMstFld = 'TRNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST036_UOn,AUD_FST036_GuidKey,'TRORD',AUD_old_TRORD,AUD_new_TRORD FROM BANTPROD.AUD_FST036_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey AND AUDMstFld = 'TRORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST036_UOn,AUD_FST036_GuidKey,'TRRCOD',AUD_old_TRRCOD,AUD_new_TRRCOD FROM BANTPROD.AUD_FST036_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey AND AUDMstFld = 'TRRCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST036_UOn,AUD_FST036_GuidKey,'TRRORD',AUD_old_TRRORD,AUD_new_TRRORD FROM BANTPROD.AUD_FST036_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey AND AUDMstFld = 'TRRORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST036_UOn,AUD_FST036_GuidKey,'TRRUBR',AUD_old_TRRUBR,AUD_new_TRRUBR FROM BANTPROD.AUD_FST036_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey AND AUDMstFld = 'TRRUBR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST036_UOn,AUD_FST036_GuidKey,'TRSBOR',AUD_old_TRSBOR,AUD_new_TRSBOR FROM BANTPROD.AUD_FST036_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey AND AUDMstFld = 'TRSBOR'); DELETE FROM AUD_FST036_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD00
4 WHERE AUDMstTim = AUD_FST036_UOn AND AUDMstId = AUD_FST036_GuidKey);  COMMIT ;END IF;END;
/

