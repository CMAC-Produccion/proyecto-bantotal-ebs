CREATE OR REPLACE PROCEDURE AUD_C_AQPB408_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_AQPB408_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|AQPB408COD=', RTRIM(COALESCE(AUD_old_AQPB408COD,AUD_new_AQPB408COD)) ),CONCAT( '|AQPB408CTA=', RTRIM(COALESCE(AUD_old_AQPB408CTA,AUD_new_AQPB408CTA)) ) ),CONCAT( '|AQPB408ITCOD=', RTRIM(COALESCE(AUD_old_AQPB408ITCOD,AUD_new_AQPB408ITCOD)) ) ),CONCAT( '|AQPB408ITFCON=', RTRIM(COALESCE(AUD_old_AQPB408ITFCON,AUD_new_AQPB408ITFCON)) ) ),CONCAT( '|AQPB408ITMOD=', RTRIM(COALESCE(AUD_old_AQPB408ITMOD,AUD_new_AQPB408ITMOD)) ) ),CONCAT( '|AQPB408ITNREL=', RTRIM(COALESCE(AUD_old_AQPB408ITNREL,AUD_new_AQPB408ITNREL)) ) ),CONCAT( '|AQPB408ITSUC=', RTRIM(COALESCE(AUD_old_AQPB408ITSUC,AUD_new_AQPB408ITSUC)) ) ),CONCAT( '|AQPB408ITTRAN=', RTRIM(COALESCE(AUD_old_AQPB408ITTRAN,AUD_new_AQPB408ITTRAN)) ) ),CONCAT( '|AQPB408MDA=', RTRIM(COALESCE(AUD_old_AQPB408MDA,AUD_new_AQPB408MDA)) ) ),CONCAT( '|AQPB408MOD=', RTRIM(COALESCE(AUD_old_AQPB408MOD,AUD_new_AQPB408MOD)) ) ),CONCAT( '|AQPB408OPE=', RTRIM(COALESCE(AUD_old_AQPB408OPE,AUD_new_AQPB408OPE)) ) ),CONCAT( '|AQPB408PAP=', RTRIM(COALESCE(AUD_old_AQPB408PAP,AUD_new_AQPB408PAP)) ) ),CONCAT( '|AQPB408SBO=', RTRIM(COALESCE(AUD_old_AQPB408SBO,AUD_new_AQPB408SBO)) ) ),CONCAT( '|AQPB408SUC=', RTRIM(COALESCE(AUD_old_AQPB408SUC,AUD_new_AQPB408SUC)) ) ),CONCAT( '|AQPB408TPO=', RTRIM(COALESCE(AUD_old_AQPB408TPO,AUD_new_AQPB408TPO)) ) ),'|' ),AUD_AQPB408_UBT,AUD_AQPB408_UBU,AUD_AQPB408_UBM,AUD_AQPB408_UBP,AUD_AQPB408_UBR,AUD_AQPB408_UAs,AUD_AQPB408_UBC,AUD_AQPB408_UBA,AUD_AQPB408_UBS, '', 'BANTOTAL', '', '', '',AUD_AQPB408_UT FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408AUX01',AUD_old_AQPB408AUX01,AUD_new_AQPB408AUX01 FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408AUX01'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408AUX02',AUD_old_AQPB408AUX02,AUD_new_AQPB408AUX02 FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408AUX02'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408COD',AUD_old_AQPB408COD,AUD_new_AQPB408COD FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408COM',AUD_old_AQPB408COM,AUD_new_AQPB408COM FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408COM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408CTA',AUD_old_AQPB408CTA,AUD_new_AQPB408CTA FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408CTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408EST',AUD_old_AQPB408EST,AUD_new_AQPB408EST FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408E
ST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408FECACT',TO_CHAR(AUD_old_AQPB408FECACT,'YYYY-MM-DD'),TO_CHAR(AUD_new_AQPB408FECACT,'YYYY-MM-DD') FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408FECACT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408FECAMOR',TO_CHAR(AUD_old_AQPB408FECAMOR,'YYYY-MM-DD'),TO_CHAR(AUD_new_AQPB408FECAMOR,'YYYY-MM-DD') FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408FECAMOR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408FECEXT',TO_CHAR(AUD_old_AQPB408FECEXT,'YYYY-MM-DD'),TO_CHAR(AUD_new_AQPB408FECEXT,'YYYY-MM-DD') FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408FECEXT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408ITCOD',AUD_old_AQPB408ITCOD,AUD_new_AQPB408ITCOD FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408ITCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408ITFCON',TO_CHAR(AUD_old_AQPB408ITFCON,'YYYY-MM-DD'),TO_CHAR(AUD_new_AQPB408ITFCON,'YYYY-MM-DD') FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408ITFCON'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408ITMOD',AUD_old_AQPB408ITMOD,AUD_new_AQPB408ITMOD FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408ITMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408ITNREL',AUD_old_AQPB408ITNREL,AUD_new_AQPB408ITNREL FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408ITNREL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408ITSUC',AUD_old_AQPB408ITSUC,AUD_new_AQPB408ITSUC FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408ITSUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408ITTRAN',AUD_old_AQPB408ITTRAN,AUD_new_AQPB408ITTRAN FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408ITTRAN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408MDA',AUD_old_AQPB408MDA,AUD_new_AQPB408MDA FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408MDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408MOD',AUD_old_AQPB408MOD,AUD_new_AQPB408MOD FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408OPE',AUD_old_AQPB408OPE,AUD_new_AQPB408OPE FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408OPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408PAP',AUD_old_AQ
PB408PAP,AUD_new_AQPB408PAP FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408PAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408SBO',AUD_old_AQPB408SBO,AUD_new_AQPB408SBO FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408SBO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408SUC',AUD_old_AQPB408SUC,AUD_new_AQPB408SUC FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408SUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408TIP',AUD_old_AQPB408TIP,AUD_new_AQPB408TIP FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408TIP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408TPO',AUD_old_AQPB408TPO,AUD_new_AQPB408TPO FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408TPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AQPB408_UOn,AUD_AQPB408_GuidKey,'AQPB408USUACT',AUD_old_AQPB408USUACT,AUD_new_AQPB408USUACT FROM BANTPROD.AUD_AQPB408_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey AND AUDMstFld = 'AQPB408USUACT'); DELETE FROM AUD_AQPB408_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_AQPB408_UOn AND AUDMstId = AUD_AQPB408_GuidKey);  COMMIT ;END IF;END;
/

