CREATE OR REPLACE PROCEDURE AUD_C_FSR101_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSR101_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'FSR101',CONCAT( CONCAT( CONCAT( CONCAT( '|PBCOD=', RTRIM(COALESCE(AUD_old_PBCOD,AUD_new_PBCOD)) ),CONCAT( '|PBNSEC=', RTRIM(COALESCE(AUD_old_PBNSEC,AUD_new_PBNSEC)) ) ),CONCAT( '|PBTHREAD=', RTRIM(COALESCE(AUD_old_PBTHREAD,AUD_new_PBTHREAD)) ) ),'|' ),AUD_FSR101_UBT,AUD_FSR101_UBU,AUD_FSR101_UBM,AUD_FSR101_UBP,AUD_FSR101_UBR,AUD_FSR101_UAs,AUD_FSR101_UBC,AUD_FSR101_UBA,AUD_FSR101_UBS, '', 'BANTOTAL', '', '', '',AUD_FSR101_UT FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBCOD',AUD_old_PBCOD,AUD_new_PBCOD FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBD1',AUD_old_PBD1,AUD_new_PBD1 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBD1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBD2',AUD_old_PBD2,AUD_new_PBD2 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBD2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBD3',AUD_old_PBD3,AUD_new_PBD3 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBD3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBD4',AUD_old_PBD4,AUD_new_PBD4 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBD4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBD5',AUD_old_PBD5,AUD_new_PBD5 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBD5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBD6',AUD_old_PBD6,AUD_new_PBD6 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBD6'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBD7',AUD_old_PBD7,AUD_new_PBD7 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBD7'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBD8',AUD_old_PBD8,AUD_new_PBD8 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBD8'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBH1',AUD_old_PBH1,AUD_new_PBH1 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBH1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBH2',AUD_old_PBH2,AUD_new_PBH2 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBH2'); INS
ERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBH3',AUD_old_PBH3,AUD_new_PBH3 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBH3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBH4',AUD_old_PBH4,AUD_new_PBH4 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBH4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBH5',AUD_old_PBH5,AUD_new_PBH5 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBH5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBH6',AUD_old_PBH6,AUD_new_PBH6 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBH6'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBH7',AUD_old_PBH7,AUD_new_PBH7 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBH7'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBH8',AUD_old_PBH8,AUD_new_PBH8 FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBH8'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBIMPR',AUD_old_PBIMPR,AUD_new_PBIMPR FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBIMPR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBNSEC',AUD_old_PBNSEC,AUD_new_PBNSEC FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBNSEC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBPATH',AUD_old_PBPATH,AUD_new_PBPATH FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBPATH'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR101_UOn,AUD_FSR101_GuidKey,'PBTHREAD',AUD_old_PBTHREAD,AUD_new_PBTHREAD FROM BANTPROD.AUD_FSR101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey AND AUDMstFld = 'PBTHREAD'); DELETE FROM AUD_FSR101_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR101_UOn AND AUDMstId = AUD_FSR101_GuidKey);  COMMIT ;END IF;END;
/

