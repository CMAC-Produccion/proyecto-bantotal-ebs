CREATE OR REPLACE PROCEDURE AUD_C_FSR011_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSR011_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'FSR011',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|R1COD=', RTRIM(COALESCE(AUD_old_R1COD,AUD_new_R1COD)) ),CONCAT( '|R1CTA=', RTRIM(COALESCE(AUD_old_R1CTA,AUD_new_R1CTA)) ) ),CONCAT( '|R1MDA=', RTRIM(COALESCE(AUD_old_R1MDA,AUD_new_R1MDA)) ) ),CONCAT( '|R1MOD=', RTRIM(COALESCE(AUD_old_R1MOD,AUD_new_R1MOD)) ) ),CONCAT( '|R1OPER=', RTRIM(COALESCE(AUD_old_R1OPER,AUD_new_R1OPER)) ) ),CONCAT( '|R1PAP=', RTRIM(COALESCE(AUD_old_R1PAP,AUD_new_R1PAP)) ) ),CONCAT( '|R1SBOP=', RTRIM(COALESCE(AUD_old_R1SBOP,AUD_new_R1SBOP)) ) ),CONCAT( '|R1SUC=', RTRIM(COALESCE(AUD_old_R1SUC,AUD_new_R1SUC)) ) ),CONCAT( '|R1TOPE=', RTRIM(COALESCE(AUD_old_R1TOPE,AUD_new_R1TOPE)) ) ),CONCAT( '|R2CTA=', RTRIM(COALESCE(AUD_old_R2CTA,AUD_new_R2CTA)) ) ),CONCAT( '|R2MOD=', RTRIM(COALESCE(AUD_old_R2MOD,AUD_new_R2MOD)) ) ),CONCAT( '|R2OPER=', RTRIM(COALESCE(AUD_old_R2OPER,AUD_new_R2OPER)) ) ),CONCAT( '|R2SBOP=', RTRIM(COALESCE(AUD_old_R2SBOP,AUD_new_R2SBOP)) ) ),CONCAT( '|RELCOD=', RTRIM(COALESCE(AUD_old_RELCOD,AUD_new_RELCOD)) ) ),'|' ),AUD_FSR011_UBT,AUD_FSR011_UBU,AUD_FSR011_UBM,AUD_FSR011_UBP,AUD_FSR011_UBR,AUD_FSR011_UAs,AUD_FSR011_UBC,AUD_FSR011_UBA,AUD_FSR011_UBS, '', 'BANTOTAL', '', '', '',AUD_FSR011_UT FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R011CD',AUD_old_R011CD,AUD_new_R011CD FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R011CD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R011CO',AUD_old_R011CO,AUD_new_R011CO FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R011CO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R011FC',TO_CHAR(AUD_old_R011FC,'YYYY-MM-DD'),TO_CHAR(AUD_new_R011FC,'YYYY-MM-DD') FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R011FC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R011MO',AUD_old_R011MO,AUD_new_R011MO FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R011MO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R011OR',AUD_old_R011OR,AUD_new_R011OR FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R011OR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R011RE',AUD_old_R011RE,AUD_new_R011RE FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R011RE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R011SB',AUD_old_R011SB,AUD_new_R011SB FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R011SB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R011SU',AUD_old_R011SU,AUD_new_R011SU FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (
SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R011SU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R011TR',AUD_old_R011TR,AUD_new_R011TR FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R011TR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R1COD',AUD_old_R1COD,AUD_new_R1COD FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R1COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R1CTA',AUD_old_R1CTA,AUD_new_R1CTA FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R1CTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R1MDA',AUD_old_R1MDA,AUD_new_R1MDA FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R1MDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R1MOD',AUD_old_R1MOD,AUD_new_R1MOD FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R1MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R1OPER',AUD_old_R1OPER,AUD_new_R1OPER FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R1OPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R1PAP',AUD_old_R1PAP,AUD_new_R1PAP FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R1PAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R1RUB',AUD_old_R1RUB,AUD_new_R1RUB FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R1RUB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R1SBOP',AUD_old_R1SBOP,AUD_new_R1SBOP FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R1SBOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R1SUC',AUD_old_R1SUC,AUD_new_R1SUC FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R1SUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R1TOPE',AUD_old_R1TOPE,AUD_new_R1TOPE FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R1TOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R2COD',AUD_old_R2COD,AUD_new_R2COD FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R2COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R2CTA',AUD_old_R2CTA,AUD_new_R2CTA FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R2CTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R2MDA',AUD_old_R2MDA,AUD_new_R2MDA FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDM
stFld = 'R2MDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R2MOD',AUD_old_R2MOD,AUD_new_R2MOD FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R2MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R2OPER',AUD_old_R2OPER,AUD_new_R2OPER FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R2OPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R2PAP',AUD_old_R2PAP,AUD_new_R2PAP FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R2PAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R2RUB',AUD_old_R2RUB,AUD_new_R2RUB FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R2RUB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R2SBOP',AUD_old_R2SBOP,AUD_new_R2SBOP FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R2SBOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R2SUC',AUD_old_R2SUC,AUD_new_R2SUC FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R2SUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'R2TOPE',AUD_old_R2TOPE,AUD_new_R2TOPE FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'R2TOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR011_UOn,AUD_FSR011_GuidKey,'RELCOD',AUD_old_RELCOD,AUD_new_RELCOD FROM BANTPROD.AUD_FSR011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey AND AUDMstFld = 'RELCOD'); DELETE FROM AUD_FSR011_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR011_UOn AND AUDMstId = AUD_FSR011_GuidKey);  COMMIT ;END IF;END;
/

