CREATE OR REPLACE PROCEDURE AUD_C_FSD005_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD005_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'FSD005',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|DOCOD=', RTRIM(COALESCE(AUD_old_DOCOD,AUD_new_DOCOD)) ),CONCAT( '|PENDOC=', RTRIM(COALESCE(AUD_old_PENDOC,AUD_new_PENDOC)) ) ),CONCAT( '|PEPAIS=', RTRIM(COALESCE(AUD_old_PEPAIS,AUD_new_PEPAIS)) ) ),CONCAT( '|PETDOC=', RTRIM(COALESCE(AUD_old_PETDOC,AUD_new_PETDOC)) ) ),'|' ),AUD_FSD005_UBT,AUD_FSD005_UBU,AUD_FSD005_UBM,AUD_FSD005_UBP,AUD_FSD005_UBR,AUD_FSD005_UAs,AUD_FSD005_UBC,AUD_FSD005_UBA,AUD_FSD005_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD005_UT FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'DOAPARP',AUD_old_DOAPARP,AUD_new_DOAPARP FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'DOAPARP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'DOCALLP',AUD_old_DOCALLP,AUD_new_DOCALLP FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'DOCALLP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'DOCCORP',AUD_old_DOCCORP,AUD_new_DOCCORP FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'DOCCORP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'DOCIUDP',AUD_old_DOCIUDP,AUD_new_DOCIUDP FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'DOCIUDP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'DOCOD',AUD_old_DOCOD,AUD_new_DOCOD FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'DOCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'DOCPOSP',AUD_old_DOCPOSP,AUD_new_DOCPOSP FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'DOCPOSP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'DODEPCODP',AUD_old_DODEPCODP,AUD_new_DODEPCODP FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'DODEPCODP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'DODEPTP',AUD_old_DODEPTP,AUD_new_DODEPTP FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'DODEPTP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'DONROP',AUD_old_DONROP,AUD_new_DONROP FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'DONROP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'DOPAISP',AUD_old_DOPAISP,AUD_new_DOPAISP FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'DOPAISP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'PENDOC',AUD_old_PENDO
C,AUD_new_PENDOC FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'PENDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'PEPAIS',AUD_old_PEPAIS,AUD_new_PEPAIS FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'PEPAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD005_UOn,AUD_FSD005_GuidKey,'PETDOC',AUD_old_PETDOC,AUD_new_PETDOC FROM BANTPROD.AUD_FSD005_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey AND AUDMstFld = 'PETDOC'); DELETE FROM AUD_FSD005_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD005_UOn AND AUDMstId = AUD_FSD005_GuidKey);  COMMIT ;END IF;END;
/

