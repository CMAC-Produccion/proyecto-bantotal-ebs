CREATE OR REPLACE PROCEDURE AUD_C_SNGP11_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNGP11_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP11',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|SNGP09COD=', RTRIM(COALESCE(AUD_old_SNGP09COD,AUD_new_SNGP09COD)) ),CONCAT( '|SNGP10MOD=', RTRIM(COALESCE(AUD_old_SNGP10MOD,AUD_new_SNGP10MOD)) ) ),CONCAT( '|SNGP10PGC=', RTRIM(COALESCE(AUD_old_SNGP10PGC,AUD_new_SNGP10PGC)) ) ),CONCAT( '|SNGP10TOPE=', RTRIM(COALESCE(AUD_old_SNGP10TOPE,AUD_new_SNGP10TOPE)) ) ),CONCAT( '|SNGP11MODR=', RTRIM(COALESCE(AUD_old_SNGP11MODR,AUD_new_SNGP11MODR)) ) ),CONCAT( '|SNGP11TOPR=', RTRIM(COALESCE(AUD_old_SNGP11TOPR,AUD_new_SNGP11TOPR)) ) ),'|' ),AUD_SNGP11_UBT,AUD_SNGP11_UBU,AUD_SNGP11_UBM,AUD_SNGP11_UBP,AUD_SNGP11_UBR,AUD_SNGP11_UAs,AUD_SNGP11_UBC,AUD_SNGP11_UBA,AUD_SNGP11_UBS, '', 'BANTOTAL', '', '', '',AUD_SNGP11_UT FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP09COD',AUD_old_SNGP09COD,AUD_new_SNGP09COD FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP09COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP10MOD',AUD_old_SNGP10MOD,AUD_new_SNGP10MOD FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP10MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP10PGC',AUD_old_SNGP10PGC,AUD_new_SNGP10PGC FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP10PGC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP10TOPE',AUD_old_SNGP10TOPE,AUD_new_SNGP10TOPE FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP10TOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP11CHR1',AUD_old_SNGP11CHR1,AUD_new_SNGP11CHR1 FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP11CHR1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP11CHR2',AUD_old_SNGP11CHR2,AUD_new_SNGP11CHR2 FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP11CHR2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP11CO14',AUD_old_SNGP11CO14,AUD_new_SNGP11CO14 FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP11CO14'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP11INTV',AUD_old_SNGP11INTV,AUD_new_SNGP11INTV FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP11INTV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP11LTCO',AUD_old_SNGP11LTCO,AUD_new_SNGP11LTCO FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP11LTCO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AU
D_SNGP11_GuidKey,'SNGP11MODR',AUD_old_SNGP11MODR,AUD_new_SNGP11MODR FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP11MODR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP11PGM1',AUD_old_SNGP11PGM1,AUD_new_SNGP11PGM1 FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP11PGM1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP11PORC',AUD_old_SNGP11PORC,AUD_new_SNGP11PORC FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP11PORC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP11SINT',AUD_old_SNGP11SINT,AUD_new_SNGP11SINT FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP11SINT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP11_UOn,AUD_SNGP11_GuidKey,'SNGP11TOPR',AUD_old_SNGP11TOPR,AUD_new_SNGP11TOPR FROM BANTPROD.AUD_SNGP11_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey AND AUDMstFld = 'SNGP11TOPR'); DELETE FROM AUD_SNGP11_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGP11_UOn AND AUDMstId = AUD_SNGP11_GuidKey);  COMMIT ;END IF;END;
/

