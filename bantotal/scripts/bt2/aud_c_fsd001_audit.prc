CREATE OR REPLACE PROCEDURE AUD_C_FSD001_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD001_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'FSD001',CONCAT( CONCAT( CONCAT( CONCAT( '|PENDOC=', RTRIM(COALESCE(AUD_old_PENDOC,AUD_new_PENDOC)) ),CONCAT( '|PEPAIS=', RTRIM(COALESCE(AUD_old_PEPAIS,AUD_new_PEPAIS)) ) ),CONCAT( '|PETDOC=', RTRIM(COALESCE(AUD_old_PETDOC,AUD_new_PETDOC)) ) ),'|' ),AUD_FSD001_UBT,AUD_FSD001_UBU,AUD_FSD001_UBM,AUD_FSD001_UBP,AUD_FSD001_UBR,AUD_FSD001_UAs,AUD_FSD001_UBC,AUD_FSD001_UBA,AUD_FSD001_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD001_UT FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEBCEAJINF',AUD_old_PEBCEAJINF,AUD_new_PEBCEAJINF FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEBCEAJINF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEBPS',AUD_old_PEBPS,AUD_new_PEBPS FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEBPS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PECONSFIN',AUD_old_PECONSFIN,AUD_new_PECONSFIN FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PECONSFIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEDGI',AUD_old_PEDGI,AUD_new_PEDGI FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEDGI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEEMB',AUD_old_PEEMB,AUD_new_PEEMB FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEEMB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEEXENTO',AUD_old_PEEXENTO,AUD_new_PEEXENTO FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEEXENTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEFALT',TO_CHAR(AUD_old_PEFALT,'YYYY-MM-DD'),TO_CHAR(AUD_new_PEFALT,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEFALT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEFBAJ',TO_CHAR(AUD_old_PEFBAJ,'YYYY-MM-DD'),TO_CHAR(AUD_new_PEFBAJ,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEFBAJ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEFEMB',TO_CHAR(AUD_old_PEFEMB,'YYYY-MM-DD'),TO_CHAR(AUD_new_PEFEMB,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEFEMB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEFJUI',TO_CHAR(AUD_old_PEFJUI,'YYYY-MM-DD'),TO_CHAR(AUD_new_PEFJUI,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEFJUI'); INS
ERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEFPBP',TO_CHAR(AUD_old_PEFPBP,'YYYY-MM-DD'),TO_CHAR(AUD_new_PEFPBP,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEFPBP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEFPDG',TO_CHAR(AUD_old_PEFPDG,'YYYY-MM-DD'),TO_CHAR(AUD_new_PEFPDG,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEFPDG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEFVBP',TO_CHAR(AUD_old_PEFVBP,'YYYY-MM-DD'),TO_CHAR(AUD_new_PEFVBP,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEFVBP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEFVDG',TO_CHAR(AUD_old_PEFVDG,'YYYY-MM-DD'),TO_CHAR(AUD_new_PEFVDG,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEFVDG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEIMPINTER',AUD_old_PEIMPINTER,AUD_new_PEIMPINTER FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEIMPINTER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEINGBRUTO',AUD_old_PEINGBRUTO,AUD_new_PEINGBRUTO FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEINGBRUTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEJUI',AUD_old_PEJUI,AUD_new_PEJUI FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEJUI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PENDOC',AUD_old_PENDOC,AUD_new_PENDOC FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PENDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PENOM',AUD_old_PENOM,AUD_new_PENOM FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PENOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PENORESPON',AUD_old_PENORESPON,AUD_new_PENORESPON FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PENORESPON'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PENROBRUTO',AUD_old_PENROBRUTO,AUD_new_PENROBRUTO FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PENROBRUTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PENROINTER',AUD_old_PENROINTER,AUD_new_PENROINTER FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PENROINTER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEPAIS',AUD_old_PEPAIS,AUD_new_PEPAIS FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEPAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PEPRES',AUD_old_PEPRES,AUD_new_P
EPRES FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PEPRES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PERESINSC',AUD_old_PERESINSC,AUD_new_PERESINSC FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PERESINSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PERESNOINS',AUD_old_PERESNOINS,AUD_new_PERESNOINS FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PERESNOINS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PERG2784',AUD_old_PERG2784,AUD_new_PERG2784 FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PERG2784'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PERG3125',AUD_old_PERG3125,AUD_new_PERG3125 FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PERG3125'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PERG3337',AUD_old_PERG3337,AUD_new_PERG3337 FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PERG3337'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PESN01',AUD_old_PESN01,AUD_new_PESN01 FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PESN01'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PESN02',AUD_old_PESN02,AUD_new_PESN02 FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PESN02'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PESN03',AUD_old_PESN03,AUD_new_PESN03 FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PESN03'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PETDOC',AUD_old_PETDOC,AUD_new_PETDOC FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PETDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PETIPO',AUD_old_PETIPO,AUD_new_PETIPO FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PETIPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD001_UOn,AUD_FSD001_GuidKey,'PETIPOEMPR',AUD_old_PETIPOEMPR,AUD_new_PETIPOEMPR FROM BANTPROD.AUD_FSD001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey AND AUDMstFld = 'PETIPOEMPR'); DELETE FROM AUD_FSD001_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD001_UOn AND AUDMstId = AUD_FSD001_GuidKey);  COMMIT ;END IF;END;
/

