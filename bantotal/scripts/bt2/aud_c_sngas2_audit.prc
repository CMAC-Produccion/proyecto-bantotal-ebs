CREATE OR REPLACE PROCEDURE AUD_C_SNGAS2_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNGAS2_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNGAS2_UOn,AUD_SNGAS2_GuidKey,'SNGAS2',CONCAT( CONCAT( CONCAT( '|SNGAS2COD=', RTRIM(COALESCE(AUD_old_SNGAS2COD,AUD_new_SNGAS2COD)) ),CONCAT( '|SNGAS2PGC=', RTRIM(COALESCE(AUD_old_SNGAS2PGC,AUD_new_SNGAS2PGC)) ) ),'|' ),AUD_SNGAS2_UBT,AUD_SNGAS2_UBU,AUD_SNGAS2_UBM,AUD_SNGAS2_UBP,AUD_SNGAS2_UBR,AUD_SNGAS2_UAs,AUD_SNGAS2_UBC,AUD_SNGAS2_UBA,AUD_SNGAS2_UBS, '', 'BANTOTAL', '', '', '',AUD_SNGAS2_UT FROM BANTPROD.AUD_SNGAS2_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGAS2_UOn AND AUDMstId = AUD_SNGAS2_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGAS2_UOn,AUD_SNGAS2_GuidKey,'SNGAS2COD',AUD_old_SNGAS2COD,AUD_new_SNGAS2COD FROM BANTPROD.AUD_SNGAS2_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGAS2_UOn AND AUDMstId = AUD_SNGAS2_GuidKey AND AUDMstFld = 'SNGAS2COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGAS2_UOn,AUD_SNGAS2_GuidKey,'SNGAS2INH',AUD_old_SNGAS2INH,AUD_new_SNGAS2INH FROM BANTPROD.AUD_SNGAS2_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGAS2_UOn AND AUDMstId = AUD_SNGAS2_GuidKey AND AUDMstFld = 'SNGAS2INH'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGAS2_UOn,AUD_SNGAS2_GuidKey,'SNGAS2PGC',AUD_old_SNGAS2PGC,AUD_new_SNGAS2PGC FROM BANTPROD.AUD_SNGAS2_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGAS2_UOn AND AUDMstId = AUD_SNGAS2_GuidKey AND AUDMstFld = 'SNGAS2PGC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGAS2_UOn,AUD_SNGAS2_GuidKey,'SNGAS2USR',AUD_old_SNGAS2USR,AUD_new_SNGAS2USR FROM BANTPROD.AUD_SNGAS2_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGAS2_UOn AND AUDMstId = AUD_SNGAS2_GuidKey AND AUDMstFld = 'SNGAS2USR'); DELETE FROM AUD_SNGAS2_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGAS2_UOn AND AUDMstId = AUD_SNGAS2_GuidKey);  COMMIT ;END IF;END;
/

