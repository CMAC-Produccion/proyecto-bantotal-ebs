CREATE OR REPLACE PROCEDURE AUD_C_SNG400_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG400_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400',CONCAT( CONCAT( CONCAT( '|SNG400COD=', RTRIM(COALESCE(AUD_old_SNG400COD,AUD_new_SNG400COD)) ),CONCAT( '|SNG400EVTO=', RTRIM(COALESCE(AUD_old_SNG400EVTO,AUD_new_SNG400EVTO)) ) ),'|' ),AUD_SNG400_UBT,AUD_SNG400_UBU,AUD_SNG400_UBM,AUD_SNG400_UBP,AUD_SNG400_UBR,AUD_SNG400_UAs,AUD_SNG400_UBC,AUD_SNG400_UBA,AUD_SNG400_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG400_UT FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400COD',AUD_old_SNG400COD,AUD_new_SNG400COD FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400CTLE',AUD_old_SNG400CTLE,AUD_new_SNG400CTLE FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400CTLE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400DIN',AUD_old_SNG400DIN,AUD_new_SNG400DIN FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400DIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400DSC',AUD_old_SNG400DSC,AUD_new_SNG400DSC FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400DVT',AUD_old_SNG400DVT,AUD_new_SNG400DVT FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400DVT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400EVTO',AUD_old_SNG400EVTO,AUD_new_SNG400EVTO FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400EVTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400EXP',AUD_old_SNG400EXP,AUD_new_SNG400EXP FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400EXP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400FREC',AUD_old_SNG400FREC,AUD_new_SNG400FREC FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400FREC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400GLOG',AUD_old_SNG400GLOG,AUD_new_SNG400GLOG FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400GLOG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400MDIA',AUD_old_SNG400MDIA,AUD_new_SNG400MDIA FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400MDIA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400PAE',AUD_old_SNG400PAE,AUD_new_SNG400PAE FROM
 BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400PAE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400SCP',AUD_old_SNG400SCP,AUD_new_SNG400SCP FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400SCP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400TV',AUD_old_SNG400TV,AUD_new_SNG400TV FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400TV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400VIG',AUD_old_SNG400VIG,AUD_new_SNG400VIG FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400VIG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG400_UOn,AUD_SNG400_GuidKey,'SNG400VTO',AUD_old_SNG400VTO,AUD_new_SNG400VTO FROM BANTPROD.AUD_SNG400_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey AND AUDMstFld = 'SNG400VTO'); DELETE FROM AUD_SNG400_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG400_UOn AND AUDMstId = AUD_SNG400_GuidKey);  COMMIT ;END IF;END;
/

