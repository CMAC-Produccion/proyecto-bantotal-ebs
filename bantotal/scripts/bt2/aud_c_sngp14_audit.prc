CREATE OR REPLACE PROCEDURE AUD_C_SNGP14_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNGP14_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNGP14_UOn,AUD_SNGP14_GuidKey,'SNGP14',CONCAT( CONCAT( '|SNGP14COD=', RTRIM(COALESCE(AUD_old_SNGP14COD,AUD_new_SNGP14COD)) ),'|' ),AUD_SNGP14_UBT,AUD_SNGP14_UBU,AUD_SNGP14_UBM,AUD_SNGP14_UBP,AUD_SNGP14_UBR,AUD_SNGP14_UAs,AUD_SNGP14_UBC,AUD_SNGP14_UBA,AUD_SNGP14_UBS, '', 'BANTOTAL', '', '', '',AUD_SNGP14_UT FROM BANTPROD.AUD_SNGP14_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGP14_UOn AND AUDMstId = AUD_SNGP14_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP14_UOn,AUD_SNGP14_GuidKey,'SNGP14COD',AUD_old_SNGP14COD,AUD_new_SNGP14COD FROM BANTPROD.AUD_SNGP14_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP14_UOn AND AUDMstId = AUD_SNGP14_GuidKey AND AUDMstFld = 'SNGP14COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP14_UOn,AUD_SNGP14_GuidKey,'SNGP14MOD',AUD_old_SNGP14MOD,AUD_new_SNGP14MOD FROM BANTPROD.AUD_SNGP14_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP14_UOn AND AUDMstId = AUD_SNGP14_GuidKey AND AUDMstFld = 'SNGP14MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP14_UOn,AUD_SNGP14_GuidKey,'SNGP14ORD',AUD_old_SNGP14ORD,AUD_new_SNGP14ORD FROM BANTPROD.AUD_SNGP14_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP14_UOn AND AUDMstId = AUD_SNGP14_GuidKey AND AUDMstFld = 'SNGP14ORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP14_UOn,AUD_SNGP14_GuidKey,'SNGP14REL',AUD_old_SNGP14REL,AUD_new_SNGP14REL FROM BANTPROD.AUD_SNGP14_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP14_UOn AND AUDMstId = AUD_SNGP14_GuidKey AND AUDMstFld = 'SNGP14REL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP14_UOn,AUD_SNGP14_GuidKey,'SNGP14SBO',AUD_old_SNGP14SBO,AUD_new_SNGP14SBO FROM BANTPROD.AUD_SNGP14_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP14_UOn AND AUDMstId = AUD_SNGP14_GuidKey AND AUDMstFld = 'SNGP14SBO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP14_UOn,AUD_SNGP14_GuidKey,'SNGP14TOP',AUD_old_SNGP14TOP,AUD_new_SNGP14TOP FROM BANTPROD.AUD_SNGP14_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP14_UOn AND AUDMstId = AUD_SNGP14_GuidKey AND AUDMstFld = 'SNGP14TOP'); DELETE FROM AUD_SNGP14_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGP14_UOn AND AUDMstId = AUD_SNGP14_GuidKey);  COMMIT ;END IF;END;
/

