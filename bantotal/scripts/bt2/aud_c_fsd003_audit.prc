CREATE OR REPLACE PROCEDURE AUD_C_FSD003_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD003_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'FSD003',CONCAT( CONCAT( CONCAT( CONCAT( '|PJNDOC=', RTRIM(COALESCE(AUD_old_PJNDOC,AUD_new_PJNDOC)) ),CONCAT( '|PJPAIS=', RTRIM(COALESCE(AUD_old_PJPAIS,AUD_new_PJPAIS)) ) ),CONCAT( '|PJTDOC=', RTRIM(COALESCE(AUD_old_PJTDOC,AUD_new_PJTDOC)) ) ),'|' ),AUD_FSD003_UBT,AUD_FSD003_UBU,AUD_FSD003_UBM,AUD_FSD003_UBP,AUD_FSD003_UBR,AUD_FSD003_UAs,AUD_FSD003_UBC,AUD_FSD003_UBA,AUD_FSD003_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD003_UT FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'ENTECOD',AUD_old_ENTECOD,AUD_new_ENTECOD FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'ENTECOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'NJCOD',AUD_old_NJCOD,AUD_new_NJCOD FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'NJCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJCANT',AUD_old_PJCANT,AUD_new_PJCANT FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJCANT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJCD01',AUD_old_PJCD01,AUD_new_PJCD01 FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJCD01'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJCD02',AUD_old_PJCD02,AUD_new_PJCD02 FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJCD02'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJCD03',AUD_old_PJCD03,AUD_new_PJCD03 FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJCD03'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJCD04',AUD_old_PJCD04,AUD_new_PJCD04 FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJCD04'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJCD05',AUD_old_PJCD05,AUD_new_PJCD05 FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJCD05'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJCD06',AUD_old_PJCD06,AUD_new_PJCD06 FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJCD06'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJFBAL',TO_CHAR(AUD_old_PJFBAL,'YYYY-MM-DD'),TO_CHAR(AUD_new_PJFBAL,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJFBAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJFCAN',TO_CHAR(AUD_old_PJFCAN,'YYYY-MM-DD'),TO_CHAR(AUD_new_PJFCAN,'YYYY-MM-DD') FROM BA
NTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJFCAN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJFCON',TO_CHAR(AUD_old_PJFCON,'YYYY-MM-DD'),TO_CHAR(AUD_new_PJFCON,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJFCON'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJFEXP',TO_CHAR(AUD_old_PJFEXP,'YYYY-MM-DD'),TO_CHAR(AUD_new_PJFEXP,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJFEXP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJFINA',TO_CHAR(AUD_old_PJFINA,'YYYY-MM-DD'),TO_CHAR(AUD_new_PJFINA,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJFINA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJFLUC',AUD_old_PJFLUC,AUD_new_PJFLUC FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJFLUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJFPBA',TO_CHAR(AUD_old_PJFPBA,'YYYY-MM-DD'),TO_CHAR(AUD_new_PJFPBA,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJFPBA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJFREG',TO_CHAR(AUD_old_PJFREG,'YYYY-MM-DD'),TO_CHAR(AUD_new_PJFREG,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJFREG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJNDOC',AUD_old_PJNDOC,AUD_new_PJNDOC FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJNDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJNROR',AUD_old_PJNROR,AUD_new_PJNROR FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJNROR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJPAIS',AUD_old_PJPAIS,AUD_new_PJPAIS FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJPAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJPBAL',AUD_old_PJPBAL,AUD_new_PJPBAL FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJPBAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJRAZS',AUD_old_PJRAZS,AUD_new_PJRAZS FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJRAZS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJSEGMENTO',AUD_old_PJSEGMENTO,AUD_new_PJSEGMENTO FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJSEGMENTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'PJTDOC',AUD_old_PJTDOC,AUD_new_PJTDOC FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AU
DMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'PJTDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'SECECOCOD',AUD_old_SECECOCOD,AUD_new_SECECOCOD FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'SECECOCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD003_UOn,AUD_FSD003_GuidKey,'SOCCONCOD',AUD_old_SOCCONCOD,AUD_new_SOCCONCOD FROM BANTPROD.AUD_FSD003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey AND AUDMstFld = 'SOCCONCOD'); DELETE FROM AUD_FSD003_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD003_UOn AND AUDMstId = AUD_FSD003_GuidKey);  COMMIT ;END IF;END;
/

