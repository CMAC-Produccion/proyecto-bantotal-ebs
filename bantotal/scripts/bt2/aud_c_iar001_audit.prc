CREATE OR REPLACE PROCEDURE AUD_C_IAR001_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_IAR001_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IAR001',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|IARSCTA=', RTRIM(COALESCE(AUD_old_IARSCTA,AUD_new_IARSCTA)) ),CONCAT( '|IARSMDA=', RTRIM(COALESCE(AUD_old_IARSMDA,AUD_new_IARSMDA)) ) ),CONCAT( '|IARSMOD=', RTRIM(COALESCE(AUD_old_IARSMOD,AUD_new_IARSMOD)) ) ),CONCAT( '|IARSPAP=', RTRIM(COALESCE(AUD_old_IARSPAP,AUD_new_IARSPAP)) ) ),CONCAT( '|IARSPGCOD=', RTRIM(COALESCE(AUD_old_IARSPGCOD,AUD_new_IARSPGCOD)) ) ),CONCAT( '|IARSSCTA=', RTRIM(COALESCE(AUD_old_IARSSCTA,AUD_new_IARSSCTA)) ) ),CONCAT( '|IARSSOPE=', RTRIM(COALESCE(AUD_old_IARSSOPE,AUD_new_IARSSOPE)) ) ),CONCAT( '|IARSSUC=', RTRIM(COALESCE(AUD_old_IARSSUC,AUD_new_IARSSUC)) ) ),CONCAT( '|IARSTOPE=', RTRIM(COALESCE(AUD_old_IARSTOPE,AUD_new_IARSTOPE)) ) ),'|' ),AUD_IAR001_UBT,AUD_IAR001_UBU,AUD_IAR001_UBM,AUD_IAR001_UBP,AUD_IAR001_UBR,AUD_IAR001_UAs,AUD_IAR001_UBC,AUD_IAR001_UBA,AUD_IAR001_UBS, '', 'BANTOTAL', '', '', '',AUD_IAR001_UT FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSCTA',AUD_old_IARSCTA,AUD_new_IARSCTA FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSMDA',AUD_old_IARSMDA,AUD_new_IARSMDA FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSMOD',AUD_old_IARSMOD,AUD_new_IARSMOD FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSPAP',AUD_old_IARSPAP,AUD_new_IARSPAP FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSPGCOD',AUD_old_IARSPGCOD,AUD_new_IARSPGCOD FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSPGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSSALDO',AUD_old_IARSSALDO,AUD_new_IARSSALDO FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSSALDO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSSCTA',AUD_old_IARSSCTA,AUD_new_IARSSCTA FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSSCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSSDO1',AUD_old_IARSSDO1,AUD_new_IARSSDO1 FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSSDO1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSSDO2',AUD_old_IARSSDO2,AUD_new_IARSSDO2 FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005
WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSSDO2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSSDO3',AUD_old_IARSSDO3,AUD_new_IARSSDO3 FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSSDO3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSSOPE',AUD_old_IARSSOPE,AUD_new_IARSSOPE FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSSOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSSUC',AUD_old_IARSSUC,AUD_new_IARSSUC FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSSUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSTIPO',AUD_old_IARSTIPO,AUD_new_IARSTIPO FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSTIPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_IAR001_UOn,AUD_IAR001_GuidKey,'IARSTOPE',AUD_old_IARSTOPE,AUD_new_IARSTOPE FROM BANTPROD.AUD_IAR001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey AND AUDMstFld = 'IARSTOPE'); DELETE FROM AUD_IAR001_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_IAR001_UOn AND AUDMstId = AUD_IAR001_GuidKey);  COMMIT ;END IF;END;
/

