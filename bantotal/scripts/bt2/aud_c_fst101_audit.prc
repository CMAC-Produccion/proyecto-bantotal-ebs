CREATE OR REPLACE PROCEDURE AUD_C_FST101_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST101_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'FST101',CONCAT( CONCAT( CONCAT( '|PBCOD=', RTRIM(COALESCE(AUD_old_PBCOD,AUD_new_PBCOD)) ),CONCAT( '|PBNSEC=', RTRIM(COALESCE(AUD_old_PBNSEC,AUD_new_PBNSEC)) ) ),'|' ),AUD_FST101_UBT,AUD_FST101_UBU,AUD_FST101_UBM,AUD_FST101_UBP,AUD_FST101_UBR,AUD_FST101_UAs,AUD_FST101_UBC,AUD_FST101_UBA,AUD_FST101_UBS, '', 'BANTOTAL', '', '', '',AUD_FST101_UT FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBCOD',AUD_old_PBCOD,AUD_new_PBCOD FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBCPAR',AUD_old_PBCPAR,AUD_new_PBCPAR FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBCPAR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBDESC',AUD_old_PBDESC,AUD_new_PBDESC FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBDESC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBEJEC',AUD_old_PBEJEC,AUD_new_PBEJEC FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBEJEC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBEST',AUD_old_PBEST,AUD_new_PBEST FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBEST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBEXCP',AUD_old_PBEXCP,AUD_new_PBEXCP FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBEXCP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBFFIN',TO_CHAR(AUD_old_PBFFIN,'YYYY-MM-DD'),TO_CHAR(AUD_new_PBFFIN,'YYYY-MM-DD') FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBFFIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBFINI',TO_CHAR(AUD_old_PBFINI,'YYYY-MM-DD'),TO_CHAR(AUD_new_PBFINI,'YYYY-MM-DD') FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBFINI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBHFIN',AUD_old_PBHFIN,AUD_new_PBHFIN FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBHFIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBHINI',AUD_old_PBHINI,AUD_new_PBHINI FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBHINI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBNSEC',AUD_old_PBNSEC,AUD_new_PBNSEC FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim =
AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBNSEC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBPARM',AUD_old_PBPARM,AUD_new_PBPARM FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBPARM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBPER',AUD_old_PBPER,AUD_new_PBPER FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBPROC',AUD_old_PBPROC,AUD_new_PBPROC FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBPROC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST101_UOn,AUD_FST101_GuidKey,'PBRET',AUD_old_PBRET,AUD_new_PBRET FROM BANTPROD.AUD_FST101_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey AND AUDMstFld = 'PBRET'); DELETE FROM AUD_FST101_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST101_UOn AND AUDMstId = AUD_FST101_GuidKey);  COMMIT ;END IF;END;
/

