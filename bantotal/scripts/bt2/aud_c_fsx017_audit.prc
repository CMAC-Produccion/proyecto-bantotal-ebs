CREATE OR REPLACE PROCEDURE AUD_C_FSX017_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSX017_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'FSX017',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|SICOD=', RTRIM(COALESCE(AUD_old_SICOD,AUD_new_SICOD)) ),CONCAT( '|SIMOD=', RTRIM(COALESCE(AUD_old_SIMOD,AUD_new_SIMOD)) ) ),CONCAT( '|SINIMP=', RTRIM(COALESCE(AUD_old_SINIMP,AUD_new_SINIMP)) ) ),CONCAT( '|SITRAN=', RTRIM(COALESCE(AUD_old_SITRAN,AUD_new_SITRAN)) ) ),'|' ),AUD_FSX017_UBT,AUD_FSX017_UBU,AUD_FSX017_UBM,AUD_FSX017_UBP,AUD_FSX017_UBR,AUD_FSX017_UAs,AUD_FSX017_UBC,AUD_FSX017_UBA,AUD_FSX017_UBS, '', 'BANTOTAL', '', '', '',AUD_FSX017_UT FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SICD01',AUD_old_SICD01,AUD_new_SICD01 FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SICD01'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SICD02',AUD_old_SICD02,AUD_new_SICD02 FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SICD02'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SICD03',AUD_old_SICD03,AUD_new_SICD03 FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SICD03'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SICOD',AUD_old_SICOD,AUD_new_SICOD FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SICOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SIFORM',AUD_old_SIFORM,AUD_new_SIFORM FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SIFORM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SIIMPR',AUD_old_SIIMPR,AUD_new_SIIMPR FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SIIMPR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SIMOD',AUD_old_SIMOD,AUD_new_SIMOD FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SIMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SINIMP',AUD_old_SINIMP,AUD_new_SINIMP FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SINIMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SINOM',AUD_old_SINOM,AUD_new_SINOM FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SINOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SISN01',AUD_old_SISN01,AUD_new_SISN01 FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SISN01'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SISN02',AUD_old_SISN02,AUD_new_SISN02 FROM BANTPROD.AUD_FSX017_AUDIT WHE
RE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SISN02'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SISN03',AUD_old_SISN03,AUD_new_SISN03 FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SISN03'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SISUBCONT',AUD_old_SISUBCONT,AUD_new_SISUBCONT FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SISUBCONT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SISUBORD',AUD_old_SISUBORD,AUD_new_SISUBORD FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SISUBORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SISUBSBOR',AUD_old_SISUBSBOR,AUD_new_SISUBSBOR FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SISUBSBOR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX017_UOn,AUD_FSX017_GuidKey,'SITRAN',AUD_old_SITRAN,AUD_new_SITRAN FROM BANTPROD.AUD_FSX017_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey AND AUDMstFld = 'SITRAN'); DELETE FROM AUD_FSX017_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSX017_UOn AND AUDMstId = AUD_FSX017_GuidKey);  COMMIT ;END IF;END;
/

