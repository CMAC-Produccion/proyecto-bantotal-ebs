CREATE OR REPLACE PROCEDURE AUD_C_SNG090_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG090_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG090_UOn,AUD_SNG090_GuidKey,'SNG090',CONCAT( CONCAT( CONCAT( '|SNG001INST=', RTRIM(COALESCE(AUD_old_SNG001INST,AUD_new_SNG001INST)) ),CONCAT( '|SNG090PQT=', RTRIM(COALESCE(AUD_old_SNG090PQT,AUD_new_SNG090PQT)) ) ),'|' ),AUD_SNG090_UBT,AUD_SNG090_UBU,AUD_SNG090_UBM,AUD_SNG090_UBP,AUD_SNG090_UBR,AUD_SNG090_UAs,AUD_SNG090_UBC,AUD_SNG090_UBA,AUD_SNG090_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG090_UT FROM BANTPROD.AUD_SNG090_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG090_UOn AND AUDMstId = AUD_SNG090_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG090_UOn,AUD_SNG090_GuidKey,'SNG001INST',AUD_old_SNG001INST,AUD_new_SNG001INST FROM BANTPROD.AUD_SNG090_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG090_UOn AND AUDMstId = AUD_SNG090_GuidKey AND AUDMstFld = 'SNG001INST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG090_UOn,AUD_SNG090_GuidKey,'SNG090EVA',AUD_old_SNG090EVA,AUD_new_SNG090EVA FROM BANTPROD.AUD_SNG090_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG090_UOn AND AUDMstId = AUD_SNG090_GuidKey AND AUDMstFld = 'SNG090EVA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG090_UOn,AUD_SNG090_GuidKey,'SNG090HST',AUD_old_SNG090HST,AUD_new_SNG090HST FROM BANTPROD.AUD_SNG090_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG090_UOn AND AUDMstId = AUD_SNG090_GuidKey AND AUDMstFld = 'SNG090HST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG090_UOn,AUD_SNG090_GuidKey,'SNG090ITE',AUD_old_SNG090ITE,AUD_new_SNG090ITE FROM BANTPROD.AUD_SNG090_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG090_UOn AND AUDMstId = AUD_SNG090_GuidKey AND AUDMstFld = 'SNG090ITE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG090_UOn,AUD_SNG090_GuidKey,'SNG090PQT',AUD_old_SNG090PQT,AUD_new_SNG090PQT FROM BANTPROD.AUD_SNG090_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG090_UOn AND AUDMstId = AUD_SNG090_GuidKey AND AUDMstFld = 'SNG090PQT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG090_UOn,AUD_SNG090_GuidKey,'SNG090RES',AUD_old_SNG090RES,AUD_new_SNG090RES FROM BANTPROD.AUD_SNG090_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG090_UOn AND AUDMstId = AUD_SNG090_GuidKey AND AUDMstFld = 'SNG090RES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG090_UOn,AUD_SNG090_GuidKey,'SNG090TPO',AUD_old_SNG090TPO,AUD_new_SNG090TPO FROM BANTPROD.AUD_SNG090_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG090_UOn AND AUDMstId = AUD_SNG090_GuidKey AND AUDMstFld = 'SNG090TPO'); DELETE FROM AUD_SNG090_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG090_UOn AND AUDMstId = AUD_SNG090_GuidKey);  COMMIT ;END IF;END;
/

