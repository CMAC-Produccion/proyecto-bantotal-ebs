CREATE OR REPLACE PROCEDURE AUD_C_SNG064_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG064_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG064_UOn,AUD_SNG064_GuidKey,'SNG064',CONCAT( CONCAT( '|SNG064COD=', RTRIM(COALESCE(AUD_old_SNG064COD,AUD_new_SNG064COD)) ),'|' ),AUD_SNG064_UBT,AUD_SNG064_UBU,AUD_SNG064_UBM,AUD_SNG064_UBP,AUD_SNG064_UBR,AUD_SNG064_UAs,AUD_SNG064_UBC,AUD_SNG064_UBA,AUD_SNG064_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG064_UT FROM BANTPROD.AUD_SNG064_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG064_UOn AND AUDMstId = AUD_SNG064_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG064_UOn,AUD_SNG064_GuidKey,'SNG064COD',AUD_old_SNG064COD,AUD_new_SNG064COD FROM BANTPROD.AUD_SNG064_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG064_UOn AND AUDMstId = AUD_SNG064_GuidKey AND AUDMstFld = 'SNG064COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG064_UOn,AUD_SNG064_GuidKey,'SNG064DSC',AUD_old_SNG064DSC,AUD_new_SNG064DSC FROM BANTPROD.AUD_SNG064_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG064_UOn AND AUDMstId = AUD_SNG064_GuidKey AND AUDMstFld = 'SNG064DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG064_UOn,AUD_SNG064_GuidKey,'SNG064NOM',AUD_old_SNG064NOM,AUD_new_SNG064NOM FROM BANTPROD.AUD_SNG064_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG064_UOn AND AUDMstId = AUD_SNG064_GuidKey AND AUDMstFld = 'SNG064NOM'); DELETE FROM AUD_SNG064_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG064_UOn AND AUDMstId = AUD_SNG064_GuidKey);  COMMIT ;END IF;END;
/

