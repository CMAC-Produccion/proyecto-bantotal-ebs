CREATE OR REPLACE PROCEDURE AUD_C_REP001_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_REP001_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_REP001_UOn,AUD_REP001_GuidKey,'REP001',CONCAT( CONCAT( '|REP001COD=', RTRIM(COALESCE(AUD_old_REP001COD,AUD_new_REP001COD)) ),'|' ),AUD_REP001_UBT,AUD_REP001_UBU,AUD_REP001_UBM,AUD_REP001_UBP,AUD_REP001_UBR,AUD_REP001_UAs,AUD_REP001_UBC,AUD_REP001_UBA,AUD_REP001_UBS, '', 'BANTOTAL', '', '', '',AUD_REP001_UT FROM BANTPROD.AUD_REP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_REP001_UOn AND AUDMstId = AUD_REP001_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP001_UOn,AUD_REP001_GuidKey,'REP001COD',AUD_old_REP001COD,AUD_new_REP001COD FROM BANTPROD.AUD_REP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP001_UOn AND AUDMstId = AUD_REP001_GuidKey AND AUDMstFld = 'REP001COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP001_UOn,AUD_REP001_GuidKey,'REP001CONE',AUD_old_REP001CONE,AUD_new_REP001CONE FROM BANTPROD.AUD_REP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP001_UOn AND AUDMstId = AUD_REP001_GuidKey AND AUDMstFld = 'REP001CONE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP001_UOn,AUD_REP001_GuidKey,'REP001DSC',AUD_old_REP001DSC,AUD_new_REP001DSC FROM BANTPROD.AUD_REP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP001_UOn AND AUDMstId = AUD_REP001_GuidKey AND AUDMstFld = 'REP001DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP001_UOn,AUD_REP001_GuidKey,'REP001EXP',AUD_old_REP001EXP,AUD_new_REP001EXP FROM BANTPROD.AUD_REP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP001_UOn AND AUDMstId = AUD_REP001_GuidKey AND AUDMstFld = 'REP001EXP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP001_UOn,AUD_REP001_GuidKey,'REP001IMP',AUD_old_REP001IMP,AUD_new_REP001IMP FROM BANTPROD.AUD_REP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP001_UOn AND AUDMstId = AUD_REP001_GuidKey AND AUDMstFld = 'REP001IMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP001_UOn,AUD_REP001_GuidKey,'REP001PHTML',AUD_old_REP001PHTML,AUD_new_REP001PHTML FROM BANTPROD.AUD_REP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP001_UOn AND AUDMstId = AUD_REP001_GuidKey AND AUDMstFld = 'REP001PHTML'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP001_UOn,AUD_REP001_GuidKey,'REP001VIS',AUD_old_REP001VIS,AUD_new_REP001VIS FROM BANTPROD.AUD_REP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP001_UOn AND AUDMstId = AUD_REP001_GuidKey AND AUDMstFld = 'REP001VIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP001_UOn,AUD_REP001_GuidKey,'REP001WS',AUD_old_REP001WS,AUD_new_REP001WS FROM BANTPROD.AUD_REP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP001_UOn AND AUDMstId = AUD_REP001_GuidKey AND AUDMstFld = 'REP001WS'); DELETE FROM AUD_REP001_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_REP001_UOn AND AUDMstId = AUD_REP001_GuidKey);  COMMIT ;END IF;END;
/

