CREATE OR REPLACE PROCEDURE AUD_C_FPP060_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FPP060_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'FPP060',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|COCOD=', RTRIM(COALESCE(AUD_old_COCOD,AUD_new_COCOD)) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|XPREMOD=', RTRIM(COALESCE(AUD_old_XPREMOD,AUD_new_XPREMOD)) ) ),CONCAT( '|XPREMONEDA=', RTRIM(COALESCE(AUD_old_XPREMONEDA,AUD_new_XPREMONEDA)) ) ),CONCAT( '|XPREPAPEL=', RTRIM(COALESCE(AUD_old_XPREPAPEL,AUD_new_XPREPAPEL)) ) ),CONCAT( '|XPRETOPE=', RTRIM(COALESCE(AUD_old_XPRETOPE,AUD_new_XPRETOPE)) ) ),'|' ),AUD_FPP060_UBT,AUD_FPP060_UBU,AUD_FPP060_UBM,AUD_FPP060_UBP,AUD_FPP060_UBR,AUD_FPP060_UAs,AUD_FPP060_UBC,AUD_FPP060_UBA,AUD_FPP060_UBS, '', 'BANTOTAL', '', '', '',AUD_FPP060_UT FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'COCOD',AUD_old_COCOD,AUD_new_COCOD FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'COCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060AUX1',AUD_old_PP060AUX1,AUD_new_PP060AUX1 FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060AUX1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060AUX2',AUD_old_PP060AUX2,AUD_new_PP060AUX2 FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060AUX2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060AUX3',AUD_old_PP060AUX3,AUD_new_PP060AUX3 FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060AUX3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060AUX4',AUD_old_PP060AUX4,AUD_new_PP060AUX4 FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060AUX4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060AUX5',AUD_old_PP060AUX5,AUD_new_PP060AUX5 FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060AUX5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060AUX6',TO_CHAR(AUD_old_PP060AUX6,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP060AUX6,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060AUX6'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060AUX7',AUD_old_PP060AUX7,AUD_new_PP060AUX7 FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060AUX7'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060AUX8',AUD_old_PP060AUX8,AUD_
new_PP060AUX8 FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060AUX8'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060IMP',AUD_old_PP060IMP,AUD_new_PP060IMP FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060IMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060IMPU',AUD_old_PP060IMPU,AUD_new_PP060IMPU FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060IMPU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060MODIF',AUD_old_PP060MODIF,AUD_new_PP060MODIF FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060MODIF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060MOM',AUD_old_PP060MOM,AUD_new_PP060MOM FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060MOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060OBLIG',AUD_old_PP060OBLIG,AUD_new_PP060OBLIG FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060OBLIG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060PERS',AUD_old_PP060PERS,AUD_new_PP060PERS FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060PERS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060PORC1',AUD_old_PP060PORC1,AUD_new_PP060PORC1 FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060PORC1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060PORC2',AUD_old_PP060PORC2,AUD_new_PP060PORC2 FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060PORC2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060PRG1',AUD_old_PP060PRG1,AUD_new_PP060PRG1 FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060PRG1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060PRG2',AUD_old_PP060PRG2,AUD_new_PP060PRG2 FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060PRG2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060SOBRE',AUD_old_PP060SOBRE,AUD_new_PP060SOBRE FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060SOBRE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'PP060TIPO',AUD_old_PP060TIPO,AUD_new_PP060TIPO FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'PP060TIPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'XPREMOD',AUD_old_XPREMOD,AUD_new_XPREMOD FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'XPREMOD'
); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'XPREMONEDA',AUD_old_XPREMONEDA,AUD_new_XPREMONEDA FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'XPREMONEDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'XPREPAPEL',AUD_old_XPREPAPEL,AUD_new_XPREPAPEL FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'XPREPAPEL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP060_UOn,AUD_FPP060_GuidKey,'XPRETOPE',AUD_old_XPRETOPE,AUD_new_XPRETOPE FROM BANTPROD.AUD_FPP060_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey AND AUDMstFld = 'XPRETOPE'); DELETE FROM AUD_FPP060_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP060_UOn AND AUDMstId = AUD_FPP060_GuidKey);  COMMIT ;END IF;END;
/

