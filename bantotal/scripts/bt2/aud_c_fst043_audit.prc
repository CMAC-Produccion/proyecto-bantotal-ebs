CREATE OR REPLACE PROCEDURE AUD_C_FST043_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST043_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST043_UOn,AUD_FST043_GuidKey,'FST043',CONCAT( CONCAT( '|EXTCOD=', RTRIM(COALESCE(AUD_old_EXTCOD,AUD_new_EXTCOD)) ),'|' ),AUD_FST043_UBT,AUD_FST043_UBU,AUD_FST043_UBM,AUD_FST043_UBP,AUD_FST043_UBR,AUD_FST043_UAs,AUD_FST043_UBC,AUD_FST043_UBA,AUD_FST043_UBS, '', 'BANTOTAL', '', '', '',AUD_FST043_UT FROM BANTPROD.AUD_FST043_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST043_UOn AND AUDMstId = AUD_FST043_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST043_UOn,AUD_FST043_GuidKey,'EXTCOD',AUD_old_EXTCOD,AUD_new_EXTCOD FROM BANTPROD.AUD_FST043_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST043_UOn AND AUDMstId = AUD_FST043_GuidKey AND AUDMstFld = 'EXTCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST043_UOn,AUD_FST043_GuidKey,'EXTEJE',AUD_old_EXTEJE,AUD_new_EXTEJE FROM BANTPROD.AUD_FST043_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST043_UOn AND AUDMstId = AUD_FST043_GuidKey AND AUDMstFld = 'EXTEJE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST043_UOn,AUD_FST043_GuidKey,'EXTMOM',AUD_old_EXTMOM,AUD_new_EXTMOM FROM BANTPROD.AUD_FST043_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST043_UOn AND AUDMstId = AUD_FST043_GuidKey AND AUDMstFld = 'EXTMOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST043_UOn,AUD_FST043_GuidKey,'EXTNOM',AUD_old_EXTNOM,AUD_new_EXTNOM FROM BANTPROD.AUD_FST043_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST043_UOn AND AUDMstId = AUD_FST043_GuidKey AND AUDMstFld = 'EXTNOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST043_UOn,AUD_FST043_GuidKey,'EXTPRG',AUD_old_EXTPRG,AUD_new_EXTPRG FROM BANTPROD.AUD_FST043_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST043_UOn AND AUDMstId = AUD_FST043_GuidKey AND AUDMstFld = 'EXTPRG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST043_UOn,AUD_FST043_GuidKey,'EXTPRL',AUD_old_EXTPRL,AUD_new_EXTPRL FROM BANTPROD.AUD_FST043_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST043_UOn AND AUDMstId = AUD_FST043_GuidKey AND AUDMstFld = 'EXTPRL'); DELETE FROM AUD_FST043_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST043_UOn AND AUDMstId = AUD_FST043_GuidKey);  COMMIT ;END IF;END;
/

