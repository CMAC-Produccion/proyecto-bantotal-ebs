CREATE OR REPLACE PROCEDURE AUD_C_SNG052_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG052_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG052_UOn,AUD_SNG052_GuidKey,'SNG052',CONCAT( CONCAT( '|SNG052TEM=', RTRIM(COALESCE(AUD_old_SNG052TEM,AUD_new_SNG052TEM)) ),'|' ),AUD_SNG052_UBT,AUD_SNG052_UBU,AUD_SNG052_UBM,AUD_SNG052_UBP,AUD_SNG052_UBR,AUD_SNG052_UAs,AUD_SNG052_UBC,AUD_SNG052_UBA,AUD_SNG052_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG052_UT FROM BANTPROD.AUD_SNG052_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG052_UOn AND AUDMstId = AUD_SNG052_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG052_UOn,AUD_SNG052_GuidKey,'SNG052DIS',AUD_old_SNG052DIS,AUD_new_SNG052DIS FROM BANTPROD.AUD_SNG052_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG052_UOn AND AUDMstId = AUD_SNG052_GuidKey AND AUDMstFld = 'SNG052DIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG052_UOn,AUD_SNG052_GuidKey,'SNG052DSC',AUD_old_SNG052DSC,AUD_new_SNG052DSC FROM BANTPROD.AUD_SNG052_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG052_UOn AND AUDMstId = AUD_SNG052_GuidKey AND AUDMstFld = 'SNG052DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG052_UOn,AUD_SNG052_GuidKey,'SNG052EXP',AUD_old_SNG052EXP,AUD_new_SNG052EXP FROM BANTPROD.AUD_SNG052_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG052_UOn AND AUDMstId = AUD_SNG052_GuidKey AND AUDMstFld = 'SNG052EXP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG052_UOn,AUD_SNG052_GuidKey,'SNG052MOD',AUD_old_SNG052MOD,AUD_new_SNG052MOD FROM BANTPROD.AUD_SNG052_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG052_UOn AND AUDMstId = AUD_SNG052_GuidKey AND AUDMstFld = 'SNG052MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG052_UOn,AUD_SNG052_GuidKey,'SNG052PRG',AUD_old_SNG052PRG,AUD_new_SNG052PRG FROM BANTPROD.AUD_SNG052_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG052_UOn AND AUDMstId = AUD_SNG052_GuidKey AND AUDMstFld = 'SNG052PRG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG052_UOn,AUD_SNG052_GuidKey,'SNG052TEM',AUD_old_SNG052TEM,AUD_new_SNG052TEM FROM BANTPROD.AUD_SNG052_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG052_UOn AND AUDMstId = AUD_SNG052_GuidKey AND AUDMstFld = 'SNG052TEM'); DELETE FROM AUD_SNG052_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG052_UOn AND AUDMstId = AUD_SNG052_GuidKey);  COMMIT ;END IF;END;
/

