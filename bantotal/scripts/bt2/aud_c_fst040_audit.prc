CREATE OR REPLACE PROCEDURE AUD_C_FST040_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST040_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'FST040',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ),CONCAT( '|TRLINC=', RTRIM(COALESCE(AUD_old_TRLINC,AUD_new_TRLINC)) ) ),CONCAT( '|TRMOD=', RTRIM(COALESCE(AUD_old_TRMOD,AUD_new_TRMOD)) ) ),CONCAT( '|TRNRO=', RTRIM(COALESCE(AUD_old_TRNRO,AUD_new_TRNRO)) ) ),CONCAT( '|TRORD=', RTRIM(COALESCE(AUD_old_TRORD,AUD_new_TRORD)) ) ),'|' ),AUD_FST040_UBT,AUD_FST040_UBU,AUD_FST040_UBM,AUD_FST040_UBP,AUD_FST040_UBR,AUD_FST040_UAs,AUD_FST040_UBC,AUD_FST040_UBA,AUD_FST040_UBS, '', 'BANTOTAL', '', '', '',AUD_FST040_UT FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'COECOD',AUD_old_COECOD,AUD_new_COECOD FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'COECOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'TRCOEF',AUD_old_TRCOEF,AUD_new_TRCOEF FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'TRCOEF'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'TRCOMP',AUD_old_TRCOMP,AUD_new_TRCOMP FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'TRCOMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'TRCOPE',AUD_old_TRCOPE,AUD_new_TRCOPE FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'TRCOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'TRLINC',AUD_old_TRLINC,AUD_new_TRLINC FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'TRLINC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'TRMOD',AUD_old_TRMOD,AUD_new_TRMOD FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'TRMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'TRNRO',AUD_old_TRNRO,AUD_new_TRNRO FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'TRNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'TROCMP',AUD_old_TROCMP,AUD_new_TROCMP FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'TROCMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'TROOPE',AUD_old_TROOPE,AUD_new_TROOPE FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'TROOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,
'TRORD',AUD_old_TRORD,AUD_new_TRORD FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'TRORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'TRTICM',AUD_old_TRTICM,AUD_new_TRTICM FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'TRTICM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST040_UOn,AUD_FST040_GuidKey,'TRTIOP',AUD_old_TRTIOP,AUD_new_TRTIOP FROM BANTPROD.AUD_FST040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey AND AUDMstFld = 'TRTIOP'); DELETE FROM AUD_FST040_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST040_UOn AND AUDMstId = AUD_FST040_GuidKey);  COMMIT ;END IF;END;
/

