CREATE OR REPLACE PROCEDURE AUD_C_PREFCPO_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_PREFCPO_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PREFCPO',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PRFCAT=', RTRIM(COALESCE(AUD_old_PRFCAT,AUD_new_PRFCAT)) ),CONCAT( '|PRFCPO=', RTRIM(COALESCE(AUD_old_PRFCPO,AUD_new_PRFCPO)) ) ),CONCAT( '|PRFEMP=', RTRIM(COALESCE(AUD_old_PRFEMP,AUD_new_PRFEMP)) ) ),CONCAT( '|PRFMOD=', RTRIM(COALESCE(AUD_old_PRFMOD,AUD_new_PRFMOD)) ) ),CONCAT( '|PRFTRN=', RTRIM(COALESCE(AUD_old_PRFTRN,AUD_new_PRFTRN)) ) ),'|' ),AUD_PREFCPO_UBT,AUD_PREFCPO_UBU,AUD_PREFCPO_UBM,AUD_PREFCPO_UBP,AUD_PREFCPO_UBR,AUD_PREFCPO_UAs,AUD_PREFCPO_UBC,AUD_PREFCPO_UBA,AUD_PREFCPO_UBS, '', 'BANTOTAL', '', '', '',AUD_PREFCPO_UT FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCAT',AUD_old_PRFCAT,AUD_new_PRFCAT FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCAT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCPO',AUD_old_PRFCPO,AUD_new_PRFCPO FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCPOCTL',AUD_old_PRFCPOCTL,AUD_new_PRFCPOCTL FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCPOCTL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCPOEDT',AUD_old_PRFCPOEDT,AUD_new_PRFCPOEDT FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCPOEDT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCPOFRZ2',AUD_old_PRFCPOFRZ2,AUD_new_PRFCPOFRZ2 FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCPOFRZ2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCPOFRZC',AUD_old_PRFCPOFRZC,AUD_new_PRFCPOFRZC FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCPOFRZC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCPOFRZN',AUD_old_PRFCPOFRZN,AUD_new_PRFCPOFRZN FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCPOFRZN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCPOGRB',AUD_old_PRFCPOGRB,AUD_new_PRFCPOGRB FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCPOGRB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCPOHAB',AUD_old_PRFCPOHAB,AUD_new_PRFCPOHAB FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCPOHAB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCPOORD',AUD_old_PRFCPOORD,AUD_new_PRFCPOORD FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS
 (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCPOORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCPOTCOD',AUD_old_PRFCPOTCOD,AUD_new_PRFCPOTCOD FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCPOTCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFCPOTIT',AUD_old_PRFCPOTIT,AUD_new_PRFCPOTIT FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFCPOTIT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFEMP',AUD_old_PRFEMP,AUD_new_PRFEMP FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFEMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFMOD',AUD_old_PRFMOD,AUD_new_PRFMOD FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_PREFCPO_UOn,AUD_PREFCPO_GuidKey,'PRFTRN',AUD_old_PRFTRN,AUD_new_PRFTRN FROM BANTPROD.AUD_PREFCPO_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey AND AUDMstFld = 'PRFTRN'); DELETE FROM AUD_PREFCPO_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_PREFCPO_UOn AND AUDMstId = AUD_PREFCPO_GuidKey);  COMMIT ;END IF;END;
/

