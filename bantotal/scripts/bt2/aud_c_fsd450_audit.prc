CREATE OR REPLACE PROCEDURE AUD_C_FSD450_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD450_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'FSD450',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|CBIECTA=', RTRIM(COALESCE(AUD_old_CBIECTA,AUD_new_CBIECTA)) ),CONCAT( '|CBIEEMP=', RTRIM(COALESCE(AUD_old_CBIEEMP,AUD_new_CBIEEMP)) ) ),CONCAT( '|CBIEFEC=', RTRIM(COALESCE(AUD_old_CBIEFEC,AUD_new_CBIEFEC)) ) ),CONCAT( '|CBIEMDA=', RTRIM(COALESCE(AUD_old_CBIEMDA,AUD_new_CBIEMDA)) ) ),CONCAT( '|CBIEMOD=', RTRIM(COALESCE(AUD_old_CBIEMOD,AUD_new_CBIEMOD)) ) ),CONCAT( '|CBIEOPE=', RTRIM(COALESCE(AUD_old_CBIEOPE,AUD_new_CBIEOPE)) ) ),CONCAT( '|CBIEPAP=', RTRIM(COALESCE(AUD_old_CBIEPAP,AUD_new_CBIEPAP)) ) ),CONCAT( '|CBIEREL=', RTRIM(COALESCE(AUD_old_CBIEREL,AUD_new_CBIEREL)) ) ),CONCAT( '|CBIESUB=', RTRIM(COALESCE(AUD_old_CBIESUB,AUD_new_CBIESUB)) ) ),CONCAT( '|CBIESUC=', RTRIM(COALESCE(AUD_old_CBIESUC,AUD_new_CBIESUC)) ) ),CONCAT( '|CBIETOP=', RTRIM(COALESCE(AUD_old_CBIETOP,AUD_new_CBIETOP)) ) ),'|' ),AUD_FSD450_UBT,AUD_FSD450_UBU,AUD_FSD450_UBM,AUD_FSD450_UBP,AUD_FSD450_UBR,AUD_FSD450_UAs,AUD_FSD450_UBC,AUD_FSD450_UBA,AUD_FSD450_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD450_UT FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIEANT',AUD_old_CBIEANT,AUD_new_CBIEANT FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIEANT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIECTA',AUD_old_CBIECTA,AUD_new_CBIECTA FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIECTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIEEMP',AUD_old_CBIEEMP,AUD_new_CBIEEMP FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIEEMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIEFEC',TO_CHAR(AUD_old_CBIEFEC,'YYYY-MM-DD'),TO_CHAR(AUD_new_CBIEFEC,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIEFEC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIEMDA',AUD_old_CBIEMDA,AUD_new_CBIEMDA FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIEMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIEMOD',AUD_old_CBIEMOD,AUD_new_CBIEMOD FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIEMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIEOPE',AUD_old_CBIEOPE,AUD_new_CBIEOPE FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIEOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIEPAP',AUD_old_CBIEPAP,AUD_new_CBIEPAP FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIEPAP'); INSERT INTO BANTPROD.AUD
005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIEREL',AUD_old_CBIEREL,AUD_new_CBIEREL FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIEREL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIESUB',AUD_old_CBIESUB,AUD_new_CBIESUB FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIESUB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIESUC',AUD_old_CBIESUC,AUD_new_CBIESUC FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIESUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIETOP',AUD_old_CBIETOP,AUD_new_CBIETOP FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIETOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIETXT1',AUD_old_CBIETXT1,AUD_new_CBIETXT1 FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIETXT1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIETXT2',AUD_old_CBIETXT2,AUD_new_CBIETXT2 FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIETXT2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'CBIETXT3',AUD_old_CBIETXT3,AUD_new_CBIETXT3 FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'CBIETXT3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'EXCOD',AUD_old_EXCOD,AUD_new_EXCOD FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'EXCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'HCMOD',AUD_old_HCMOD,AUD_new_HCMOD FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'HCMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'HCORD',AUD_old_HCORD,AUD_new_HCORD FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'HCORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'HCSUBO',AUD_old_HCSUBO,AUD_new_HCSUBO FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'HCSUBO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'HFCONT',TO_CHAR(AUD_old_HFCONT,'YYYY-MM-DD'),TO_CHAR(AUD_new_HFCONT,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'HFCONT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'HNREL',AUD_old_HNREL,AUD_new_HNREL FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'HNREL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'HSUCOR',AUD_old_HSUCOR,AUD_new_HSUCOR FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'HSUCOR'); INSERT INTO BANTPROD.A
UD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'HTRAN',AUD_old_HTRAN,AUD_new_HTRAN FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'HTRAN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD450_UOn,AUD_FSD450_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSD450_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey AND AUDMstFld = 'PGCOD'); DELETE FROM AUD_FSD450_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD450_UOn AND AUDMstId = AUD_FSD450_GuidKey);  COMMIT ;END IF;END;
/

