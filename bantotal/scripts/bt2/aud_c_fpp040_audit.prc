CREATE OR REPLACE PROCEDURE AUD_C_FPP040_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FPP040_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'FPP040',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PP010PRD=', RTRIM(COALESCE(AUD_old_PP010PRD,AUD_new_PP010PRD)) ),CONCAT( '|PP017PAR=', RTRIM(COALESCE(AUD_old_PP017PAR,AUD_new_PP017PAR)) ) ),CONCAT( '|PP028EMP=', RTRIM(COALESCE(AUD_old_PP028EMP,AUD_new_PP028EMP)) ) ),CONCAT( '|PP028MDA=', RTRIM(COALESCE(AUD_old_PP028MDA,AUD_new_PP028MDA)) ) ),CONCAT( '|PP028MOD=', RTRIM(COALESCE(AUD_old_PP028MOD,AUD_new_PP028MOD)) ) ),CONCAT( '|PP028PAP=', RTRIM(COALESCE(AUD_old_PP028PAP,AUD_new_PP028PAP)) ) ),CONCAT( '|PP028TOP=', RTRIM(COALESCE(AUD_old_PP028TOP,AUD_new_PP028TOP)) ) ),CONCAT( '|PP037COD=', RTRIM(COALESCE(AUD_old_PP037COD,AUD_new_PP037COD)) ) ),'|' ),AUD_FPP040_UBT,AUD_FPP040_UBU,AUD_FPP040_UBM,AUD_FPP040_UBP,AUD_FPP040_UBR,AUD_FPP040_UAs,AUD_FPP040_UBC,AUD_FPP040_UBA,AUD_FPP040_UBS, '', 'BANTOTAL', '', '', '',AUD_FPP040_UT FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP010PRD',AUD_old_PP010PRD,AUD_new_PP010PRD FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP010PRD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP017PAR',AUD_old_PP017PAR,AUD_new_PP017PAR FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP017PAR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP028EMP',AUD_old_PP028EMP,AUD_new_PP028EMP FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP028EMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP028MDA',AUD_old_PP028MDA,AUD_new_PP028MDA FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP028MDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP028MOD',AUD_old_PP028MOD,AUD_new_PP028MOD FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP028MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP028PAP',AUD_old_PP028PAP,AUD_new_PP028PAP FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP028PAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP028TOP',AUD_old_PP028TOP,AUD_new_PP028TOP FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP028TOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP037COD',AUD_old_PP037COD,AUD_new_PP037COD FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP037COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP040AUX1',AUD_old_PP040AUX1,AUD_new_PP040AUX1 FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_Gui
dKey AND AUDMstFld = 'PP040AUX1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP040AUX2',AUD_old_PP040AUX2,AUD_new_PP040AUX2 FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP040AUX2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP040AUX3',TO_CHAR(AUD_old_PP040AUX3,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP040AUX3,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP040AUX3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP040AUX4',AUD_old_PP040AUX4,AUD_new_PP040AUX4 FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP040AUX4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP040AUX5',AUD_old_PP040AUX5,AUD_new_PP040AUX5 FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP040AUX5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP040MOD',AUD_old_PP040MOD,AUD_new_PP040MOD FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP040MOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP040_UOn,AUD_FPP040_GuidKey,'PP040VIS',AUD_old_PP040VIS,AUD_new_PP040VIS FROM BANTPROD.AUD_FPP040_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey AND AUDMstFld = 'PP040VIS'); DELETE FROM AUD_FPP040_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP040_UOn AND AUDMstId = AUD_FPP040_GuidKey);  COMMIT ;END IF;END;
/

