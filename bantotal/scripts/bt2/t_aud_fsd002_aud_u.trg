CREATE OR REPLACE TRIGGER T_AUD_FSD002_AUD_U  AFTER UPDATE ON FSD002  FOR EACH ROW    DECLARE	     RequestNumber VARCHAR2(50);      UserName VARCHAR2(50); 	  WrkstName VARCHAR2(50); 	  Server VARCHAR2(50); 	  Application VARCHAR2(50); 	  ProgramName VARCHAR2(50); 	  TransactionNumber VARCHAR2(50); 	  ConnectionId VARCHAR2(50);      ExistConData NUMBER;    BEGIN      SELECT sys_context('USERENV', 'SID') INTO ConnectionId FROM dual;      SELECT COUNT(*) INTO ExistConData FROM DBA_OBJECTS WHERE OWNER=sys_context( 'userenv', 'current_schema' ) AND OBJECT_TYPE = 'TABLE' AND OBJECT_NAME = 'CONDATA';      IF ExistConData > 0 THEN 		 SELECT MAX(Value) INTO RequestNumber FROM CONDATA WHERE Data ='REQUESTID'; 		 SELECT MAX(Value) INTO UserName FROM CONDATA WHERE Data ='USERID'; 		 SELECT MAX(Value) INTO WrkstName FROM CONDATA WHERE Data ='WRKST'; 		 SELECT MAX(Value) INTO Server FROM CONDATA WHERE Data ='SERVER'; 		 SELECT MAX(Value) INTO Application FROM CONDATA WHERE Data ='APPLICATION'; 		 SELECT MAX(Value) INTO ProgramName FROM CONDATA WHERE Data ='PROGRAM';      END IF;     RequestNumber := COALESCE(RequestNumber,'-1');     TransactionNumber := COALESCE(TransactionNumber,'-1');     ConnectionId := COALESCE(ConnectionId,'-1');     SELECT COALESCE(UserName,sys_context('USERENV', 'SESSION_USER'),'NOTDEFINED') INTO UserName FROM dual;     SELECT COALESCE(WrkstName,sys_context('USERENV', 'HOST'),'NOTDEFINED') INTO WrkstName FROM dual;     SELECT COALESCE(Server,sys_context('USERENV', 'SERVER_HOST'),'NOTDEFINED') INTO Server FROM dual;     SELECT COALESCE(Application,sys_context('USERENV', 'ACTION'),'NOTDEFINED') INTO Application FROM dual;     SELECT COALESCE(ProgramName,sys_context('USERENV', 'ACTION'),'NOTDEFINED') INTO ProgramName FROM dual;     INSERT INTO BANTPROD.AUD_FSD002_AUDIT (AUD_new_PFAPE1,AUD_new_PFAPE2,AUD_new_PFCANT,AUD_new_PFCAPL,AUD_new_PFCLEG,AUD_new_PFEBCO,AUD_new_PFECIV,AUD_new_PFEPAT,AUD_new_PFFAL,AUD_new_PFFANT,AUD_new_PFFFAL,AUD_new_PFFIBC,AUD_new_PFFLEG,AUD_new_PFFNAC,AUD_new_PFFPEP,AUD_new_PFLNAC,AUD_new_PFNDOC,AUD_new_PFNOM1,AUD_new_PFNOM2,AUD_new_PFPAIS,AUD_new_PFPNAC,AUD_new_PFTDOC, AUD_old_PFAPE1,AUD_old_PFAPE2,AUD_old_PFCANT,AUD_old_PFCAPL,AUD_old_PFCLEG,AUD_old_PFEBCO,AUD_old_PFECIV,AUD_old_PFEPAT,AUD_old_PFFAL,AUD_old_PFFANT,AUD_old_PFFFAL,AUD_old_PFFIBC,AUD_old_PFFLEG,AUD_old_PFFNAC,AUD_old_PFFPEP,AUD_old_PFLNAC,AUD_old_PFNDOC,AUD_old_PFNOM1,AUD_old_PFNOM2,AUD_old_PFPAIS,AUD_old_PFPNAC,AUD_old_PFTDOC, AUD_FSD002_GuidKey ,AUD_FSD002_UOn,AUD_FSD002_UT ,AUD_FSD002_UBR ,AUD_FSD002_UBC ,AUD_FSD002_UBT ,AUD_FSD002_UBU ,AUD_FSD002_UBA ,AUD_FSD002_UBS ,AUD_FSD002_UBP ,AUD_FSD002_UBM ,AUD_FSD002_UAs )     VALUES (:new.PFAPE1,:new.PFAPE2,:new.PFCANT,:new.PFCAPL,:new.PFCLEG,:new.PFEBCO,:new.PFECIV,:new.PFEPAT,:new.PFFAL,:new.PFFANT,:new.PFFFAL,:new.PFFIBC,:new.PFFLEG,:new.PFFNAC,:new.PFFPEP,:new.PFLNAC,:new.PFNDOC,:new.PFNOM1,:new.PFNOM2,:new.PFPAIS,:new.PFPNAC,:new.PFTDOC,  :old.PFAPE1,:old.PFAPE2,:old.PFCANT,:old.PFCAPL,:old.PFCLEG,:old.PFEBCO,:old.PFECIV,:old.PFEPAT,:old.PFFAL,:old.PFFANT,:old.PFFFAL,:old.PFFIBC,:old.PFFLEG,:old.PFFNAC,:old.PFFPEP,:old.PFLNAC,:old.PFNDOC,:old.PFNOM1,:old.PFNOM2,:old.PFPAIS,:old.PFPNAC,:old.PFTDOC,  SYS_GUID(),SYSTIMESTAMP,SYSTIMESTAMP,RequestNumber,ConnectionId,TransactionNumber,UserName,Application,Server,ProgramName,WrkstName,'U' ); END T_AUD_FSD002_AUD_U;
/

