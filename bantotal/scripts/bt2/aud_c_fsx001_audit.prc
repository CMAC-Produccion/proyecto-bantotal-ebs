CREATE OR REPLACE PROCEDURE AUD_C_FSX001_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSX001_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSX001_UOn,AUD_FSX001_GuidKey,'FSX001',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PENDOC=', RTRIM(COALESCE(AUD_old_PENDOC,AUD_new_PENDOC)) ),CONCAT( '|PEPAIS=', RTRIM(COALESCE(AUD_old_PEPAIS,AUD_new_PEPAIS)) ) ),CONCAT( '|PETDOC=', RTRIM(COALESCE(AUD_old_PETDOC,AUD_new_PETDOC)) ) ),CONCAT( '|PEXREN=', RTRIM(COALESCE(AUD_old_PEXREN,AUD_new_PEXREN)) ) ),CONCAT( '|TXCOD=', RTRIM(COALESCE(AUD_old_TXCOD,AUD_new_TXCOD)) ) ),'|' ),AUD_FSX001_UBT,AUD_FSX001_UBU,AUD_FSX001_UBM,AUD_FSX001_UBP,AUD_FSX001_UBR,AUD_FSX001_UAs,AUD_FSX001_UBC,AUD_FSX001_UBA,AUD_FSX001_UBS, '', 'BANTOTAL', '', '', '',AUD_FSX001_UT FROM BANTPROD.AUD_FSX001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSX001_UOn AND AUDMstId = AUD_FSX001_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX001_UOn,AUD_FSX001_GuidKey,'PENDOC',AUD_old_PENDOC,AUD_new_PENDOC FROM BANTPROD.AUD_FSX001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX001_UOn AND AUDMstId = AUD_FSX001_GuidKey AND AUDMstFld = 'PENDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX001_UOn,AUD_FSX001_GuidKey,'PEPAIS',AUD_old_PEPAIS,AUD_new_PEPAIS FROM BANTPROD.AUD_FSX001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX001_UOn AND AUDMstId = AUD_FSX001_GuidKey AND AUDMstFld = 'PEPAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX001_UOn,AUD_FSX001_GuidKey,'PETDOC',AUD_old_PETDOC,AUD_new_PETDOC FROM BANTPROD.AUD_FSX001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX001_UOn AND AUDMstId = AUD_FSX001_GuidKey AND AUDMstFld = 'PETDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX001_UOn,AUD_FSX001_GuidKey,'PEXFCH',TO_CHAR(AUD_old_PEXFCH,'YYYY-MM-DD'),TO_CHAR(AUD_new_PEXFCH,'YYYY-MM-DD') FROM BANTPROD.AUD_FSX001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX001_UOn AND AUDMstId = AUD_FSX001_GuidKey AND AUDMstFld = 'PEXFCH'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX001_UOn,AUD_FSX001_GuidKey,'PEXREN',AUD_old_PEXREN,AUD_new_PEXREN FROM BANTPROD.AUD_FSX001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX001_UOn AND AUDMstId = AUD_FSX001_GuidKey AND AUDMstFld = 'PEXREN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX001_UOn,AUD_FSX001_GuidKey,'PEXTXT',AUD_old_PEXTXT,AUD_new_PEXTXT FROM BANTPROD.AUD_FSX001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX001_UOn AND AUDMstId = AUD_FSX001_GuidKey AND AUDMstFld = 'PEXTXT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX001_UOn,AUD_FSX001_GuidKey,'PEXUSU',AUD_old_PEXUSU,AUD_new_PEXUSU FROM BANTPROD.AUD_FSX001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX001_UOn AND AUDMstId = AUD_FSX001_GuidKey AND AUDMstFld = 'PEXUSU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSX001_UOn,AUD_FSX001_GuidKey,'TXCOD',AUD_old_TXCOD,AUD_new_TXCOD FROM BANTPROD.AUD_FSX001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSX001_UOn AND AUDMstId = AUD_FSX001_GuidKey AND AUDMstFld = 'TXCOD'); DELETE FROM AUD_FSX001_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSX001_UOn AND AUDMstId = AUD_FSX001_GuidKey);  COMMIT ;END IF;END;
/

