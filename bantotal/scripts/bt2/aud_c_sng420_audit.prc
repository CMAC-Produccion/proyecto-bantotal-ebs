CREATE OR REPLACE PROCEDURE AUD_C_SNG420_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG420_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG420_UOn,AUD_SNG420_GuidKey,'SNG420',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|SNG400COD=', RTRIM(COALESCE(AUD_old_SNG400COD,AUD_new_SNG400COD)) ),CONCAT( '|SNG400EVTO=', RTRIM(COALESCE(AUD_old_SNG400EVTO,AUD_new_SNG400EVTO)) ) ),CONCAT( '|SNG420CORR=', RTRIM(COALESCE(AUD_old_SNG420CORR,AUD_new_SNG420CORR)) ) ),CONCAT( '|SNG420FLOG=', RTRIM(COALESCE(AUD_old_SNG420FLOG,AUD_new_SNG420FLOG)) ) ),'|' ),AUD_SNG420_UBT,AUD_SNG420_UBU,AUD_SNG420_UBM,AUD_SNG420_UBP,AUD_SNG420_UBR,AUD_SNG420_UAs,AUD_SNG420_UBC,AUD_SNG420_UBA,AUD_SNG420_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG420_UT FROM BANTPROD.AUD_SNG420_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG420_UOn,AUD_SNG420_GuidKey,'SNG400COD',AUD_old_SNG400COD,AUD_new_SNG400COD FROM BANTPROD.AUD_SNG420_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey AND AUDMstFld = 'SNG400COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG420_UOn,AUD_SNG420_GuidKey,'SNG400EVTO',AUD_old_SNG400EVTO,AUD_new_SNG400EVTO FROM BANTPROD.AUD_SNG420_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey AND AUDMstFld = 'SNG400EVTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG420_UOn,AUD_SNG420_GuidKey,'SNG420CORR',AUD_old_SNG420CORR,AUD_new_SNG420CORR FROM BANTPROD.AUD_SNG420_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey AND AUDMstFld = 'SNG420CORR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG420_UOn,AUD_SNG420_GuidKey,'SNG420FEXE',TO_CHAR(AUD_old_SNG420FEXE,'YYYY-MM-DD'),TO_CHAR(AUD_new_SNG420FEXE,'YYYY-MM-DD') FROM BANTPROD.AUD_SNG420_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey AND AUDMstFld = 'SNG420FEXE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG420_UOn,AUD_SNG420_GuidKey,'SNG420FLOG',TO_CHAR(AUD_old_SNG420FLOG,'YYYY-MM-DD'),TO_CHAR(AUD_new_SNG420FLOG,'YYYY-MM-DD') FROM BANTPROD.AUD_SNG420_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey AND AUDMstFld = 'SNG420FLOG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG420_UOn,AUD_SNG420_GuidKey,'SNG420HEXE',AUD_old_SNG420HEXE,AUD_new_SNG420HEXE FROM BANTPROD.AUD_SNG420_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey AND AUDMstFld = 'SNG420HEXE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG420_UOn,AUD_SNG420_GuidKey,'SNG420LCHR',AUD_old_SNG420LCHR,AUD_new_SNG420LCHR FROM BANTPROD.AUD_SNG420_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey AND AUDMstFld = 'SNG420LCHR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG420_UOn,AUD_SNG420_GuidKey,'SNG420LNR2',AUD_old_SNG420LNR2,AUD_new_SNG420LNR2 FROM BANTPROD.AUD_SNG420_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey AND AUDMstFld = 'SNG420LNR2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG420_UOn,AUD_SNG420_GuidKey,'SNG420LNRO',AUD_old_SNG420LNRO,AUD_new_SNG420LNRO FROM BANTPROD.AUD_SNG420_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey AND AUDMstFld = 'SNG420LNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG420_UOn,AUD_SNG420_GuidKey,'SNG420STS',AUD_old_SNG420STS,AUD_new_SNG420STS FROM BANTPROD.A
UD_SNG420_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey AND AUDMstFld = 'SNG420STS'); DELETE FROM AUD_SNG420_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG420_UOn AND AUDMstId = AUD_SNG420_GuidKey);  COMMIT ;END IF;END;
/

