CREATE OR REPLACE PROCEDURE AUD_C_FSD024_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD024_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD024_UOn,AUD_FSD024_GuidKey,'FSD024',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|CLTCOD=', RTRIM(COALESCE(AUD_old_CLTCOD,AUD_new_CLTCOD)) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|TGFDES=', RTRIM(COALESCE(AUD_old_TGFDES,AUD_new_TGFDES)) ) ),CONCAT( '|TGMDA=', RTRIM(COALESCE(AUD_old_TGMDA,AUD_new_TGMDA)) ) ),CONCAT( '|TGPAP=', RTRIM(COALESCE(AUD_old_TGPAP,AUD_new_TGPAP)) ) ),CONCAT( '|TGPZO=', RTRIM(COALESCE(AUD_old_TGPZO,AUD_new_TGPZO)) ) ),'|' ),AUD_FSD024_UBT,AUD_FSD024_UBU,AUD_FSD024_UBM,AUD_FSD024_UBP,AUD_FSD024_UBR,AUD_FSD024_UAs,AUD_FSD024_UBC,AUD_FSD024_UBA,AUD_FSD024_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD024_UT FROM BANTPROD.AUD_FSD024_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD024_UOn AND AUDMstId = AUD_FSD024_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD024_UOn,AUD_FSD024_GuidKey,'CLTCOD',AUD_old_CLTCOD,AUD_new_CLTCOD FROM BANTPROD.AUD_FSD024_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD024_UOn AND AUDMstId = AUD_FSD024_GuidKey AND AUDMstFld = 'CLTCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD024_UOn,AUD_FSD024_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSD024_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD024_UOn AND AUDMstId = AUD_FSD024_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD024_UOn,AUD_FSD024_GuidKey,'TGFDES',TO_CHAR(AUD_old_TGFDES,'YYYY-MM-DD'),TO_CHAR(AUD_new_TGFDES,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD024_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD024_UOn AND AUDMstId = AUD_FSD024_GuidKey AND AUDMstFld = 'TGFDES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD024_UOn,AUD_FSD024_GuidKey,'TGFINV',AUD_old_TGFINV,AUD_new_TGFINV FROM BANTPROD.AUD_FSD024_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD024_UOn AND AUDMstId = AUD_FSD024_GuidKey AND AUDMstFld = 'TGFINV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD024_UOn,AUD_FSD024_GuidKey,'TGMDA',AUD_old_TGMDA,AUD_new_TGMDA FROM BANTPROD.AUD_FSD024_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD024_UOn AND AUDMstId = AUD_FSD024_GuidKey AND AUDMstFld = 'TGMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD024_UOn,AUD_FSD024_GuidKey,'TGPAP',AUD_old_TGPAP,AUD_new_TGPAP FROM BANTPROD.AUD_FSD024_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD024_UOn AND AUDMstId = AUD_FSD024_GuidKey AND AUDMstFld = 'TGPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD024_UOn,AUD_FSD024_GuidKey,'TGPZO',AUD_old_TGPZO,AUD_new_TGPZO FROM BANTPROD.AUD_FSD024_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD024_UOn AND AUDMstId = AUD_FSD024_GuidKey AND AUDMstFld = 'TGPZO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD024_UOn,AUD_FSD024_GuidKey,'TGTASA',AUD_old_TGTASA,AUD_new_TGTASA FROM BANTPROD.AUD_FSD024_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD024_UOn AND AUDMstId = AUD_FSD024_GuidKey AND AUDMstFld = 'TGTASA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD024_UOn,AUD_FSD024_GuidKey,'TGTTAS',AUD_old_TGTTAS,AUD_new_TGTTAS FROM BANTPROD.AUD_FSD024_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD024_UOn AND AUDMstId = AUD_FSD024_GuidKey AND AUDMstFld = 'TGTTAS'); DELETE FROM AUD_FSD024_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD024_UOn AND AUDMstId = AUD_FSD024_GuidKey);  COMMIT ;END IF;END;
/

