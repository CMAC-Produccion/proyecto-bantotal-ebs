CREATE OR REPLACE PROCEDURE AUD_C_AUD002_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_AUD002_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_AUD002_UOn,AUD_AUD002_GuidKey,'AUD002',CONCAT( CONCAT( CONCAT( '|AUDGRPNAM=', RTRIM(COALESCE(AUD_old_AUDGRPNAM,AUD_new_AUDGRPNAM)) ),CONCAT( '|AUDTBLNAM=', RTRIM(COALESCE(AUD_old_AUDTBLNAM,AUD_new_AUDTBLNAM)) ) ),'|' ),AUD_AUD002_UBT,AUD_AUD002_UBU,AUD_AUD002_UBM,AUD_AUD002_UBP,AUD_AUD002_UBR,AUD_AUD002_UAs,AUD_AUD002_UBC,AUD_AUD002_UBA,AUD_AUD002_UBS, '', 'BANTOTAL', '', '', '',AUD_AUD002_UT FROM BANTPROD.AUD_AUD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_AUD002_UOn AND AUDMstId = AUD_AUD002_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_AUD002_UOn,AUD_AUD002_GuidKey,'AUDGRPNAM',AUD_old_AUDGRPNAM,AUD_new_AUDGRPNAM FROM BANTPROD.AUD_AUD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AUD002_UOn AND AUDMstId = AUD_AUD002_GuidKey AND AUDMstFld = 'AUDGRPNAM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AUD002_UOn,AUD_AUD002_GuidKey,'AUDTBLDLT',AUD_old_AUDTBLDLT,AUD_new_AUDTBLDLT FROM BANTPROD.AUD_AUD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AUD002_UOn AND AUDMstId = AUD_AUD002_GuidKey AND AUDMstFld = 'AUDTBLDLT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AUD002_UOn,AUD_AUD002_GuidKey,'AUDTBLENA',AUD_old_AUDTBLENA,AUD_new_AUDTBLENA FROM BANTPROD.AUD_AUD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AUD002_UOn AND AUDMstId = AUD_AUD002_GuidKey AND AUDMstFld = 'AUDTBLENA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AUD002_UOn,AUD_AUD002_GuidKey,'AUDTBLINS',AUD_old_AUDTBLINS,AUD_new_AUDTBLINS FROM BANTPROD.AUD_AUD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AUD002_UOn AND AUDMstId = AUD_AUD002_GuidKey AND AUDMstFld = 'AUDTBLINS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AUD002_UOn,AUD_AUD002_GuidKey,'AUDTBLNAM',AUD_old_AUDTBLNAM,AUD_new_AUDTBLNAM FROM BANTPROD.AUD_AUD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AUD002_UOn AND AUDMstId = AUD_AUD002_GuidKey AND AUDMstFld = 'AUDTBLNAM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AUD002_UOn,AUD_AUD002_GuidKey,'AUDTBLSTS',AUD_old_AUDTBLSTS,AUD_new_AUDTBLSTS FROM BANTPROD.AUD_AUD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AUD002_UOn AND AUDMstId = AUD_AUD002_GuidKey AND AUDMstFld = 'AUDTBLSTS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AUD002_UOn,AUD_AUD002_GuidKey,'AUDTBLTBL',AUD_old_AUDTBLTBL,AUD_new_AUDTBLTBL FROM BANTPROD.AUD_AUD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AUD002_UOn AND AUDMstId = AUD_AUD002_GuidKey AND AUDMstFld = 'AUDTBLTBL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_AUD002_UOn,AUD_AUD002_GuidKey,'AUDTBLUPD',AUD_old_AUDTBLUPD,AUD_new_AUDTBLUPD FROM BANTPROD.AUD_AUD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_AUD002_UOn AND AUDMstId = AUD_AUD002_GuidKey AND AUDMstFld = 'AUDTBLUPD'); DELETE FROM AUD_AUD002_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_AUD002_UOn AND AUDMstId = AUD_AUD002_GuidKey);  COMMIT ;END IF;END;
/

