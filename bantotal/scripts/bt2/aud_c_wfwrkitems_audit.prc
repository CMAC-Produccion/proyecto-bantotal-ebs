CREATE OR REPLACE PROCEDURE AUD_C_WFWRKITEMS_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_WFWRKITEMS_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFWRKITEMS',CONCAT( CONCAT( '|WFITEMID=', RTRIM(COALESCE(AUD_old_WFITEMID,AUD_new_WFITEMID)) ),'|' ),AUD_WFWRKITEMS_UBT,AUD_WFWRKITEMS_UBU,AUD_WFWRKITEMS_UBM,AUD_WFWRKITEMS_UBP,AUD_WFWRKITEMS_UBR,AUD_WFWRKITEMS_UAs,AUD_WFWRKITEMS_UBC,AUD_WFWRKITEMS_UBA,AUD_WFWRKITEMS_UBS, '', 'BANTOTAL', '', '', '',AUD_WFWRKITEMS_UT FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFINSPRCID',AUD_old_WFINSPRCID,AUD_new_WFINSPRCID FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFINSPRCID'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMDLN',AUD_old_WFITEMDLN,AUD_new_WFITEMDLN FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMDLN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMDLNTIME',TO_CHAR(AUD_old_WFITEMDLNTIME,'YYYY-MM-DD'),TO_CHAR(AUD_new_WFITEMDLNTIME,'YYYY-MM-DD') FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMDLNTIME'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMEND',TO_CHAR(AUD_old_WFITEMEND,'YYYY-MM-DD'),TO_CHAR(AUD_new_WFITEMEND,'YYYY-MM-DD') FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMEND'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMID',AUD_old_WFITEMID,AUD_new_WFITEMID FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMID'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMINIT',TO_CHAR(AUD_old_WFITEMINIT,'YYYY-MM-DD'),TO_CHAR(AUD_new_WFITEMINIT,'YYYY-MM-DD') FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMINIT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMPRCURN',AUD_old_WFITEMPRCURN,AUD_new_WFITEMPRCURN FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMPRCURN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMPRVSTA',AUD_old_WFITEMPRVSTA,AUD_new_WFITEMPRVSTA FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMPRVSTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMPRVTASK',AUD_old_WFITEMPRVTASK,AUD_new_WFITEMPRVTASK FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMPRVTASK'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEM
PTY',AUD_old_WFITEMPTY,AUD_new_WFITEMPTY FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMPTY'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMROLCOD',AUD_old_WFITEMROLCOD,AUD_new_WFITEMROLCOD FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMROLCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMSTSACT',AUD_old_WFITEMSTSACT,AUD_new_WFITEMSTSACT FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMSTSACT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMUSRCOD',AUD_old_WFITEMUSRCOD,AUD_new_WFITEMUSRCOD FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMUSRCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMWRN',AUD_old_WFITEMWRN,AUD_new_WFITEMWRN FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMWRN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFITEMWRNTIME',TO_CHAR(AUD_old_WFITEMWRNTIME,'YYYY-MM-DD'),TO_CHAR(AUD_new_WFITEMWRNTIME,'YYYY-MM-DD') FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFITEMWRNTIME'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFPRCID',AUD_old_WFPRCID,AUD_new_WFPRCID FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFPRCID'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFSTSCOD',AUD_old_WFSTSCOD,AUD_new_WFSTSCOD FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFSTSCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFWRKITEMS_UOn,AUD_WFWRKITEMS_GuidKey,'WFTASKCOD',AUD_old_WFTASKCOD,AUD_new_WFTASKCOD FROM BANTPROD.AUD_WFWRKITEMS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey AND AUDMstFld = 'WFTASKCOD'); DELETE FROM AUD_WFWRKITEMS_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_WFWRKITEMS_UOn AND AUDMstId = AUD_WFWRKITEMS_GuidKey);  COMMIT ;END IF;END;
/

