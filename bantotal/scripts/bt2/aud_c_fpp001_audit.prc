CREATE OR REPLACE PROCEDURE AUD_C_FPP001_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FPP001_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'FPP001',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|AOCTA=', RTRIM(COALESCE(AUD_old_AOCTA,AUD_new_AOCTA)) ),CONCAT( '|AOMDA=', RTRIM(COALESCE(AUD_old_AOMDA,AUD_new_AOMDA)) ) ),CONCAT( '|AOMOD=', RTRIM(COALESCE(AUD_old_AOMOD,AUD_new_AOMOD)) ) ),CONCAT( '|AOOPER=', RTRIM(COALESCE(AUD_old_AOOPER,AUD_new_AOOPER)) ) ),CONCAT( '|AOPAP=', RTRIM(COALESCE(AUD_old_AOPAP,AUD_new_AOPAP)) ) ),CONCAT( '|AOSBOP=', RTRIM(COALESCE(AUD_old_AOSBOP,AUD_new_AOSBOP)) ) ),CONCAT( '|AOSUC=', RTRIM(COALESCE(AUD_old_AOSUC,AUD_new_AOSUC)) ) ),CONCAT( '|AOTOPE=', RTRIM(COALESCE(AUD_old_AOTOPE,AUD_new_AOTOPE)) ) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|SGCOD=', RTRIM(COALESCE(AUD_old_SGCOD,AUD_new_SGCOD)) ) ),'|' ),AUD_FPP001_UBT,AUD_FPP001_UBU,AUD_FPP001_UBM,AUD_FPP001_UBP,AUD_FPP001_UBR,AUD_FPP001_UAs,AUD_FPP001_UBC,AUD_FPP001_UBA,AUD_FPP001_UBS, '', 'BANTOTAL', '', '', '',AUD_FPP001_UT FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'AOCTA',AUD_old_AOCTA,AUD_new_AOCTA FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'AOCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'AOMDA',AUD_old_AOMDA,AUD_new_AOMDA FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'AOMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'AOMOD',AUD_old_AOMOD,AUD_new_AOMOD FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'AOMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'AOOPER',AUD_old_AOOPER,AUD_new_AOOPER FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'AOOPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'AOPAP',AUD_old_AOPAP,AUD_new_AOPAP FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'AOPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'AOSBOP',AUD_old_AOSBOP,AUD_new_AOSBOP FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'AOSBOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'AOSUC',AUD_old_AOSUC,AUD_new_AOSUC FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'AOSUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'AOTOPE',AUD_old_AOTOPE,AUD_new_AOTOPE FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'AOTOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AN
D AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001AUX1',AUD_old_PP001AUX1,AUD_new_PP001AUX1 FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001AUX1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001AUX2',AUD_old_PP001AUX2,AUD_new_PP001AUX2 FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001AUX2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001AUX3',TO_CHAR(AUD_old_PP001AUX3,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP001AUX3,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001AUX3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001AUX4',AUD_old_PP001AUX4,AUD_new_PP001AUX4 FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001AUX4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001AUX5',AUD_old_PP001AUX5,AUD_new_PP001AUX5 FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001AUX5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001AUX6',AUD_old_PP001AUX6,AUD_new_PP001AUX6 FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001AUX6'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001AUX7',AUD_old_PP001AUX7,AUD_new_PP001AUX7 FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001AUX7'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001CO',AUD_old_PP001CO,AUD_new_PP001CO FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001CO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001END',AUD_old_PP001END,AUD_new_PP001END FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001END'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001IMP',AUD_old_PP001IMP,AUD_new_PP001IMP FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001IMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001INM',AUD_old_PP001INM,AUD_new_PP001INM FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001INM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001PART',AUD_old_PP001PART,AUD_new_PP001PART FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001PART'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001PLUS',AUD_old_PP001PLUS,AUD_new_PP001PLUS FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001PLUS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001PORC',AUD_old_PP001PORC,AUD_new_PP001PORC FROM BANTPROD.AUD_FPP001_A
UDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001PORC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001STAT',AUD_old_PP001STAT,AUD_new_PP001STAT FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001STAT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001VC',AUD_old_PP001VC,AUD_new_PP001VC FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001VC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'PP001VEH',AUD_old_PP001VEH,AUD_new_PP001VEH FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'PP001VEH'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP001_UOn,AUD_FPP001_GuidKey,'SGCOD',AUD_old_SGCOD,AUD_new_SGCOD FROM BANTPROD.AUD_FPP001_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey AND AUDMstFld = 'SGCOD'); DELETE FROM AUD_FPP001_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP001_UOn AND AUDMstId = AUD_FPP001_GuidKey);  COMMIT ;END IF;END;
/

