CREATE OR REPLACE PROCEDURE AUD_C_FRNG51_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FRNG51_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FRNG51_UOn,AUD_FRNG51_GuidKey,'FRNG51',CONCAT( CONCAT( CONCAT( CONCAT( '|RNG49COD=', RTRIM(COALESCE(AUD_old_RNG49COD,AUD_new_RNG49COD)) ),CONCAT( '|RNG50GRP=', RTRIM(COALESCE(AUD_old_RNG50GRP,AUD_new_RNG50GRP)) ) ),CONCAT( '|RNG51COD=', RTRIM(COALESCE(AUD_old_RNG51COD,AUD_new_RNG51COD)) ) ),'|' ),AUD_FRNG51_UBT,AUD_FRNG51_UBU,AUD_FRNG51_UBM,AUD_FRNG51_UBP,AUD_FRNG51_UBR,AUD_FRNG51_UAs,AUD_FRNG51_UBC,AUD_FRNG51_UBA,AUD_FRNG51_UBS, '', 'BANTOTAL', '', '', '',AUD_FRNG51_UT FROM BANTPROD.AUD_FRNG51_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG51_UOn AND AUDMstId = AUD_FRNG51_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG51_UOn,AUD_FRNG51_GuidKey,'RNG49COD',AUD_old_RNG49COD,AUD_new_RNG49COD FROM BANTPROD.AUD_FRNG51_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG51_UOn AND AUDMstId = AUD_FRNG51_GuidKey AND AUDMstFld = 'RNG49COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG51_UOn,AUD_FRNG51_GuidKey,'RNG50GRP',AUD_old_RNG50GRP,AUD_new_RNG50GRP FROM BANTPROD.AUD_FRNG51_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG51_UOn AND AUDMstId = AUD_FRNG51_GuidKey AND AUDMstFld = 'RNG50GRP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG51_UOn,AUD_FRNG51_GuidKey,'RNG51ATR',AUD_old_RNG51ATR,AUD_new_RNG51ATR FROM BANTPROD.AUD_FRNG51_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG51_UOn AND AUDMstId = AUD_FRNG51_GuidKey AND AUDMstFld = 'RNG51ATR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG51_UOn,AUD_FRNG51_GuidKey,'RNG51COD',AUD_old_RNG51COD,AUD_new_RNG51COD FROM BANTPROD.AUD_FRNG51_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG51_UOn AND AUDMstId = AUD_FRNG51_GuidKey AND AUDMstFld = 'RNG51COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG51_UOn,AUD_FRNG51_GuidKey,'RNG51COR',AUD_old_RNG51COR,AUD_new_RNG51COR FROM BANTPROD.AUD_FRNG51_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG51_UOn AND AUDMstId = AUD_FRNG51_GuidKey AND AUDMstFld = 'RNG51COR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG51_UOn,AUD_FRNG51_GuidKey,'RNG51OPE',AUD_old_RNG51OPE,AUD_new_RNG51OPE FROM BANTPROD.AUD_FRNG51_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG51_UOn AND AUDMstId = AUD_FRNG51_GuidKey AND AUDMstFld = 'RNG51OPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG51_UOn,AUD_FRNG51_GuidKey,'RNG51ORD',AUD_old_RNG51ORD,AUD_new_RNG51ORD FROM BANTPROD.AUD_FRNG51_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG51_UOn AND AUDMstId = AUD_FRNG51_GuidKey AND AUDMstFld = 'RNG51ORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG51_UOn,AUD_FRNG51_GuidKey,'RNG51TEV',AUD_old_RNG51TEV,AUD_new_RNG51TEV FROM BANTPROD.AUD_FRNG51_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG51_UOn AND AUDMstId = AUD_FRNG51_GuidKey AND AUDMstFld = 'RNG51TEV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG51_UOn,AUD_FRNG51_GuidKey,'RNG51VAL',AUD_old_RNG51VAL,AUD_new_RNG51VAL FROM BANTPROD.AUD_FRNG51_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG51_UOn AND AUDMstId = AUD_FRNG51_GuidKey AND AUDMstFld = 'RNG51VAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG51_UOn,AUD_FRNG51_GuidKey,'RNG68COD',AUD_old_RNG68COD,AUD_new_RNG68COD FROM BANTPROD.AUD_FRNG51_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG51_UOn AND AUDMstId = AUD_FRNG51_GuidKey AND AUDMstFld = 'RNG68COD'); DELETE FROM AUD_FRNG51_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG51_U
On AND AUDMstId = AUD_FRNG51_GuidKey);  COMMIT ;END IF;END;
/

