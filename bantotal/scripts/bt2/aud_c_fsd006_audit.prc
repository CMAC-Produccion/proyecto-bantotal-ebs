CREATE OR REPLACE PROCEDURE AUD_C_FSD006_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD006_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'FSD006',CONCAT( CONCAT( CONCAT( CONCAT( '|CTNRO=', RTRIM(COALESCE(AUD_old_CTNRO,AUD_new_CTNRO)) ),CONCAT( '|DOCOD=', RTRIM(COALESCE(AUD_old_DOCOD,AUD_new_DOCOD)) ) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),'|' ),AUD_FSD006_UBT,AUD_FSD006_UBU,AUD_FSD006_UBM,AUD_FSD006_UBP,AUD_FSD006_UBR,AUD_FSD006_UAs,AUD_FSD006_UBC,AUD_FSD006_UBA,AUD_FSD006_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD006_UT FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'CTNRO',AUD_old_CTNRO,AUD_new_CTNRO FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'CTNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'DOAPAR',AUD_old_DOAPAR,AUD_new_DOAPAR FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'DOAPAR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'DOCALL',AUD_old_DOCALL,AUD_new_DOCALL FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'DOCALL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'DOCCOR',AUD_old_DOCCOR,AUD_new_DOCCOR FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'DOCCOR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'DOCIUD',AUD_old_DOCIUD,AUD_new_DOCIUD FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'DOCIUD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'DOCOD',AUD_old_DOCOD,AUD_new_DOCOD FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'DOCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'DOCPOS',AUD_old_DOCPOS,AUD_new_DOCPOS FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'DOCPOS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'DODEPCOD',AUD_old_DODEPCOD,AUD_new_DODEPCOD FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'DODEPCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'DODEPT',AUD_old_DODEPT,AUD_new_DODEPT FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'DODEPT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'DONRO',AUD_old_DONRO,AUD_new_DONRO FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'DONRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'DOPAIS',AUD_old_DOPAIS,AUD_new_DOPAIS FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_
UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'DOPAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD006_UOn,AUD_FSD006_GuidKey,'SUCURS',AUD_old_SUCURS,AUD_new_SUCURS FROM BANTPROD.AUD_FSD006_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey AND AUDMstFld = 'SUCURS'); DELETE FROM AUD_FSD006_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD006_UOn AND AUDMstId = AUD_FSD006_GuidKey);  COMMIT ;END IF;END;
/

