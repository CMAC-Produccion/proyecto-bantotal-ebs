CREATE OR REPLACE PROCEDURE AUD_C_FRNG50_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FRNG50_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FRNG50_UOn,AUD_FRNG50_GuidKey,'FRNG50',CONCAT( CONCAT( CONCAT( '|RNG49COD=', RTRIM(COALESCE(AUD_old_RNG49COD,AUD_new_RNG49COD)) ),CONCAT( '|RNG50GRP=', RTRIM(COALESCE(AUD_old_RNG50GRP,AUD_new_RNG50GRP)) ) ),'|' ),AUD_FRNG50_UBT,AUD_FRNG50_UBU,AUD_FRNG50_UBM,AUD_FRNG50_UBP,AUD_FRNG50_UBR,AUD_FRNG50_UAs,AUD_FRNG50_UBC,AUD_FRNG50_UBA,AUD_FRNG50_UBS, '', 'BANTOTAL', '', '', '',AUD_FRNG50_UT FROM BANTPROD.AUD_FRNG50_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG50_UOn AND AUDMstId = AUD_FRNG50_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG50_UOn,AUD_FRNG50_GuidKey,'RNG49COD',AUD_old_RNG49COD,AUD_new_RNG49COD FROM BANTPROD.AUD_FRNG50_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG50_UOn AND AUDMstId = AUD_FRNG50_GuidKey AND AUDMstFld = 'RNG49COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG50_UOn,AUD_FRNG50_GuidKey,'RNG50GRP',AUD_old_RNG50GRP,AUD_new_RNG50GRP FROM BANTPROD.AUD_FRNG50_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG50_UOn AND AUDMstId = AUD_FRNG50_GuidKey AND AUDMstFld = 'RNG50GRP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG50_UOn,AUD_FRNG50_GuidKey,'RNG50ORD',AUD_old_RNG50ORD,AUD_new_RNG50ORD FROM BANTPROD.AUD_FRNG50_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG50_UOn AND AUDMstId = AUD_FRNG50_GuidKey AND AUDMstFld = 'RNG50ORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG50_UOn,AUD_FRNG50_GuidKey,'RNG50RET',AUD_old_RNG50RET,AUD_new_RNG50RET FROM BANTPROD.AUD_FRNG50_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG50_UOn AND AUDMstId = AUD_FRNG50_GuidKey AND AUDMstFld = 'RNG50RET'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FRNG50_UOn,AUD_FRNG50_GuidKey,'RNG50ULT',AUD_old_RNG50ULT,AUD_new_RNG50ULT FROM BANTPROD.AUD_FRNG50_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FRNG50_UOn AND AUDMstId = AUD_FRNG50_GuidKey AND AUDMstFld = 'RNG50ULT'); DELETE FROM AUD_FRNG50_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FRNG50_UOn AND AUDMstId = AUD_FRNG50_GuidKey);  COMMIT ;END IF;END;
/

