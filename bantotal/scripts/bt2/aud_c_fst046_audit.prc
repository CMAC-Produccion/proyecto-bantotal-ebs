CREATE OR REPLACE PROCEDURE AUD_C_FST046_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST046_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST046_UOn,AUD_FST046_GuidKey,'FST046',CONCAT( CONCAT( CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ),CONCAT( '|UBUSER=', RTRIM(COALESCE(AUD_old_UBUSER,AUD_new_UBUSER)) ) ),'|' ),AUD_FST046_UBT,AUD_FST046_UBU,AUD_FST046_UBM,AUD_FST046_UBP,AUD_FST046_UBR,AUD_FST046_UAs,AUD_FST046_UBC,AUD_FST046_UBA,AUD_FST046_UBS, '', 'BANTOTAL', '', '', '',AUD_FST046_UT FROM BANTPROD.AUD_FST046_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST046_UOn AND AUDMstId = AUD_FST046_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST046_UOn,AUD_FST046_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FST046_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST046_UOn AND AUDMstId = AUD_FST046_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST046_UOn,AUD_FST046_GuidKey,'UBCAJ',AUD_old_UBCAJ,AUD_new_UBCAJ FROM BANTPROD.AUD_FST046_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST046_UOn AND AUDMstId = AUD_FST046_GuidKey AND AUDMstFld = 'UBCAJ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST046_UOn,AUD_FST046_GuidKey,'UBMNU',AUD_old_UBMNU,AUD_new_UBMNU FROM BANTPROD.AUD_FST046_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST046_UOn AND AUDMstId = AUD_FST046_GuidKey AND AUDMstFld = 'UBMNU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST046_UOn,AUD_FST046_GuidKey,'UBNCAJ',AUD_old_UBNCAJ,AUD_new_UBNCAJ FROM BANTPROD.AUD_FST046_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST046_UOn AND AUDMstId = AUD_FST046_GuidKey AND AUDMstFld = 'UBNCAJ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST046_UOn,AUD_FST046_GuidKey,'UBNIV',AUD_old_UBNIV,AUD_new_UBNIV FROM BANTPROD.AUD_FST046_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST046_UOn AND AUDMstId = AUD_FST046_GuidKey AND AUDMstFld = 'UBNIV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST046_UOn,AUD_FST046_GuidKey,'UBPRD',AUD_old_UBPRD,AUD_new_UBPRD FROM BANTPROD.AUD_FST046_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST046_UOn AND AUDMstId = AUD_FST046_GuidKey AND AUDMstFld = 'UBPRD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST046_UOn,AUD_FST046_GuidKey,'UBSUC',AUD_old_UBSUC,AUD_new_UBSUC FROM BANTPROD.AUD_FST046_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST046_UOn AND AUDMstId = AUD_FST046_GuidKey AND AUDMstFld = 'UBSUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST046_UOn,AUD_FST046_GuidKey,'UBUSER',AUD_old_UBUSER,AUD_new_UBUSER FROM BANTPROD.AUD_FST046_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST046_UOn AND AUDMstId = AUD_FST046_GuidKey AND AUDMstFld = 'UBUSER'); DELETE FROM AUD_FST046_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST046_UOn AND AUDMstId = AUD_FST046_GuidKey);  COMMIT ;END IF;END;
/

