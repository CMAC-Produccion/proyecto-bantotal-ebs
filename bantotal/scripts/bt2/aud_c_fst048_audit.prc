CREATE OR REPLACE PROCEDURE AUD_C_FST048_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST048_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'FST048',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|MODULO=', RTRIM(COALESCE(AUD_old_MODULO,AUD_new_MODULO)) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|TRNRO=', RTRIM(COALESCE(AUD_old_TRNRO,AUD_new_TRNRO)) ) ),CONCAT( '|UBUSER=', RTRIM(COALESCE(AUD_old_UBUSER,AUD_new_UBUSER)) ) ),'|' ),AUD_FST048_UBT,AUD_FST048_UBU,AUD_FST048_UBM,AUD_FST048_UBP,AUD_FST048_UBR,AUD_FST048_UAs,AUD_FST048_UBC,AUD_FST048_UBA,AUD_FST048_UBS, '', 'BANTOTAL', '', '', '',AUD_FST048_UT FROM BANTPROD.AUD_FST048_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'MODULO',AUD_old_MODULO,AUD_new_MODULO FROM BANTPROD.AUD_FST048_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey AND AUDMstFld = 'MODULO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FST048_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'TRNRO',AUD_old_TRNRO,AUD_new_TRNRO FROM BANTPROD.AUD_FST048_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey AND AUDMstFld = 'TRNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'UBTCON',AUD_old_UBTCON,AUD_new_UBTCON FROM BANTPROD.AUD_FST048_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey AND AUDMstFld = 'UBTCON'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'UBTING',AUD_old_UBTING,AUD_new_UBTING FROM BANTPROD.AUD_FST048_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey AND AUDMstFld = 'UBTING'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'UBTPRO',AUD_old_UBTPRO,AUD_new_UBTPRO FROM BANTPROD.AUD_FST048_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey AND AUDMstFld = 'UBTPRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'UBTSN1',AUD_old_UBTSN1,AUD_new_UBTSN1 FROM BANTPROD.AUD_FST048_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey AND AUDMstFld = 'UBTSN1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'UBTSN2',AUD_old_UBTSN2,AUD_new_UBTSN2 FROM BANTPROD.AUD_FST048_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey AND AUDMstFld = 'UBTSN2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'UBTSN3',AUD_old_UBTSN3,AUD_new_UBTSN3 FROM BANTPROD.AUD_FST048_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey AND AUDMstFld = 'UBTSN3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'UBTSUP',AUD_old_UBTSUP,AUD_new_UBTSUP FROM BANTPROD.AUD_FST048_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey AND AUDMstFld = 'UBTSUP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST048_UOn,AUD_FST048_GuidKey,'UBUSER',AUD_old_UBUSER,AUD_new_UBUSER FROM BANTPROD.AUD_FST048_AUDIT
 WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey AND AUDMstFld = 'UBUSER'); DELETE FROM AUD_FST048_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST048_UOn AND AUDMstId = AUD_FST048_GuidKey);  COMMIT ;END IF;END;
/

