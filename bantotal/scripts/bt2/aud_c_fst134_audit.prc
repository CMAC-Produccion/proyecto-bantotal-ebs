CREATE OR REPLACE PROCEDURE AUD_C_FST134_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST134_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST134_UOn,AUD_FST134_GuidKey,'FST134',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|IDPOS=', RTRIM(COALESCE(AUD_old_IDPOS,AUD_new_IDPOS)) ),CONCAT( '|IDRNG=', RTRIM(COALESCE(AUD_old_IDRNG,AUD_new_IDRNG)) ) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|TRMOD=', RTRIM(COALESCE(AUD_old_TRMOD,AUD_new_TRMOD)) ) ),CONCAT( '|TRNRO=', RTRIM(COALESCE(AUD_old_TRNRO,AUD_new_TRNRO)) ) ),CONCAT( '|TRORD=', RTRIM(COALESCE(AUD_old_TRORD,AUD_new_TRORD)) ) ),'|' ),AUD_FST134_UBT,AUD_FST134_UBU,AUD_FST134_UBM,AUD_FST134_UBP,AUD_FST134_UBR,AUD_FST134_UAs,AUD_FST134_UBC,AUD_FST134_UBA,AUD_FST134_UBS, '', 'BANTOTAL', '', '', '',AUD_FST134_UT FROM BANTPROD.AUD_FST134_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST134_UOn AND AUDMstId = AUD_FST134_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST134_UOn,AUD_FST134_GuidKey,'IDCOD',AUD_old_IDCOD,AUD_new_IDCOD FROM BANTPROD.AUD_FST134_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST134_UOn AND AUDMstId = AUD_FST134_GuidKey AND AUDMstFld = 'IDCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST134_UOn,AUD_FST134_GuidKey,'IDORD',AUD_old_IDORD,AUD_new_IDORD FROM BANTPROD.AUD_FST134_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST134_UOn AND AUDMstId = AUD_FST134_GuidKey AND AUDMstFld = 'IDORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST134_UOn,AUD_FST134_GuidKey,'IDPOS',AUD_old_IDPOS,AUD_new_IDPOS FROM BANTPROD.AUD_FST134_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST134_UOn AND AUDMstId = AUD_FST134_GuidKey AND AUDMstFld = 'IDPOS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST134_UOn,AUD_FST134_GuidKey,'IDRNG',AUD_old_IDRNG,AUD_new_IDRNG FROM BANTPROD.AUD_FST134_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST134_UOn AND AUDMstId = AUD_FST134_GuidKey AND AUDMstFld = 'IDRNG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST134_UOn,AUD_FST134_GuidKey,'IDTXT',AUD_old_IDTXT,AUD_new_IDTXT FROM BANTPROD.AUD_FST134_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST134_UOn AND AUDMstId = AUD_FST134_GuidKey AND AUDMstFld = 'IDTXT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST134_UOn,AUD_FST134_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FST134_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST134_UOn AND AUDMstId = AUD_FST134_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST134_UOn,AUD_FST134_GuidKey,'TRMOD',AUD_old_TRMOD,AUD_new_TRMOD FROM BANTPROD.AUD_FST134_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST134_UOn AND AUDMstId = AUD_FST134_GuidKey AND AUDMstFld = 'TRMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST134_UOn,AUD_FST134_GuidKey,'TRNRO',AUD_old_TRNRO,AUD_new_TRNRO FROM BANTPROD.AUD_FST134_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST134_UOn AND AUDMstId = AUD_FST134_GuidKey AND AUDMstFld = 'TRNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST134_UOn,AUD_FST134_GuidKey,'TRORD',AUD_old_TRORD,AUD_new_TRORD FROM BANTPROD.AUD_FST134_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST134_UOn AND AUDMstId = AUD_FST134_GuidKey AND AUDMstFld = 'TRORD'); DELETE FROM AUD_FST134_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST134_UOn AND AUDMstId = AUD_FST134_GuidKey);  COMMIT ;END IF;END;
/

