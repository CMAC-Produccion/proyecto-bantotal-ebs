CREATE OR REPLACE PROCEDURE AUD_C_JAQN002_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_JAQN002_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|JAQN002NDO=', RTRIM(COALESCE(AUD_old_JAQN002NDO,AUD_new_JAQN002NDO)) ),CONCAT( '|JAQN002PAI=', RTRIM(COALESCE(AUD_old_JAQN002PAI,AUD_new_JAQN002PAI)) ) ),CONCAT( '|JAQN002PGC=', RTRIM(COALESCE(AUD_old_JAQN002PGC,AUD_new_JAQN002PGC)) ) ),CONCAT( '|JAQN002TDO=', RTRIM(COALESCE(AUD_old_JAQN002TDO,AUD_new_JAQN002TDO)) ) ),CONCAT( '|JAQN002USR=', RTRIM(COALESCE(AUD_old_JAQN002USR,AUD_new_JAQN002USR)) ) ),'|' ),AUD_JAQN002_UBT,AUD_JAQN002_UBU,AUD_JAQN002_UBM,AUD_JAQN002_UBP,AUD_JAQN002_UBR,AUD_JAQN002_UAs,AUD_JAQN002_UBC,AUD_JAQN002_UBA,AUD_JAQN002_UBS, '', 'BANTOTAL', '', '', '',AUD_JAQN002_UT FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002AX1',AUD_old_JAQN002AX1,AUD_new_JAQN002AX1 FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002AX1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002AX2',AUD_old_JAQN002AX2,AUD_new_JAQN002AX2 FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002AX2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002AX3',AUD_old_JAQN002AX3,AUD_new_JAQN002AX3 FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002AX3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002AX4',AUD_old_JAQN002AX4,AUD_new_JAQN002AX4 FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002AX4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002AX5',AUD_old_JAQN002AX5,AUD_new_JAQN002AX5 FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002AX5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002AX6',AUD_old_JAQN002AX6,AUD_new_JAQN002AX6 FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002AX6'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002AX7',TO_CHAR(AUD_old_JAQN002AX7,'YYYY-MM-DD'),TO_CHAR(AUD_new_JAQN002AX7,'YYYY-MM-DD') FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002AX7'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002AX8',TO_CHAR(AUD_old_JAQN002AX8,'YYYY-MM-DD'),TO_CHAR(AUD_new_JAQN002AX8,'YYYY-MM-DD') FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002AX8'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002NDO',AUD_old_JAQN002NDO,AUD_new_JAQN002NDO FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AN
D AUDMstFld = 'JAQN002NDO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002PAI',AUD_old_JAQN002PAI,AUD_new_JAQN002PAI FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002PAI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002PGC',AUD_old_JAQN002PGC,AUD_new_JAQN002PGC FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002PGC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002TDO',AUD_old_JAQN002TDO,AUD_new_JAQN002TDO FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002TDO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_JAQN002_UOn,AUD_JAQN002_GuidKey,'JAQN002USR',AUD_old_JAQN002USR,AUD_new_JAQN002USR FROM BANTPROD.AUD_JAQN002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey AND AUDMstFld = 'JAQN002USR'); DELETE FROM AUD_JAQN002_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_JAQN002_UOn AND AUDMstId = AUD_JAQN002_GuidKey);  COMMIT ;END IF;END;
/

