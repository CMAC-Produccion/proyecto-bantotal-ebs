CREATE OR REPLACE PROCEDURE AUD_C_FPP025_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FPP025_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'FPP025',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PP010PRD=', RTRIM(COALESCE(AUD_old_PP010PRD,AUD_new_PP010PRD)) ),CONCAT( '|PP017PAR=', RTRIM(COALESCE(AUD_old_PP017PAR,AUD_new_PP017PAR)) ) ),CONCAT( '|PP025CLAV=', RTRIM(COALESCE(AUD_old_PP025CLAV,AUD_new_PP025CLAV)) ) ),CONCAT( '|PP025EMP=', RTRIM(COALESCE(AUD_old_PP025EMP,AUD_new_PP025EMP)) ) ),'|' ),AUD_FPP025_UBT,AUD_FPP025_UBU,AUD_FPP025_UBM,AUD_FPP025_UBP,AUD_FPP025_UBR,AUD_FPP025_UAs,AUD_FPP025_UBC,AUD_FPP025_UBA,AUD_FPP025_UBS, '', 'BANTOTAL', '', '', '',AUD_FPP025_UT FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP010PRD',AUD_old_PP010PRD,AUD_new_PP010PRD FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP010PRD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP017PAR',AUD_old_PP017PAR,AUD_new_PP017PAR FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP017PAR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025AUX1',AUD_old_PP025AUX1,AUD_new_PP025AUX1 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025AUX1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025AUX2',AUD_old_PP025AUX2,AUD_new_PP025AUX2 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025AUX2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025AUX3',TO_CHAR(AUD_old_PP025AUX3,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP025AUX3,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025AUX3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025AUX4',AUD_old_PP025AUX4,AUD_new_PP025AUX4 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025AUX4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025AUX5',AUD_old_PP025AUX5,AUD_new_PP025AUX5 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025AUX5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025CAR1',AUD_old_PP025CAR1,AUD_new_PP025CAR1 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025CAR1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025CAR2',AUD_old_PP025CAR2,AUD_new_PP025CAR2 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025CAR2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025CAR3',AUD_old_PP025CAR3,AUD_new_PP025CAR3 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND A
UDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025CAR3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025CLAV',AUD_old_PP025CLAV,AUD_new_PP025CLAV FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025CLAV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025DEFC',AUD_old_PP025DEFC,AUD_new_PP025DEFC FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025DEFC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025DEFD',TO_CHAR(AUD_old_PP025DEFD,'YYYY-MM-DD'),TO_CHAR(AUD_new_PP025DEFD,'YYYY-MM-DD') FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025DEFD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025DEFN',AUD_old_PP025DEFN,AUD_new_PP025DEFN FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025DEFN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025DEFV',AUD_old_PP025DEFV,AUD_new_PP025DEFV FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025DEFV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025EMP',AUD_old_PP025EMP,AUD_new_PP025EMP FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025EMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025MAXN',AUD_old_PP025MAXN,AUD_new_PP025MAXN FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025MAXN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025MINN',AUD_old_PP025MINN,AUD_new_PP025MINN FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025MINN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025MOD1',AUD_old_PP025MOD1,AUD_new_PP025MOD1 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025MOD1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025MOD2',AUD_old_PP025MOD2,AUD_new_PP025MOD2 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025MOD2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025MOD3',AUD_old_PP025MOD3,AUD_new_PP025MOD3 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025MOD3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025TIPOS',AUD_old_PP025TIPOS,AUD_new_PP025TIPOS FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025TIPOS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025VIS1',AUD_old_PP025VIS1,AUD_new_PP025VIS1 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025VIS1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025VIS2',AUD_old
_PP025VIS2,AUD_new_PP025VIS2 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025VIS2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP025_UOn,AUD_FPP025_GuidKey,'PP025VIS3',AUD_old_PP025VIS3,AUD_new_PP025VIS3 FROM BANTPROD.AUD_FPP025_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey AND AUDMstFld = 'PP025VIS3'); DELETE FROM AUD_FPP025_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP025_UOn AND AUDMstId = AUD_FPP025_GuidKey);  COMMIT ;END IF;END;
/

