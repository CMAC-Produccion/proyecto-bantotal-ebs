CREATE OR REPLACE PROCEDURE AUD_C_SNG402_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG402_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG402',CONCAT( CONCAT( CONCAT( CONCAT( '|SNG400COD=', RTRIM(COALESCE(AUD_old_SNG400COD,AUD_new_SNG400COD)) ),CONCAT( '|SNG400EVTO=', RTRIM(COALESCE(AUD_old_SNG400EVTO,AUD_new_SNG400EVTO)) ) ),CONCAT( '|SNG402CR=', RTRIM(COALESCE(AUD_old_SNG402CR,AUD_new_SNG402CR)) ) ),'|' ),AUD_SNG402_UBT,AUD_SNG402_UBU,AUD_SNG402_UBM,AUD_SNG402_UBP,AUD_SNG402_UBR,AUD_SNG402_UAs,AUD_SNG402_UBC,AUD_SNG402_UBA,AUD_SNG402_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG402_UT FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG400COD',AUD_old_SNG400COD,AUD_new_SNG400COD FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG400COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG400EVTO',AUD_old_SNG400EVTO,AUD_new_SNG400EVTO FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG400EVTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG402ACC',AUD_old_SNG402ACC,AUD_new_SNG402ACC FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG402ACC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG402AG',AUD_old_SNG402AG,AUD_new_SNG402AG FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG402AG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG402CR',AUD_old_SNG402CR,AUD_new_SNG402CR FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG402CR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG402EST',AUD_old_SNG402EST,AUD_new_SNG402EST FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG402EST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG402NUM',AUD_old_SNG402NUM,AUD_new_SNG402NUM FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG402NUM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG402PR',AUD_old_SNG402PR,AUD_new_SNG402PR FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG402PR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG402REP',AUD_old_SNG402REP,AUD_new_SNG402REP FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG402REP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG402RNG',AUD_old_SNG402RNG,AUD_new_SNG402RNG FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG402RNG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_Gui
dKey,'SNG402TAS',AUD_old_SNG402TAS,AUD_new_SNG402TAS FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG402TAS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG402_UOn,AUD_SNG402_GuidKey,'SNG402TEM',AUD_old_SNG402TEM,AUD_new_SNG402TEM FROM BANTPROD.AUD_SNG402_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey AND AUDMstFld = 'SNG402TEM'); DELETE FROM AUD_SNG402_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG402_UOn AND AUDMstId = AUD_SNG402_GuidKey);  COMMIT ;END IF;END;
/

