CREATE OR REPLACE PROCEDURE AUD_C_FSE013_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSE013_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'FSE013',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|CVCTA=', RTRIM(COALESCE(AUD_old_CVCTA,AUD_new_CVCTA)) ),CONCAT( '|CVMDA=', RTRIM(COALESCE(AUD_old_CVMDA,AUD_new_CVMDA)) ) ),CONCAT( '|CVMOD=', RTRIM(COALESCE(AUD_old_CVMOD,AUD_new_CVMOD)) ) ),CONCAT( '|CVOPER=', RTRIM(COALESCE(AUD_old_CVOPER,AUD_new_CVOPER)) ) ),CONCAT( '|CVPAP=', RTRIM(COALESCE(AUD_old_CVPAP,AUD_new_CVPAP)) ) ),CONCAT( '|CVSBOP=', RTRIM(COALESCE(AUD_old_CVSBOP,AUD_new_CVSBOP)) ) ),CONCAT( '|CVSUC=', RTRIM(COALESCE(AUD_old_CVSUC,AUD_new_CVSUC)) ) ),CONCAT( '|CVTOPE=', RTRIM(COALESCE(AUD_old_CVTOPE,AUD_new_CVTOPE)) ) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),'|' ),AUD_FSE013_UBT,AUD_FSE013_UBU,AUD_FSE013_UBM,AUD_FSE013_UBP,AUD_FSE013_UBR,AUD_FSE013_UAs,AUD_FSE013_UBC,AUD_FSE013_UBA,AUD_FSE013_UBS, '', 'BANTOTAL', '', '', '',AUD_FSE013_UT FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVCAUT',AUD_old_CVCAUT,AUD_new_CVCAUT FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVCAUT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVCCHQ',AUD_old_CVCCHQ,AUD_new_CVCCHQ FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVCCHQ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVCINT',AUD_old_CVCINT,AUD_new_CVCINT FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVCINT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVCSMO',AUD_old_CVCSMO,AUD_new_CVCSMO FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVCSMO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVCSPR',AUD_old_CVCSPR,AUD_new_CVCSPR FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVCSPR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVCTA',AUD_old_CVCTA,AUD_new_CVCTA FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVESTC',AUD_old_CVESTC,AUD_new_CVESTC FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVESTC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVFCBJ',TO_CHAR(AUD_old_CVFCBJ,'YYYY-MM-DD'),TO_CHAR(AUD_new_CVFCBJ,'YYYY-MM-DD') FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVFCBJ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVFOLIO',AUD_old_CVFOLIO,AUD_new_CVFOLIO FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFl
d = 'CVFOLIO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVMDA',AUD_old_CVMDA,AUD_new_CVMDA FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVMOD',AUD_old_CVMOD,AUD_new_CVMOD FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVNOM',AUD_old_CVNOM,AUD_new_CVNOM FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVNOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVOPER',AUD_old_CVOPER,AUD_new_CVOPER FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVOPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVPAP',AUD_old_CVPAP,AUD_new_CVPAP FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVPINT',AUD_old_CVPINT,AUD_new_CVPINT FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVPINT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVPMI',AUD_old_CVPMI,AUD_new_CVPMI FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVPMI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVSBGA',AUD_old_CVSBGA,AUD_new_CVSBGA FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVSBGA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVSBOP',AUD_old_CVSBOP,AUD_new_CVSBOP FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVSBOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVSUC',AUD_old_CVSUC,AUD_new_CVSUC FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVSUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVTCES',AUD_old_CVTCES,AUD_new_CVTCES FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVTCES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVTOPE',AUD_old_CVTOPE,AUD_new_CVTOPE FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVTOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVUSBJ',AUD_old_CVUSBJ,AUD_new_CVUSBJ FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVUSBJ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'CVWSBJ',AUD_old_CVWSBJ,AUD_new_CVWSBJ FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'CVWSBJ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSE013_UOn,AUD_FSE013_GuidKey,'PGCO
D',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSE013_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey AND AUDMstFld = 'PGCOD'); DELETE FROM AUD_FSE013_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSE013_UOn AND AUDMstId = AUD_FSE013_GuidKey);  COMMIT ;END IF;END;
/

