CREATE OR REPLACE PROCEDURE AUD_C_FSD002_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSD002_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'FSD002',CONCAT( CONCAT( CONCAT( CONCAT( '|PFNDOC=', RTRIM(COALESCE(AUD_old_PFNDOC,AUD_new_PFNDOC)) ),CONCAT( '|PFPAIS=', RTRIM(COALESCE(AUD_old_PFPAIS,AUD_new_PFPAIS)) ) ),CONCAT( '|PFTDOC=', RTRIM(COALESCE(AUD_old_PFTDOC,AUD_new_PFTDOC)) ) ),'|' ),AUD_FSD002_UBT,AUD_FSD002_UBU,AUD_FSD002_UBM,AUD_FSD002_UBP,AUD_FSD002_UBR,AUD_FSD002_UAs,AUD_FSD002_UBC,AUD_FSD002_UBA,AUD_FSD002_UBS, '', 'BANTOTAL', '', '', '',AUD_FSD002_UT FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFAPE1',AUD_old_PFAPE1,AUD_new_PFAPE1 FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFAPE1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFAPE2',AUD_old_PFAPE2,AUD_new_PFAPE2 FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFAPE2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFCANT',AUD_old_PFCANT,AUD_new_PFCANT FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFCANT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFCAPL',AUD_old_PFCAPL,AUD_new_PFCAPL FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFCAPL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFCLEG',AUD_old_PFCLEG,AUD_new_PFCLEG FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFCLEG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFEBCO',AUD_old_PFEBCO,AUD_new_PFEBCO FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFEBCO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFECIV',AUD_old_PFECIV,AUD_new_PFECIV FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFECIV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFEPAT',AUD_old_PFEPAT,AUD_new_PFEPAT FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFEPAT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFFAL',AUD_old_PFFAL,AUD_new_PFFAL FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFFAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFFANT',TO_CHAR(AUD_old_PFFANT,'YYYY-MM-DD'),TO_CHAR(AUD_new_PFFANT,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFFANT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFFFAL',TO_CHAR(AUD_old_PFFFAL,'YYYY-MM-DD'),TO_CHAR(AUD_new_PFFFAL,'YYYY-MM-DD') FROM BANTPR
OD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFFFAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFFIBC',TO_CHAR(AUD_old_PFFIBC,'YYYY-MM-DD'),TO_CHAR(AUD_new_PFFIBC,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFFIBC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFFLEG',TO_CHAR(AUD_old_PFFLEG,'YYYY-MM-DD'),TO_CHAR(AUD_new_PFFLEG,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFFLEG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFFNAC',TO_CHAR(AUD_old_PFFNAC,'YYYY-MM-DD'),TO_CHAR(AUD_new_PFFNAC,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFFNAC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFFPEP',TO_CHAR(AUD_old_PFFPEP,'YYYY-MM-DD'),TO_CHAR(AUD_new_PFFPEP,'YYYY-MM-DD') FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFFPEP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFLNAC',AUD_old_PFLNAC,AUD_new_PFLNAC FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFLNAC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFNDOC',AUD_old_PFNDOC,AUD_new_PFNDOC FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFNDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFNOM1',AUD_old_PFNOM1,AUD_new_PFNOM1 FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFNOM1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFNOM2',AUD_old_PFNOM2,AUD_new_PFNOM2 FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFNOM2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFPAIS',AUD_old_PFPAIS,AUD_new_PFPAIS FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFPAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFPNAC',AUD_old_PFPNAC,AUD_new_PFPNAC FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFPNAC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSD002_UOn,AUD_FSD002_GuidKey,'PFTDOC',AUD_old_PFTDOC,AUD_new_PFTDOC FROM BANTPROD.AUD_FSD002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey AND AUDMstFld = 'PFTDOC'); DELETE FROM AUD_FSD002_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSD002_UOn AND AUDMstId = AUD_FSD002_GuidKey);  COMMIT ;END IF;END;
/

