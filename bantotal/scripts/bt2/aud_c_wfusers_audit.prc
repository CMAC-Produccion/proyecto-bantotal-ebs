CREATE OR REPLACE PROCEDURE AUD_C_WFUSERS_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_WFUSERS_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSERS',CONCAT( CONCAT( '|WFUSRCOD=', RTRIM(COALESCE(AUD_old_WFUSRCOD,AUD_new_WFUSRCOD)) ),'|' ),AUD_WFUSERS_UBT,AUD_WFUSERS_UBU,AUD_WFUSERS_UBM,AUD_WFUSERS_UBP,AUD_WFUSERS_UBR,AUD_WFUSERS_UAs,AUD_WFUSERS_UBC,AUD_WFUSERS_UBA,AUD_WFUSERS_UBS, '', 'BANTOTAL', '', '', '',AUD_WFUSERS_UT FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFCALID',AUD_old_WFCALID,AUD_new_WFCALID FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFCALID'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFLNGID',AUD_old_WFLNGID,AUD_new_WFLNGID FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFLNGID'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRACCLEV',AUD_old_WFUSRACCLEV,AUD_new_WFUSRACCLEV FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRACCLEV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRAUTBCK',AUD_old_WFUSRAUTBCK,AUD_new_WFUSRAUTBCK FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRAUTBCK'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRBLOC',AUD_old_WFUSRBLOC,AUD_new_WFUSRBLOC FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRBLOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRCOD',AUD_old_WFUSRCOD,AUD_new_WFUSRCOD FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSREMAIL',AUD_old_WFUSREMAIL,AUD_new_WFUSREMAIL FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSREMAIL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRENCPWD',AUD_old_WFUSRENCPWD,AUD_new_WFUSRENCPWD FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRENCPWD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSREXPTIME',TO_CHAR(AUD_old_WFUSREXPTIME,'YYYY-MM-DD'),TO_CHAR(AUD_new_WFUSREXPTIME,'YYYY-MM-DD') FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSREXPTIME'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRINTERNAL',AUD_old_WFUSRINTERNAL,AUD_new_WFUSRINTERNAL FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRINTERNAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRLSTCON',TO
_CHAR(AUD_old_WFUSRLSTCON,'YYYY-MM-DD'),TO_CHAR(AUD_new_WFUSRLSTCON,'YYYY-MM-DD') FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRLSTCON'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRNAME',AUD_old_WFUSRNAME,AUD_new_WFUSRNAME FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRNAME'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSROUT',AUD_old_WFUSROUT,AUD_new_WFUSROUT FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSROUT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRPRCCAL',AUD_old_WFUSRPRCCAL,AUD_new_WFUSRPRCCAL FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRPRCCAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRRBLREQ',AUD_old_WFUSRRBLREQ,AUD_new_WFUSRRBLREQ FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRRBLREQ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRRSUB',AUD_old_WFUSRRSUB,AUD_new_WFUSRRSUB FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRRSUB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRSH',AUD_old_WFUSRSH,AUD_new_WFUSRSH FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRSH'); INSERT INTO BANTPROD.AUD005 SELECT AUD_WFUSERS_UOn,AUD_WFUSERS_GuidKey,'WFUSRUSUB',AUD_old_WFUSRUSUB,AUD_new_WFUSRUSUB FROM BANTPROD.AUD_WFUSERS_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey AND AUDMstFld = 'WFUSRUSUB'); DELETE FROM AUD_WFUSERS_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_WFUSERS_UOn AND AUDMstId = AUD_WFUSERS_GuidKey);  COMMIT ;END IF;END;
/

