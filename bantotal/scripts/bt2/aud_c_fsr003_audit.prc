CREATE OR REPLACE PROCEDURE AUD_C_FSR003_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSR003_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSR003_UOn,AUD_FSR003_GuidKey,'FSR003',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PFNDO1=', RTRIM(COALESCE(AUD_old_PFNDO1,AUD_new_PFNDO1)) ),CONCAT( '|PFPAI1=', RTRIM(COALESCE(AUD_old_PFPAI1,AUD_new_PFPAI1)) ) ),CONCAT( '|PFTDO1=', RTRIM(COALESCE(AUD_old_PFTDO1,AUD_new_PFTDO1)) ) ),CONCAT( '|PJNDOC=', RTRIM(COALESCE(AUD_old_PJNDOC,AUD_new_PJNDOC)) ) ),CONCAT( '|PJPAIS=', RTRIM(COALESCE(AUD_old_PJPAIS,AUD_new_PJPAIS)) ) ),CONCAT( '|PJTDOC=', RTRIM(COALESCE(AUD_old_PJTDOC,AUD_new_PJTDOC)) ) ),'|' ),AUD_FSR003_UBT,AUD_FSR003_UBU,AUD_FSR003_UBM,AUD_FSR003_UBP,AUD_FSR003_UBR,AUD_FSR003_UAs,AUD_FSR003_UBC,AUD_FSR003_UBA,AUD_FSR003_UBS, '', 'BANTOTAL', '', '', '',AUD_FSR003_UT FROM BANTPROD.AUD_FSR003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR003_UOn AND AUDMstId = AUD_FSR003_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR003_UOn,AUD_FSR003_GuidKey,'PFNDO1',AUD_old_PFNDO1,AUD_new_PFNDO1 FROM BANTPROD.AUD_FSR003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR003_UOn AND AUDMstId = AUD_FSR003_GuidKey AND AUDMstFld = 'PFNDO1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR003_UOn,AUD_FSR003_GuidKey,'PFPAI1',AUD_old_PFPAI1,AUD_new_PFPAI1 FROM BANTPROD.AUD_FSR003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR003_UOn AND AUDMstId = AUD_FSR003_GuidKey AND AUDMstFld = 'PFPAI1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR003_UOn,AUD_FSR003_GuidKey,'PFPART',AUD_old_PFPART,AUD_new_PFPART FROM BANTPROD.AUD_FSR003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR003_UOn AND AUDMstId = AUD_FSR003_GuidKey AND AUDMstFld = 'PFPART'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR003_UOn,AUD_FSR003_GuidKey,'PFTDO1',AUD_old_PFTDO1,AUD_new_PFTDO1 FROM BANTPROD.AUD_FSR003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR003_UOn AND AUDMstId = AUD_FSR003_GuidKey AND AUDMstFld = 'PFTDO1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR003_UOn,AUD_FSR003_GuidKey,'PJNDOC',AUD_old_PJNDOC,AUD_new_PJNDOC FROM BANTPROD.AUD_FSR003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR003_UOn AND AUDMstId = AUD_FSR003_GuidKey AND AUDMstFld = 'PJNDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR003_UOn,AUD_FSR003_GuidKey,'PJPAIS',AUD_old_PJPAIS,AUD_new_PJPAIS FROM BANTPROD.AUD_FSR003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR003_UOn AND AUDMstId = AUD_FSR003_GuidKey AND AUDMstFld = 'PJPAIS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR003_UOn,AUD_FSR003_GuidKey,'PJTDOC',AUD_old_PJTDOC,AUD_new_PJTDOC FROM BANTPROD.AUD_FSR003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR003_UOn AND AUDMstId = AUD_FSR003_GuidKey AND AUDMstFld = 'PJTDOC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSR003_UOn,AUD_FSR003_GuidKey,'VICOD',AUD_old_VICOD,AUD_new_VICOD FROM BANTPROD.AUD_FSR003_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSR003_UOn AND AUDMstId = AUD_FSR003_GuidKey AND AUDMstFld = 'VICOD'); DELETE FROM AUD_FSR003_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSR003_UOn AND AUDMstId = AUD_FSR003_GuidKey);  COMMIT ;END IF;END;
/

