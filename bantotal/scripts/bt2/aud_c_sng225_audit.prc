CREATE OR REPLACE PROCEDURE AUD_C_SNG225_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG225_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG225_UOn,AUD_SNG225_GuidKey,'SNG225',CONCAT( CONCAT( CONCAT( '|SNG224COD=', RTRIM(COALESCE(AUD_old_SNG224COD,AUD_new_SNG224COD)) ),CONCAT( '|SNG225COD=', RTRIM(COALESCE(AUD_old_SNG225COD,AUD_new_SNG225COD)) ) ),'|' ),AUD_SNG225_UBT,AUD_SNG225_UBU,AUD_SNG225_UBM,AUD_SNG225_UBP,AUD_SNG225_UBR,AUD_SNG225_UAs,AUD_SNG225_UBC,AUD_SNG225_UBA,AUD_SNG225_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG225_UT FROM BANTPROD.AUD_SNG225_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG225_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG225_UOn,AUD_SNG225_GuidKey,'SNG224COD',AUD_old_SNG224COD,AUD_new_SNG224COD FROM BANTPROD.AUD_SNG225_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG225_GuidKey AND AUDMstFld = 'SNG224COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG225_UOn,AUD_SNG225_GuidKey,'SNG225COD',AUD_old_SNG225COD,AUD_new_SNG225COD FROM BANTPROD.AUD_SNG225_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG225_GuidKey AND AUDMstFld = 'SNG225COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG225_UOn,AUD_SNG225_GuidKey,'SNG225DC',AUD_old_SNG225DC,AUD_new_SNG225DC FROM BANTPROD.AUD_SNG225_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG225_GuidKey AND AUDMstFld = 'SNG225DC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG225_UOn,AUD_SNG225_GuidKey,'SNG225DDIR',AUD_old_SNG225DDIR,AUD_new_SNG225DDIR FROM BANTPROD.AUD_SNG225_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG225_GuidKey AND AUDMstFld = 'SNG225DDIR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG225_UOn,AUD_SNG225_GuidKey,'SNG225DDS',AUD_old_SNG225DDS,AUD_new_SNG225DDS FROM BANTPROD.AUD_SNG225_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG225_GuidKey AND AUDMstFld = 'SNG225DDS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG225_UOn,AUD_SNG225_GuidKey,'SNG225DSC',AUD_old_SNG225DSC,AUD_new_SNG225DSC FROM BANTPROD.AUD_SNG225_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG225_GuidKey AND AUDMstFld = 'SNG225DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG225_UOn,AUD_SNG225_GuidKey,'SNG225PARA',AUD_old_SNG225PARA,AUD_new_SNG225PARA FROM BANTPROD.AUD_SNG225_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG225_GuidKey AND AUDMstFld = 'SNG225PARA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG225_UOn,AUD_SNG225_GuidKey,'SNG225PARB',AUD_old_SNG225PARB,AUD_new_SNG225PARB FROM BANTPROD.AUD_SNG225_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG225_GuidKey AND AUDMstFld = 'SNG225PARB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG225_UOn,AUD_SNG225_GuidKey,'SNG225PROG',AUD_old_SNG225PROG,AUD_new_SNG225PROG FROM BANTPROD.AUD_SNG225_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG225_GuidKey AND AUDMstFld = 'SNG225PROG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG225_UOn,AUD_SNG225_GuidKey,'SNG225REP',AUD_old_SNG225REP,AUD_new_SNG225REP FROM BANTPROD.AUD_SNG225_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG225_GuidKey AND AUDMstFld = 'SNG225REP'); DELETE FROM AUD_SNG225_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG225_UOn AND AUDMstId = AUD_SNG22
5_GuidKey);  COMMIT ;END IF;END;
/

