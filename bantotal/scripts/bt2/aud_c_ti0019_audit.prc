CREATE OR REPLACE PROCEDURE AUD_C_TI0019_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_TI0019_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TI0019',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|TICORRT=', RTRIM(COALESCE(AUD_old_TICORRT,AUD_new_TICORRT)) ),CONCAT( '|TIFCHC=', RTRIM(COALESCE(AUD_old_TIFCHC,AUD_new_TIFCHC)) ) ),CONCAT( '|TIFORDI=', RTRIM(COALESCE(AUD_old_TIFORDI,AUD_new_TIFORDI)) ) ),CONCAT( '|TIMODT=', RTRIM(COALESCE(AUD_old_TIMODT,AUD_new_TIMODT)) ) ),CONCAT( '|TINREL=', RTRIM(COALESCE(AUD_old_TINREL,AUD_new_TINREL)) ) ),CONCAT( '|TIPGCOD=', RTRIM(COALESCE(AUD_old_TIPGCOD,AUD_new_TIPGCOD)) ) ),CONCAT( '|TIPSUC=', RTRIM(COALESCE(AUD_old_TIPSUC,AUD_new_TIPSUC)) ) ),CONCAT( '|TITRN=', RTRIM(COALESCE(AUD_old_TITRN,AUD_new_TITRN)) ) ),'|' ),AUD_TI0019_UBT,AUD_TI0019_UBU,AUD_TI0019_UBM,AUD_TI0019_UBP,AUD_TI0019_UBR,AUD_TI0019_UAs,AUD_TI0019_UBC,AUD_TI0019_UBA,AUD_TI0019_UBS, '', 'BANTOTAL', '', '', '',AUD_TI0019_UT FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TICODHISTO',AUD_old_TICODHISTO,AUD_new_TICODHISTO FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TICODHISTO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TICODMOV',AUD_old_TICODMOV,AUD_new_TICODMOV FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TICODMOV'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TICONTABIL',AUD_old_TICONTABIL,AUD_new_TICONTABIL FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TICONTABIL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TICORRELAI',AUD_old_TICORRELAI,AUD_new_TICORRELAI FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TICORRELAI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TICORRT',AUD_old_TICORRT,AUD_new_TICORRT FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TICORRT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIDBHA',AUD_old_TIDBHA,AUD_new_TIDBHA FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIDBHA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIFCHC',TO_CHAR(AUD_old_TIFCHC,'YYYY-MM-DD'),TO_CHAR(AUD_new_TIFCHC,'YYYY-MM-DD') FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIFCHC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIFORDI',AUD_old_TIFORDI,AUD_new_TIFORDI FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIFORDI'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIFVAL',TO_CHAR(AUD_old_TIFVAL,'YYYY-MM-DD'),TO_CHAR(AUD_new_TIFVAL,'YYYY-MM-DD') FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0
019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIFVAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIHSCCTA',AUD_old_TIHSCCTA,AUD_new_TIHSCCTA FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIHSCCTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIHSCMDA',AUD_old_TIHSCMDA,AUD_new_TIHSCMDA FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIHSCMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIHSCMOD',AUD_old_TIHSCMOD,AUD_new_TIHSCMOD FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIHSCMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIHSCOPER',AUD_old_TIHSCOPER,AUD_new_TIHSCOPER FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIHSCOPER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIHSCPAP',AUD_old_TIHSCPAP,AUD_new_TIHSCPAP FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIHSCPAP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIHSCSBOP',AUD_old_TIHSCSBOP,AUD_new_TIHSCSBOP FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIHSCSBOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIHSCSUC',AUD_old_TIHSCSUC,AUD_new_TIHSCSUC FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIHSCSUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIHSCTOPE',AUD_old_TIHSCTOPE,AUD_new_TIHSCTOPE FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIHSCTOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIIMPORTET',AUD_old_TIIMPORTET,AUD_new_TIIMPORTET FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIIMPORTET'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIMDA',AUD_old_TIMDA,AUD_new_TIMDA FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIMDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIMODT',AUD_old_TIMODT,AUD_new_TIMODT FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIMODT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIMONTOIMP',AUD_old_TIMONTOIMP,AUD_new_TIMONTOIMP FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIMONTOIMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TINREL',AUD_old_TINREL,AUD_new_TINREL FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TINREL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIORDD',AUD_old_TIORDD,AUD_new_TIORDD FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BAN
TPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIORDD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIORDO',AUD_old_TIORDO,AUD_new_TIORDO FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIORDO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIPGCOD',AUD_old_TIPGCOD,AUD_new_TIPGCOD FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIPGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TIPSUC',AUD_old_TIPSUC,AUD_new_TIPSUC FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TIPSUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TISBORDEST',AUD_old_TISBORDEST,AUD_new_TISBORDEST FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TISBORDEST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TISBORORIG',AUD_old_TISBORORIG,AUD_new_TISBORORIG FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TISBORORIG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_TI0019_UOn,AUD_TI0019_GuidKey,'TITRN',AUD_old_TITRN,AUD_new_TITRN FROM BANTPROD.AUD_TI0019_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey AND AUDMstFld = 'TITRN'); DELETE FROM AUD_TI0019_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_TI0019_UOn AND AUDMstId = AUD_TI0019_GuidKey);  COMMIT ;END IF;END;
/

