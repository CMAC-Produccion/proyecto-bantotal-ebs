CREATE OR REPLACE PROCEDURE AUD_C_FSI008_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FSI008_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FSI008_UOn,AUD_FSI008_GuidKey,'FSI008',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|CIAGRU=', RTRIM(COALESCE(AUD_old_CIAGRU,AUD_new_CIAGRU)) ),CONCAT( '|CICPO=', RTRIM(COALESCE(AUD_old_CICPO,AUD_new_CICPO)) ) ),CONCAT( '|CITPOA=', RTRIM(COALESCE(AUD_old_CITPOA,AUD_new_CITPOA)) ) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),'|' ),AUD_FSI008_UBT,AUD_FSI008_UBU,AUD_FSI008_UBM,AUD_FSI008_UBP,AUD_FSI008_UBR,AUD_FSI008_UAs,AUD_FSI008_UBC,AUD_FSI008_UBA,AUD_FSI008_UBS, '', 'BANTOTAL', '', '', '',AUD_FSI008_UT FROM BANTPROD.AUD_FSI008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSI008_UOn AND AUDMstId = AUD_FSI008_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSI008_UOn,AUD_FSI008_GuidKey,'CIAGRU',AUD_old_CIAGRU,AUD_new_CIAGRU FROM BANTPROD.AUD_FSI008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSI008_UOn AND AUDMstId = AUD_FSI008_GuidKey AND AUDMstFld = 'CIAGRU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSI008_UOn,AUD_FSI008_GuidKey,'CIAPZOD',AUD_old_CIAPZOD,AUD_new_CIAPZOD FROM BANTPROD.AUD_FSI008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSI008_UOn AND AUDMstId = AUD_FSI008_GuidKey AND AUDMstFld = 'CIAPZOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSI008_UOn,AUD_FSI008_GuidKey,'CIAPZOH',AUD_old_CIAPZOH,AUD_new_CIAPZOH FROM BANTPROD.AUD_FSI008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSI008_UOn AND AUDMstId = AUD_FSI008_GuidKey AND AUDMstFld = 'CIAPZOH'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSI008_UOn,AUD_FSI008_GuidKey,'CIAPZOT',AUD_old_CIAPZOT,AUD_new_CIAPZOT FROM BANTPROD.AUD_FSI008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSI008_UOn AND AUDMstId = AUD_FSI008_GuidKey AND AUDMstFld = 'CIAPZOT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSI008_UOn,AUD_FSI008_GuidKey,'CICPO',AUD_old_CICPO,AUD_new_CICPO FROM BANTPROD.AUD_FSI008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSI008_UOn AND AUDMstId = AUD_FSI008_GuidKey AND AUDMstFld = 'CICPO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSI008_UOn,AUD_FSI008_GuidKey,'CITPOA',AUD_old_CITPOA,AUD_new_CITPOA FROM BANTPROD.AUD_FSI008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSI008_UOn AND AUDMstId = AUD_FSI008_GuidKey AND AUDMstFld = 'CITPOA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FSI008_UOn,AUD_FSI008_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FSI008_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FSI008_UOn AND AUDMstId = AUD_FSI008_GuidKey AND AUDMstFld = 'PGCOD'); DELETE FROM AUD_FSI008_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FSI008_UOn AND AUDMstId = AUD_FSI008_GuidKey);  COMMIT ;END IF;END;
/

