CREATE OR REPLACE PROCEDURE AUD_C_MBC009_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_MBC009_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_MBC009_UOn,AUD_MBC009_GuidKey,'MBC009',CONCAT( CONCAT( CONCAT( '|MBC9EMP=', RTRIM(COALESCE(AUD_old_MBC9EMP,AUD_new_MBC9EMP)) ),CONCAT( '|MBC9USU=', RTRIM(COALESCE(AUD_old_MBC9USU,AUD_new_MBC9USU)) ) ),'|' ),AUD_MBC009_UBT,AUD_MBC009_UBU,AUD_MBC009_UBM,AUD_MBC009_UBP,AUD_MBC009_UBR,AUD_MBC009_UAs,AUD_MBC009_UBC,AUD_MBC009_UBA,AUD_MBC009_UBS, '', 'BANTOTAL', '', '', '',AUD_MBC009_UT FROM BANTPROD.AUD_MBC009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_MBC009_UOn AND AUDMstId = AUD_MBC009_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC009_UOn,AUD_MBC009_GuidKey,'MBC9CAJ',AUD_old_MBC9CAJ,AUD_new_MBC9CAJ FROM BANTPROD.AUD_MBC009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC009_UOn AND AUDMstId = AUD_MBC009_GuidKey AND AUDMstFld = 'MBC9CAJ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC009_UOn,AUD_MBC009_GuidKey,'MBC9CAJH',AUD_old_MBC9CAJH,AUD_new_MBC9CAJH FROM BANTPROD.AUD_MBC009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC009_UOn AND AUDMstId = AUD_MBC009_GuidKey AND AUDMstFld = 'MBC9CAJH'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC009_UOn,AUD_MBC009_GuidKey,'MBC9EMP',AUD_old_MBC9EMP,AUD_new_MBC9EMP FROM BANTPROD.AUD_MBC009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC009_UOn AND AUDMstId = AUD_MBC009_GuidKey AND AUDMstFld = 'MBC9EMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC009_UOn,AUD_MBC009_GuidKey,'MBC9NCAJ',AUD_old_MBC9NCAJ,AUD_new_MBC9NCAJ FROM BANTPROD.AUD_MBC009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC009_UOn AND AUDMstId = AUD_MBC009_GuidKey AND AUDMstFld = 'MBC9NCAJ'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC009_UOn,AUD_MBC009_GuidKey,'MBC9SUC',AUD_old_MBC9SUC,AUD_new_MBC9SUC FROM BANTPROD.AUD_MBC009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC009_UOn AND AUDMstId = AUD_MBC009_GuidKey AND AUDMstFld = 'MBC9SUC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC009_UOn,AUD_MBC009_GuidKey,'MBC9TES',AUD_old_MBC9TES,AUD_new_MBC9TES FROM BANTPROD.AUD_MBC009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC009_UOn AND AUDMstId = AUD_MBC009_GuidKey AND AUDMstFld = 'MBC9TES'); INSERT INTO BANTPROD.AUD005 SELECT AUD_MBC009_UOn,AUD_MBC009_GuidKey,'MBC9USU',AUD_old_MBC9USU,AUD_new_MBC9USU FROM BANTPROD.AUD_MBC009_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_MBC009_UOn AND AUDMstId = AUD_MBC009_GuidKey AND AUDMstFld = 'MBC9USU'); DELETE FROM AUD_MBC009_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_MBC009_UOn AND AUDMstId = AUD_MBC009_GuidKey);  COMMIT ;END IF;END;
/

