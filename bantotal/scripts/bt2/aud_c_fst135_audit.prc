CREATE OR REPLACE PROCEDURE AUD_C_FST135_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST135_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'FST135',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|CMSBOR=', RTRIM(COALESCE(AUD_old_CMSBOR,AUD_new_CMSBOR)) ),CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ) ),CONCAT( '|TRMOD=', RTRIM(COALESCE(AUD_old_TRMOD,AUD_new_TRMOD)) ) ),CONCAT( '|TRNRO=', RTRIM(COALESCE(AUD_old_TRNRO,AUD_new_TRNRO)) ) ),CONCAT( '|TRORD=', RTRIM(COALESCE(AUD_old_TRORD,AUD_new_TRORD)) ) ),'|' ),AUD_FST135_UBT,AUD_FST135_UBU,AUD_FST135_UBM,AUD_FST135_UBP,AUD_FST135_UBR,AUD_FST135_UAs,AUD_FST135_UBC,AUD_FST135_UBA,AUD_FST135_UBS, '', 'BANTOTAL', '', '', '',AUD_FST135_UT FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'CMOBS',AUD_old_CMOBS,AUD_new_CMOBS FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'CMOBS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'CMORD',AUD_old_CMORD,AUD_new_CMORD FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'CMORD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'CMSBOR',AUD_old_CMSBOR,AUD_new_CMSBOR FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'CMSBOR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'CMSN1',AUD_old_CMSN1,AUD_new_CMSN1 FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'CMSN1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'CMSN2',AUD_old_CMSN2,AUD_new_CMSN2 FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'CMSN2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'CMTIMP',AUD_old_CMTIMP,AUD_new_CMTIMP FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'CMTIMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'CMTOP',AUD_old_CMTOP,AUD_new_CMTOP FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'CMTOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'COCOD',AUD_old_COCOD,AUD_new_COCOD FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'COCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'TRMOD',AUD_old_TRMOD,AUD_new_TRMOD FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'TRMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'TRNRO',AUD_old_TRNR
O,AUD_new_TRNRO FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'TRNRO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST135_UOn,AUD_FST135_GuidKey,'TRORD',AUD_old_TRORD,AUD_new_TRORD FROM BANTPROD.AUD_FST135_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey AND AUDMstFld = 'TRORD'); DELETE FROM AUD_FST135_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST135_UOn AND AUDMstId = AUD_FST135_GuidKey);  COMMIT ;END IF;END;
/

