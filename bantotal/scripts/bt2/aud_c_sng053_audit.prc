CREATE OR REPLACE PROCEDURE AUD_C_SNG053_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG053_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG053_UOn,AUD_SNG053_GuidKey,'SNG053',CONCAT( CONCAT( CONCAT( '|SNG053CMB=', RTRIM(COALESCE(AUD_old_SNG053CMB,AUD_new_SNG053CMB)) ),CONCAT( '|SNG055EMP=', RTRIM(COALESCE(AUD_old_SNG055EMP,AUD_new_SNG055EMP)) ) ),'|' ),AUD_SNG053_UBT,AUD_SNG053_UBU,AUD_SNG053_UBM,AUD_SNG053_UBP,AUD_SNG053_UBR,AUD_SNG053_UAs,AUD_SNG053_UBC,AUD_SNG053_UBA,AUD_SNG053_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG053_UT FROM BANTPROD.AUD_SNG053_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG053_UOn AND AUDMstId = AUD_SNG053_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG053_UOn,AUD_SNG053_GuidKey,'SNG053CMB',AUD_old_SNG053CMB,AUD_new_SNG053CMB FROM BANTPROD.AUD_SNG053_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG053_UOn AND AUDMstId = AUD_SNG053_GuidKey AND AUDMstFld = 'SNG053CMB'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG053_UOn,AUD_SNG053_GuidKey,'SNG053DSC',AUD_old_SNG053DSC,AUD_new_SNG053DSC FROM BANTPROD.AUD_SNG053_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG053_UOn AND AUDMstId = AUD_SNG053_GuidKey AND AUDMstFld = 'SNG053DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG053_UOn,AUD_SNG053_GuidKey,'SNG053DUP',AUD_old_SNG053DUP,AUD_new_SNG053DUP FROM BANTPROD.AUD_SNG053_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG053_UOn AND AUDMstId = AUD_SNG053_GuidKey AND AUDMstFld = 'SNG053DUP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG053_UOn,AUD_SNG053_GuidKey,'SNG053POS',AUD_old_SNG053POS,AUD_new_SNG053POS FROM BANTPROD.AUD_SNG053_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG053_UOn AND AUDMstId = AUD_SNG053_GuidKey AND AUDMstFld = 'SNG053POS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG053_UOn,AUD_SNG053_GuidKey,'SNG053PTE',AUD_old_SNG053PTE,AUD_new_SNG053PTE FROM BANTPROD.AUD_SNG053_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG053_UOn AND AUDMstId = AUD_SNG053_GuidKey AND AUDMstFld = 'SNG053PTE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG053_UOn,AUD_SNG053_GuidKey,'SNG055EMP',AUD_old_SNG055EMP,AUD_new_SNG055EMP FROM BANTPROD.AUD_SNG053_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG053_UOn AND AUDMstId = AUD_SNG053_GuidKey AND AUDMstFld = 'SNG055EMP'); DELETE FROM AUD_SNG053_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG053_UOn AND AUDMstId = AUD_SNG053_GuidKey);  COMMIT ;END IF;END;
/

