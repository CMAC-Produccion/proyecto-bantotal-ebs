CREATE OR REPLACE PROCEDURE AUD_C_X054011_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_X054011_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'X054011',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ),CONCAT( '|SGCOD=', RTRIM(COALESCE(AUD_old_SGCOD,AUD_new_SGCOD)) ) ),CONCAT( '|XPREMOD=', RTRIM(COALESCE(AUD_old_XPREMOD,AUD_new_XPREMOD)) ) ),CONCAT( '|XPREMONEDA=', RTRIM(COALESCE(AUD_old_XPREMONEDA,AUD_new_XPREMONEDA)) ) ),CONCAT( '|XPREPAPEL=', RTRIM(COALESCE(AUD_old_XPREPAPEL,AUD_new_XPREPAPEL)) ) ),CONCAT( '|XPRETOPE=', RTRIM(COALESCE(AUD_old_XPRETOPE,AUD_new_XPRETOPE)) ) ),'|' ),AUD_X054011_UBT,AUD_X054011_UBU,AUD_X054011_UBM,AUD_X054011_UBP,AUD_X054011_UBR,AUD_X054011_UAs,AUD_X054011_UBC,AUD_X054011_UBA,AUD_X054011_UBS, '', 'BANTOTAL', '', '', '',AUD_X054011_UT FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'SGCOD',AUD_old_SGCOD,AUD_new_SGCOD FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'SGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'XPREMOD',AUD_old_XPREMOD,AUD_new_XPREMOD FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'XPREMOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'XPREMONEDA',AUD_old_XPREMONEDA,AUD_new_XPREMONEDA FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'XPREMONEDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'XPREPAPEL',AUD_old_XPREPAPEL,AUD_new_XPREPAPEL FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'XPREPAPEL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'XPRETOPE',AUD_old_XPRETOPE,AUD_new_XPRETOPE FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'XPRETOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'XSGAUX1',AUD_old_XSGAUX1,AUD_new_XSGAUX1 FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'XSGAUX1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'XSGAUX2',AUD_old_XSGAUX2,AUD_new_XSGAUX2 FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'XSGAUX2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'XSGAUX3',TO_CHAR(AUD_old_XSGAUX3,'YYYY-MM-DD'),TO_CHAR(AUD_new_XSGAUX3,'YYYY-MM-DD') FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'XSGAUX3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'
XSGAUX4',AUD_old_XSGAUX4,AUD_new_XSGAUX4 FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'XSGAUX4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'XSGENDO',AUD_old_XSGENDO,AUD_new_XSGENDO FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'XSGENDO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_X054011_UOn,AUD_X054011_GuidKey,'XSGMODIF',AUD_old_XSGMODIF,AUD_new_XSGMODIF FROM BANTPROD.AUD_X054011_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey AND AUDMstFld = 'XSGMODIF'); DELETE FROM AUD_X054011_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_X054011_UOn AND AUDMstId = AUD_X054011_GuidKey);  COMMIT ;END IF;END;
/

