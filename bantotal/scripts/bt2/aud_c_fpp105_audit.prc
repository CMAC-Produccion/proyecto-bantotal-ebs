CREATE OR REPLACE PROCEDURE AUD_C_FPP105_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FPP105_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'FPP105',CONCAT( CONCAT( CONCAT( CONCAT( '|PP105FECA=', RTRIM(COALESCE(AUD_old_PP105FECA,AUD_new_PP105FECA)) ),CONCAT( '|PP105NCART=', RTRIM(COALESCE(AUD_old_PP105NCART,AUD_new_PP105NCART)) ) ),CONCAT( '|PP105TIPOA=', RTRIM(COALESCE(AUD_old_PP105TIPOA,AUD_new_PP105TIPOA)) ) ),'|' ),AUD_FPP105_UBT,AUD_FPP105_UBU,AUD_FPP105_UBM,AUD_FPP105_UBP,AUD_FPP105_UBR,AUD_FPP105_UAs,AUD_FPP105_UBC,AUD_FPP105_UBA,AUD_FPP105_UBS, '', 'BANTOTAL', '', '', '',AUD_FPP105_UT FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU1',AUD_old_PP105AU1,AUD_new_PP105AU1 FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU10',AUD_old_PP105AU10,AUD_new_PP105AU10 FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU10'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU11',AUD_old_PP105AU11,AUD_new_PP105AU11 FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU11'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU12',AUD_old_PP105AU12,AUD_new_PP105AU12 FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU12'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU2',AUD_old_PP105AU2,AUD_new_PP105AU2 FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU3',AUD_old_PP105AU3,AUD_new_PP105AU3 FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU4',AUD_old_PP105AU4,AUD_new_PP105AU4 FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU4'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU5',TO_CHAR(AUD_old_PP105AU5,'YYYY-MM-DD HH24:MI:SS.FF'),TO_CHAR(AUD_new_PP105AU5,'YYYY-MM-DD HH24:MI:SS.FF') FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU5'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU6',TO_CHAR(AUD_old_PP105AU6,'YYYY-MM-DD HH24:MI:SS.FF'),TO_CHAR(AUD_new_PP105AU6,'YYYY-MM-DD HH24:MI:SS.FF') FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU6'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU7',TO_CHAR(AUD_old_PP105AU7,'YYYY-MM-DD HH24:MI:SS.FF'),TO_CHAR(AUD_new_PP105AU7,'YYYY-MM-DD HH24:MI:SS.FF') FROM BANTPROD.AUD_FPP105_AUDIT WHERE
NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU7'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU8',TO_CHAR(AUD_old_PP105AU8,'YYYY-MM-DD HH24:MI:SS.FF'),TO_CHAR(AUD_new_PP105AU8,'YYYY-MM-DD HH24:MI:SS.FF') FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU8'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105AU9',AUD_old_PP105AU9,AUD_new_PP105AU9 FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105AU9'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105CODE',AUD_old_PP105CODE,AUD_new_PP105CODE FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105CODE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105EST',AUD_old_PP105EST,AUD_new_PP105EST FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105EST'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105FECA',TO_CHAR(AUD_old_PP105FECA,'YYYY-MM-DD HH24:MI:SS.FF'),TO_CHAR(AUD_new_PP105FECA,'YYYY-MM-DD HH24:MI:SS.FF') FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105FECA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105FVAL',TO_CHAR(AUD_old_PP105FVAL,'YYYY-MM-DD HH24:MI:SS.FF'),TO_CHAR(AUD_new_PP105FVAL,'YYYY-MM-DD HH24:MI:SS.FF') FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105FVAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105NCART',AUD_old_PP105NCART,AUD_new_PP105NCART FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105NCART'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FPP105_UOn,AUD_FPP105_GuidKey,'PP105TIPOA',AUD_old_PP105TIPOA,AUD_new_PP105TIPOA FROM BANTPROD.AUD_FPP105_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey AND AUDMstFld = 'PP105TIPOA'); DELETE FROM AUD_FPP105_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FPP105_UOn AND AUDMstId = AUD_FPP105_GuidKey);  COMMIT ;END IF;END;
/

