CREATE OR REPLACE PROCEDURE AUD_C_SNG055_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNG055_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNG055_UOn,AUD_SNG055_GuidKey,'SNG055',CONCAT( CONCAT( CONCAT( '|SNG055CAR=', RTRIM(COALESCE(AUD_old_SNG055CAR,AUD_new_SNG055CAR)) ),CONCAT( '|SNG055EMP=', RTRIM(COALESCE(AUD_old_SNG055EMP,AUD_new_SNG055EMP)) ) ),'|' ),AUD_SNG055_UBT,AUD_SNG055_UBU,AUD_SNG055_UBM,AUD_SNG055_UBP,AUD_SNG055_UBR,AUD_SNG055_UAs,AUD_SNG055_UBC,AUD_SNG055_UBA,AUD_SNG055_UBS, '', 'BANTOTAL', '', '', '',AUD_SNG055_UT FROM BANTPROD.AUD_SNG055_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG055_UOn AND AUDMstId = AUD_SNG055_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG055_UOn,AUD_SNG055_GuidKey,'SNG055ALC',AUD_old_SNG055ALC,AUD_new_SNG055ALC FROM BANTPROD.AUD_SNG055_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG055_UOn AND AUDMstId = AUD_SNG055_GuidKey AND AUDMstFld = 'SNG055ALC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG055_UOn,AUD_SNG055_GuidKey,'SNG055ASD',AUD_old_SNG055ASD,AUD_new_SNG055ASD FROM BANTPROD.AUD_SNG055_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG055_UOn AND AUDMstId = AUD_SNG055_GuidKey AND AUDMstFld = 'SNG055ASD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG055_UOn,AUD_SNG055_GuidKey,'SNG055CAR',AUD_old_SNG055CAR,AUD_new_SNG055CAR FROM BANTPROD.AUD_SNG055_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG055_UOn AND AUDMstId = AUD_SNG055_GuidKey AND AUDMstFld = 'SNG055CAR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG055_UOn,AUD_SNG055_GuidKey,'SNG055DSC',AUD_old_SNG055DSC,AUD_new_SNG055DSC FROM BANTPROD.AUD_SNG055_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG055_UOn AND AUDMstId = AUD_SNG055_GuidKey AND AUDMstFld = 'SNG055DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG055_UOn,AUD_SNG055_GuidKey,'SNG055EMP',AUD_old_SNG055EMP,AUD_new_SNG055EMP FROM BANTPROD.AUD_SNG055_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG055_UOn AND AUDMstId = AUD_SNG055_GuidKey AND AUDMstFld = 'SNG055EMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNG055_UOn,AUD_SNG055_GuidKey,'SNG055WKF',AUD_old_SNG055WKF,AUD_new_SNG055WKF FROM BANTPROD.AUD_SNG055_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNG055_UOn AND AUDMstId = AUD_SNG055_GuidKey AND AUDMstFld = 'SNG055WKF'); DELETE FROM AUD_SNG055_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNG055_UOn AND AUDMstId = AUD_SNG055_GuidKey);  COMMIT ;END IF;END;
/

