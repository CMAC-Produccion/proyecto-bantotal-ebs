CREATE OR REPLACE PROCEDURE AUD_C_SNGP06_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_SNGP06_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP06',CONCAT( CONCAT( CONCAT( CONCAT( '|SNGP05PGC=', RTRIM(COALESCE(AUD_old_SNGP05PGC,AUD_new_SNGP05PGC)) ),CONCAT( '|SNGP06COD=', RTRIM(COALESCE(AUD_old_SNGP06COD,AUD_new_SNGP06COD)) ) ),CONCAT( '|SNGP09COD=', RTRIM(COALESCE(AUD_old_SNGP09COD,AUD_new_SNGP09COD)) ) ),'|' ),AUD_SNGP06_UBT,AUD_SNGP06_UBU,AUD_SNGP06_UBM,AUD_SNGP06_UBP,AUD_SNGP06_UBR,AUD_SNGP06_UAs,AUD_SNGP06_UBC,AUD_SNGP06_UBA,AUD_SNGP06_UBS, '', 'BANTOTAL', '', '', '',AUD_SNGP06_UT FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP05PGC',AUD_old_SNGP05PGC,AUD_new_SNGP05PGC FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey AND AUDMstFld = 'SNGP05PGC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP06CHR1',AUD_old_SNGP06CHR1,AUD_new_SNGP06CHR1 FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey AND AUDMstFld = 'SNGP06CHR1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP06CHR2',AUD_old_SNGP06CHR2,AUD_new_SNGP06CHR2 FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey AND AUDMstFld = 'SNGP06CHR2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP06COD',AUD_old_SNGP06COD,AUD_new_SNGP06COD FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey AND AUDMstFld = 'SNGP06COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP06LTCO',AUD_old_SNGP06LTCO,AUD_new_SNGP06LTCO FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey AND AUDMstFld = 'SNGP06LTCO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP06PGM1',AUD_old_SNGP06PGM1,AUD_new_SNGP06PGM1 FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey AND AUDMstFld = 'SNGP06PGM1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP06PORC',AUD_old_SNGP06PORC,AUD_new_SNGP06PORC FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey AND AUDMstFld = 'SNGP06PORC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP06RNG',AUD_old_SNGP06RNG,AUD_new_SNGP06RNG FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey AND AUDMstFld = 'SNGP06RNG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP06SINT',AUD_old_SNGP06SINT,AUD_new_SNGP06SINT FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey AND AUDMstFld = 'SNGP06SINT'); INSERT INTO BANTPROD.AUD005 SELECT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP09COD',AUD_old_SNGP09COD,AUD_new_SNGP09COD FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey AND AUDMstFld = 'SNGP09COD'); INSERT INTO BANTPROD.AUD005 SELE
CT AUD_SNGP06_UOn,AUD_SNGP06_GuidKey,'SNGP14COD',AUD_old_SNGP14COD,AUD_new_SNGP14COD FROM BANTPROD.AUD_SNGP06_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey AND AUDMstFld = 'SNGP14COD'); DELETE FROM AUD_SNGP06_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_SNGP06_UOn AND AUDMstId = AUD_SNGP06_GuidKey);  COMMIT ;END IF;END;
/

