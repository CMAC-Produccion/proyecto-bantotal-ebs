CREATE OR REPLACE PROCEDURE AUD_C_REP002_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_REP002_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002',CONCAT( CONCAT( CONCAT( '|REP001COD=', RTRIM(COALESCE(AUD_old_REP001COD,AUD_new_REP001COD)) ),CONCAT( '|REP002CONS=', RTRIM(COALESCE(AUD_old_REP002CONS,AUD_new_REP002CONS)) ) ),'|' ),AUD_REP002_UBT,AUD_REP002_UBU,AUD_REP002_UBM,AUD_REP002_UBP,AUD_REP002_UBR,AUD_REP002_UAs,AUD_REP002_UBC,AUD_REP002_UBA,AUD_REP002_UBS, '', 'BANTOTAL', '', '', '',AUD_REP002_UT FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP001COD',AUD_old_REP001COD,AUD_new_REP001COD FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP001COD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002CAYU',AUD_old_REP002CAYU,AUD_new_REP002CAYU FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002CAYU'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002CDSC',AUD_old_REP002CDSC,AUD_new_REP002CDSC FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002CDSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002CNOM',AUD_old_REP002CNOM,AUD_new_REP002CNOM FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002CNOM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002CONS',AUD_old_REP002CONS,AUD_new_REP002CONS FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002CONS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002DSC',AUD_old_REP002DSC,AUD_new_REP002DSC FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002DSC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002EXP',AUD_old_REP002EXP,AUD_new_REP002EXP FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002EXP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002FROM',AUD_old_REP002FROM,AUD_new_REP002FROM FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002FROM'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002GROUPBY',AUD_old_REP002GROUPBY,AUD_new_REP002GROUPBY FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002GROUPBY'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002HAVING',AUD_old_REP002HAVING,AUD_new_REP002HAVING FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002HAVING'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002JOIN',AUD_old_REP
002JOIN,AUD_new_REP002JOIN FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002JOIN'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002ORDERBY',AUD_old_REP002ORDERBY,AUD_new_REP002ORDERBY FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002ORDERBY'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002PRG',AUD_old_REP002PRG,AUD_new_REP002PRG FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002PRG'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002TOP',AUD_old_REP002TOP,AUD_new_REP002TOP FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002TOP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002VER',AUD_old_REP002VER,AUD_new_REP002VER FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002VER'); INSERT INTO BANTPROD.AUD005 SELECT AUD_REP002_UOn,AUD_REP002_GuidKey,'REP002WHERE',AUD_old_REP002WHERE,AUD_new_REP002WHERE FROM BANTPROD.AUD_REP002_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey AND AUDMstFld = 'REP002WHERE'); DELETE FROM AUD_REP002_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_REP002_UOn AND AUDMstId = AUD_REP002_GuidKey);  COMMIT ;END IF;END;
/

