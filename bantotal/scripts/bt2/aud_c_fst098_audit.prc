CREATE OR REPLACE PROCEDURE AUD_C_FST098_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_FST098_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_FST098_UOn,AUD_FST098_GuidKey,'FST098',CONCAT( CONCAT( CONCAT( CONCAT( '|PGCOD=', RTRIM(COALESCE(AUD_old_PGCOD,AUD_new_PGCOD)) ),CONCAT( '|TPCOD=', RTRIM(COALESCE(AUD_old_TPCOD,AUD_new_TPCOD)) ) ),CONCAT( '|TPCORR=', RTRIM(COALESCE(AUD_old_TPCORR,AUD_new_TPCORR)) ) ),'|' ),AUD_FST098_UBT,AUD_FST098_UBU,AUD_FST098_UBM,AUD_FST098_UBP,AUD_FST098_UBR,AUD_FST098_UAs,AUD_FST098_UBC,AUD_FST098_UBA,AUD_FST098_UBS, '', 'BANTOTAL', '', '', '',AUD_FST098_UT FROM BANTPROD.AUD_FST098_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST098_UOn AND AUDMstId = AUD_FST098_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST098_UOn,AUD_FST098_GuidKey,'PGCOD',AUD_old_PGCOD,AUD_new_PGCOD FROM BANTPROD.AUD_FST098_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST098_UOn AND AUDMstId = AUD_FST098_GuidKey AND AUDMstFld = 'PGCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST098_UOn,AUD_FST098_GuidKey,'TPCOD',AUD_old_TPCOD,AUD_new_TPCOD FROM BANTPROD.AUD_FST098_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST098_UOn AND AUDMstId = AUD_FST098_GuidKey AND AUDMstFld = 'TPCOD'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST098_UOn,AUD_FST098_GuidKey,'TPCORR',AUD_old_TPCORR,AUD_new_TPCORR FROM BANTPROD.AUD_FST098_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST098_UOn AND AUDMstId = AUD_FST098_GuidKey AND AUDMstFld = 'TPCORR'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST098_UOn,AUD_FST098_GuidKey,'TPDESC',AUD_old_TPDESC,AUD_new_TPDESC FROM BANTPROD.AUD_FST098_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST098_UOn AND AUDMstId = AUD_FST098_GuidKey AND AUDMstFld = 'TPDESC'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST098_UOn,AUD_FST098_GuidKey,'TPIMP',AUD_old_TPIMP,AUD_new_TPIMP FROM BANTPROD.AUD_FST098_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST098_UOn AND AUDMstId = AUD_FST098_GuidKey AND AUDMstFld = 'TPIMP'); INSERT INTO BANTPROD.AUD005 SELECT AUD_FST098_UOn,AUD_FST098_GuidKey,'TPNRO',AUD_old_TPNRO,AUD_new_TPNRO FROM BANTPROD.AUD_FST098_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_FST098_UOn AND AUDMstId = AUD_FST098_GuidKey AND AUDMstFld = 'TPNRO'); DELETE FROM AUD_FST098_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_FST098_UOn AND AUDMstId = AUD_FST098_GuidKey);  COMMIT ;END IF;END;
/

