CREATE OR REPLACE PROCEDURE AUD_C_XWF700_AUDIT AS cnt NUMBER; BEGIN SELECT COUNT(*) INTO cnt FROM BANTPROD.AUD_XWF700_AUDIT; IF( cnt > 0 ) THEN INSERT INTO BANTPROD.AUD004 (AUDMstTim, AUDMstId, AUDMstTbl, AUDMstKey, AUDMstTrn, AUDMstUsr, AUDMstWst, AUDMstPgm, AUDMstReq, AUDMstTyp, AUDMstCon, AUDMstApp, AUDMstSrv, AUDMstSes, AUDMstGrp, AUDMstLog, AUDMstCur, AUDMstSnt,AUDMstTic) SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWF700',CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( CONCAT( '|XWFCUENTA=', RTRIM(COALESCE(AUD_old_XWFCUENTA,AUD_new_XWFCUENTA)) ),CONCAT( '|XWFEMPRESA=', RTRIM(COALESCE(AUD_old_XWFEMPRESA,AUD_new_XWFEMPRESA)) ) ),CONCAT( '|XWFMODULO=', RTRIM(COALESCE(AUD_old_XWFMODULO,AUD_new_XWFMODULO)) ) ),CONCAT( '|XWFMONEDA=', RTRIM(COALESCE(AUD_old_XWFMONEDA,AUD_new_XWFMONEDA)) ) ),CONCAT( '|XWFOPERACION=', RTRIM(COALESCE(AUD_old_XWFOPERACION,AUD_new_XWFOPERACION)) ) ),CONCAT( '|XWFPAPEL=', RTRIM(COALESCE(AUD_old_XWFPAPEL,AUD_new_XWFPAPEL)) ) ),CONCAT( '|XWFPRCINS=', RTRIM(COALESCE(AUD_old_XWFPRCINS,AUD_new_XWFPRCINS)) ) ),CONCAT( '|XWFSUBOPE=', RTRIM(COALESCE(AUD_old_XWFSUBOPE,AUD_new_XWFSUBOPE)) ) ),CONCAT( '|XWFSUCURSAL=', RTRIM(COALESCE(AUD_old_XWFSUCURSAL,AUD_new_XWFSUCURSAL)) ) ),CONCAT( '|XWFTIPOPE=', RTRIM(COALESCE(AUD_old_XWFTIPOPE,AUD_new_XWFTIPOPE)) ) ),'|' ),AUD_XWF700_UBT,AUD_XWF700_UBU,AUD_XWF700_UBM,AUD_XWF700_UBP,AUD_XWF700_UBR,AUD_XWF700_UAs,AUD_XWF700_UBC,AUD_XWF700_UBA,AUD_XWF700_UBS, '', 'BANTOTAL', '', '', '',AUD_XWF700_UT FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFCAR1',AUD_old_XWFCAR1,AUD_new_XWFCAR1 FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFCAR1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFCAR2',AUD_old_XWFCAR2,AUD_new_XWFCAR2 FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFCAR2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFCAR3',AUD_old_XWFCAR3,AUD_new_XWFCAR3 FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFCAR3'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFCTA1',AUD_old_XWFCTA1,AUD_new_XWFCTA1 FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFCTA1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFCUENTA',AUD_old_XWFCUENTA,AUD_new_XWFCUENTA FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFCUENTA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFEMP1',AUD_old_XWFEMP1,AUD_new_XWFEMP1 FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFEMP1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFEMPRESA',AUD_old_XWFEMPRESA,AUD_new_XWFEMPRESA FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFEMPRESA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFFEC1',TO_CHAR(AUD_old_XWFFEC1,'YYYY-MM-DD'),TO_CHAR(AUD_new_XWFFEC1,'YYYY-MM-DD') FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFFEC1'); INSERT INTO
 BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFFEC2',TO_CHAR(AUD_old_XWFFEC2,'YYYY-MM-DD'),TO_CHAR(AUD_new_XWFFEC2,'YYYY-MM-DD') FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFFEC2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFMODULO',AUD_old_XWFMODULO,AUD_new_XWFMODULO FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFMODULO'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFMONEDA',AUD_old_XWFMONEDA,AUD_new_XWFMONEDA FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFMONEDA'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFMONTO1',AUD_old_XWFMONTO1,AUD_new_XWFMONTO1 FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFMONTO1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFMONTO2',AUD_old_XWFMONTO2,AUD_new_XWFMONTO2 FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFMONTO2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFOPERACION',AUD_old_XWFOPERACION,AUD_new_XWFOPERACION FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFOPERACION'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFPAPEL',AUD_old_XWFPAPEL,AUD_new_XWFPAPEL FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFPAPEL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFPLAZO1',AUD_old_XWFPLAZO1,AUD_new_XWFPLAZO1 FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFPLAZO1'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFPLAZO2',AUD_old_XWFPLAZO2,AUD_new_XWFPLAZO2 FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFPLAZO2'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFPRCINS',AUD_old_XWFPRCINS,AUD_new_XWFPRCINS FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFPRCINS'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFSUBOPE',AUD_old_XWFSUBOPE,AUD_new_XWFSUBOPE FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFSUBOPE'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFSUCURSAL',AUD_old_XWFSUCURSAL,AUD_new_XWFSUCURSAL FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFSUCURSAL'); INSERT INTO BANTPROD.AUD005 SELECT AUD_XWF700_UOn,AUD_XWF700_GuidKey,'XWFTIPOPE',AUD_old_XWFTIPOPE,AUD_new_XWFTIPOPE FROM BANTPROD.AUD_XWF700_AUDIT WHERE NOT EXISTS (SELECT * FROM BANTPROD.AUD005 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey AND AUDMstFld = 'XWFTIPOPE'); DELETE FROM AUD_XWF700_AUDIT  WHERE  EXISTS (SELECT * FROM BANTPROD.AUD004 WHERE AUDMstTim = AUD_XWF700_UOn AND AUDMstId = AUD_XWF700_GuidKey);  COMMI
T ;END IF;END;
/

