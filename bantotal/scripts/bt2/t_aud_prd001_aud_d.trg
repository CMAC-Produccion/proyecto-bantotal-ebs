CREATE OR REPLACE TRIGGER T_AUD_PRD001_AUD_D  AFTER DELETE ON PRD001  FOR EACH ROW    DECLARE	     RequestNumber VARCHAR2(50);      UserName VARCHAR2(50); 	  WrkstName VARCHAR2(50); 	  Server VARCHAR2(50); 	  Application VARCHAR2(50); 	  ProgramName VARCHAR2(50); 	  TransactionNumber VARCHAR2(50); 	  ConnectionId VARCHAR2(50);      ExistConData NUMBER;    BEGIN      SELECT sys_context('USERENV', 'SID') INTO ConnectionId FROM dual;      SELECT COUNT(*) INTO ExistConData FROM DBA_OBJECTS WHERE OWNER=sys_context( 'userenv', 'current_schema' ) AND OBJECT_TYPE = 'TABLE' AND OBJECT_NAME = 'CONDATA';      IF ExistConData > 0 THEN 		 SELECT MAX(Value) INTO RequestNumber FROM CONDATA WHERE Data ='REQUESTID'; 		 SELECT MAX(Value) INTO UserName FROM CONDATA WHERE Data ='USERID'; 		 SELECT MAX(Value) INTO WrkstName FROM CONDATA WHERE Data ='WRKST'; 		 SELECT MAX(Value) INTO Server FROM CONDATA WHERE Data ='SERVER'; 		 SELECT MAX(Value) INTO Application FROM CONDATA WHERE Data ='APPLICATION'; 		 SELECT MAX(Value) INTO ProgramName FROM CONDATA WHERE Data ='PROGRAM';      END IF;     RequestNumber := COALESCE(RequestNumber,'-1');     TransactionNumber := COALESCE(TransactionNumber,'-1');     ConnectionId := COALESCE(ConnectionId,'-1');     SELECT COALESCE(UserName,sys_context('USERENV', 'SESSION_USER'),'NOTDEFINED') INTO UserName FROM dual;     SELECT COALESCE(WrkstName,sys_context('USERENV', 'HOST'),'NOTDEFINED') INTO WrkstName FROM dual;     SELECT COALESCE(Server,sys_context('USERENV', 'SERVER_HOST'),'NOTDEFINED') INTO Server FROM dual;     SELECT COALESCE(Application,sys_context('USERENV', 'ACTION'),'NOTDEFINED') INTO Application FROM dual;     SELECT COALESCE(ProgramName,sys_context('USERENV', 'ACTION'),'NOTDEFINED') INTO ProgramName FROM dual;      INSERT INTO BANTPROD.AUD_PRD001_AUDIT (AUD_old_MODULO,AUD_old_MONEDA,AUD_old_PAPEL,AUD_old_PGCOD,AUD_old_PRD1ADMCHQ,AUD_old_PRD1AOIMP,AUD_old_PRD1CAUT,AUD_old_PRD1CBGA,AUD_old_PRD1CCHQ,AUD_old_PRD1CESTC,AUD_old_PRD1CINT,AUD_old_PRD1CINT1,AUD_old_PRD1CINT2,AUD_old_PRD1CLTCOD,AUD_old_PRD1CSMO,AUD_old_PRD1CSPR,AUD_old_PRD1DREV,AUD_old_PRD1FCHALT,AUD_old_PRD1FCHBAJ,AUD_old_PRD1FVIG,AUD_old_PRD1LINCR,AUD_old_PRD1MODOP,AUD_old_PRD1MOVLA,AUD_old_PRD1PERA1,AUD_old_PRD1PERA2,AUD_old_PRD1PGMA,AUD_old_PRD1PINT,AUD_old_PRD1PLUS,AUD_old_PRD1PMI,AUD_old_PRD1PRCSOL,AUD_old_PRD1PZO,AUD_old_PRD1SDOI,AUD_old_PRD1STSPA,AUD_old_PRD1TAJU,AUD_old_PRD1TANO,AUD_old_PRD1TASA,AUD_old_PRD1TASAC,AUD_old_PRD1TCALI,AUD_old_PRD1TCES,AUD_old_PRD1TDIA,AUD_old_PRD1TRNOP,AUD_old_PRD1TRTCHQ,AUD_old_PRD1TRTCOM,AUD_old_PRD1TRTTS1,AUD_old_PRD1TRTTS2,AUD_old_PRD1TTASA,AUD_old_PRD1TTASC,AUD_old_PRD1USER,AUD_old_PRD1USRALT,AUD_old_PRD1USRBAJ,AUD_old_PRD1VGTE,AUD_old_PRD1WRKBAJ,AUD_old_PRD1WSTALT,AUD_old_TOTOPE, AUD_PRD001_GuidKey ,AUD_PRD001_UOn,AUD_PRD001_UT ,AUD_PRD001_UBR ,AUD_PRD001_UBC ,AUD_PRD001_UBT ,AUD_PRD001_UBU ,AUD_PRD001_UBA ,AUD_PRD001_UBS ,AUD_PRD001_UBP ,AUD_PRD001_UBM ,AUD_PRD001_UAs )      VALUES (:old.MODULO,:old.MONEDA,:old.PAPEL,:old.PGCOD,:old.PRD1ADMCHQ,:old.PRD1AOIMP,:old.PRD1CAUT,:old.PRD1CBGA,:old.PRD1CCHQ,:old.PRD1CESTC,:old.PRD1CINT,:old.PRD1CINT1,:old.PRD1CINT2,:old.PRD1CLTCOD,:old.PRD1CSMO,:old.PRD1CSPR,:old.PRD1DREV,:old.PRD1FCHALT,:old.PRD1FCHBAJ,:old.PRD1FVIG,:old.PRD1LINCR,:old.PRD1MODOP,:old.PRD1MOVLA,:old.PRD1PERA1,:old.PRD1PERA2,:old.PRD1PGMA,:old.PRD1PINT,:old.PRD1PLUS,:old.PRD1PMI,:old.PRD1PRCSOL,:old.PRD1PZO,:old.PRD1SDOI,:old.PRD1STSPA,:old.PRD1TAJU,:old.PRD1TANO,:old.PRD1TASA,:old.PRD1TASAC,:old.PRD1TCALI,:old.PRD1TCES,:old.PRD1TDIA,:old.PRD1TRNOP,:old.PRD1TRTCHQ,:old.PRD1TRTCOM,:old.PRD1TRTTS1,:old.PRD1TRTTS2,:old.PRD1TTASA,:old.PRD1TTASC,:old.PRD1USER,:old.PRD1USRALT,:old.PRD1USRBAJ,:old.PRD1VGTE,:old.PRD1WRKBAJ,:old.PRD1WSTALT,:old.TOTOPE, SYS_GUID(),SYSTIMESTAMP,SYSTIMESTAMP,RequestNumber,ConnectionId,TransactionNumber,UserName,Application,Server,ProgramName,WrkstName,'D' ); END T_AUD_PRD001_AUD_D;
/

